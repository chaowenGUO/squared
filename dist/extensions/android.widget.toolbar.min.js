this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.toolbar=function(){"use strict";const{formatPX:e}=squared.lib.css,{getElementAsNode:t}=squared.lib.session,{assignEmptyValue:a,capitalize:o,includes:r,iterateArray:i,safeNestedMap:n}=squared.lib.util,{createStyleAttribute:d,createViewAttribute:s,getDocumentId:l}=android.lib.util,{NODE_PROCEDURE:c,NODE_RESOURCE:p,NODE_TEMPLATE:u}=squared.base.lib.enumeration,{CONTAINER_ANDROID:m,EXT_ANDROID:h,SUPPORT_ANDROID:g,SUPPORT_ANDROID_X:f}=android.lib.constant,{BUILD_ANDROID:b,CONTAINER_NODE:y}=android.lib.enumeration,O=android.base.Resource;class Toolbar extends squared.base.ExtensionUI{constructor(e,t,a,o){super(e,t,a,o),this.require("android.widget.menu")}init(e,t){var a;if(this.included(e)){const o=this.application;i(e.children,e=>{if("NAV"===e.tagName){const t=o.getDatasetName("use",e);if(!r(t,h.EXTERNAL))return o.setDatasetName("use",e,(t?t+", ":"")+h.EXTERNAL),true}});const n=e.dataset.androidTarget;if(n){const i=document.getElementById(n);if(i&&!r(o.getDatasetName("use",i),"android.widget.coordinator"))null===(a=o.getProcessing(t))||void 0===a||a.rootElements.add(e)}}return false}processNode(o,r){const d=this.application,u=this.resource,b=d.userSettings,T=o.element,A=Object.assign({},this.options[T.id.trim()]),N=s(A.self),I=s(A.appBar),_=s(A.collapsingToolbar),w=d.extensionManager.optionValueAsBoolean(h.RESOURCE_STRINGS,"numberResourceValue"),E=Toolbar.findNestedElement(o,"android.widget.menu"),L=o.has("backgroundImage"),B=[],R=[];let D=n(N,"app");i(T.children,e=>{const r=e.dataset;if("IMG"===e.tagName){if(r.navigationIcon){const t=u.addImageSrc(e,"ic_menu_");if(""!==t)a(D,"navigationIcon","@drawable/"+t)}if(r.collapseIcon){const t=u.addImageSrc(e,"ic_menu_");if(""!==t)a(D,"collapseIcon","@drawable/"+t)}}if(!r.androidTarget){const a=t(e,o.sessionId);if(a)switch(r.androidTargetModule){case"appBar":B.push(a);break;case"collapsingToolbar":R.push(a);break}}});const[P,v,S]=o.api<29?[g.TOOLBAR,g.APPBAR,g.COLLAPSING_TOOLBAR]:[f.TOOLBAR,f.APPBAR,f.COLLAPSING_TOOLBAR],C="collapsingToolbar"in A||R.length>0,k="appBar"in A||B.length>0||C;let x,M,U,q="",W="";if(C)a(D,"layout_collapseMode","pin");else if(a(D,"popupTheme","@style/ThemeOverlay.AppCompat.Light"),!L)a(D,"layout_scrollFlags","scroll|enterAlways");if(k){if(E){const e=D.popupTheme;if(e)W=e.replace("@style/","");D.popupTheme=`@style/${b.manifestThemeName}.PopupOverlay`}}else o.exclude({procedure:c.LAYOUT}),a(N,"android","fitsSystemWindows","true");if(a(N,"android","layout_height",k||!o.hasPX("height")?"?android:attr/actionBarSize":""),o.setControlType(P,y.BLOCK),o.exclude({resource:p.FONT_STYLE}),k){let t=I.android;if(a(I,"android","id",`@+id/${o.controlId}_appbar`),a(I,"android","layout_height",o.hasHeight?e(o.actualHeight):"wrap_content"),a(I,"android","fitsSystemWindows","true"),E){if(t.theme)q=t.theme;t.theme=`@style/${b.manifestThemeName}.AppBarOverlay`,o.data("android.widget.toolbar","themeData",{appBarOverlay:q,popupOverlay:W})}else a(I,"android","theme","@style/ThemeOverlay.AppCompat.Dark.ActionBar");x=this.createPlaceholder(o,B,o.target),x.parent=r;let i=t.id;if(i)x.controlId=l(i),delete t.id;if(x.setControlType(v,y.BLOCK),C){if(D=n(_,"app"),a(_,"android","id",`@+id/${o.controlId}_collapsingtoolbar`),a(_,"android","fitsSystemWindows","true"),!L)a(D,"contentScrim","?attr/colorPrimary");if(a(D,"layout_scrollFlags","scroll|exitUntilCollapsed"),a(D,"toolbarId",o.documentId),M=this.createPlaceholder(o,R),M){if(M.parent=x,t=_.android,i=t.id,i)x.controlId=l(i),delete t.id;M.setControlType(S,y.BLOCK)}}}if(x){if(x.setLayoutWidth("match_parent"),x.setLayoutHeight("wrap_content"),x.apply(O.formatOptions(I,w)),x.render(r),U={type:1,node:x,controlName:v},M){if(o.parent=M,M.apply(O.formatOptions(_,w)),M.render(x),M.setLayoutWidth("match_parent"),M.setLayoutHeight("match_parent"),d.addLayoutTemplate(M.renderParent,M,{type:1,node:M,controlName:S}),L){const e=u.addImageSrc(o.backgroundImage);if(""!==e){const t=this.controller,r=s(A.backgroundImage);let i;switch(o.css("backgroundSize")){case"cover":case"100% auto":case"auto 100%":i="centerCrop";break;case"contain":case"100%":case"100% 100%":i="fitXY";break;case"auto":i="matrix";break;default:i="center";break}D=n(r,"app"),a(r,"android","id",`@+id/${o.controlId}_image`),a(r,"android","src","@drawable/"+e),a(r,"android","scaleType",i),a(r,"android","fitsSystemWindows","true"),a(D,"layout_collapseMode","parallax"),t.addBeforeOutsideTemplate(o.id,t.renderNodeStatic({controlName:m.IMAGE,width:"match_parent",height:"match_parent"},O.formatOptions(r,w))),o.setCacheValue("backgroundImage","")}}}else if(o.parent=x,L)o.data("android.widget.toolbar","background",x);o.data("android.widget.toolbar","outerParent",x.android("id")||x.documentId),o.render(o.parent)}else o.render(r);o.setLayoutWidth("match_parent"),o.apply(O.formatOptions(N,w));const X={type:1,node:o,controlName:P};if(x)return{output:X,outerParent:o.parent,renderAs:x,outputAs:U,include:true};else return{output:X,include:true}}processChild(e){if(e.imageElement&&(e.dataset.navigationIcon||e.dataset.collapseIcon))return e.hide(),{next:true}}postOptimize(e){var t,r;const i=null===(t=Toolbar.findNestedElement(e,"android.widget.menu"))||void 0===t?void 0:t.dataset["layoutName"+o(this.application.systemName)];if(i){const t=s(null===(r=this.options[e.elementId])||void 0===r?void 0:r.self),o=n(t,"app");a(o,"menu","@menu/"+i),e.app("menu",o.menu)}const l=e.data("android.widget.toolbar","themeData");if(l){const e=d(this.options.resource),t=d({name:".NoActionBar",output:e.output}),o=d({name:".AppBarOverlay",output:e.output}),r=d({name:".PopupOverlay",output:e.output});a(e,"name",this.application.userSettings.manifestThemeName),a(e,"parent","Theme.AppCompat.Light.DarkActionBar"),a(t.items,"windowActionBar","false"),a(t.items,"windowNoTitle","true"),a(o,"parent",l.appBarOverlay||"ThemeOverlay.AppCompat.Dark.ActionBar"),a(r,"parent",l.popupOverlay||"ThemeOverlay.AppCompat.Light"),O.addTheme(e),O.addTheme(t),O.addTheme(o),O.addTheme(r)}const c=e.data("android.widget.toolbar","background");if(c){const t=e.android("background");if(""!==t)c.android("background",t),e.delete("android","background")}}createPlaceholder(e,t,a){const o=t.length>0,r=this.application.createNode(e.sessionId,{parent:e,children:t,delegate:o,cascade:true});if(r.inherit(e,"base"),o){let e=1/0,a=0;while(a<t.length)e=Math.min(e,t[a++].containerIndex);r.containerIndex=e}if(a)r.dataset.androidTarget=a.id,r.innerWrapped=e;return r.exclude({resource:p.ALL}),r.positioned=true,r.renderExclude=false,r}}const T=new Toolbar("android.widget.toolbar",2);if(squared)squared.include(T);return T}();
