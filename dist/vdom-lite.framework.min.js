!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).vdom=t()}(this,(function(){"use strict";class NodeList extends squared.lib.base.Container{constructor(e){super(e)}add(e,t=false,i=false){var s;if(super.add(e),t)null===(s=this.afterAdd)||void 0===s||s.call(this,e,i);return this}reset(){return this.clear(),this}}const{CSS_PROPERTIES:e,checkMediaRule:t,getSpecificity:i,hasComputedStyle:s,insertStyleSheetRule:n,parseSelectorText:a}=squared.lib.css,{FILE:l,STRING:r}=squared.lib.regex,{frameworkNotInstalled:o,getElementCache:h,setElementCache:c}=squared.lib.session,{capitalize:d,convertCamelCase:u,parseMimeType:f,plainMap:g,promisify:m,resolvePath:p,trimBoth:v}=squared.lib.util,b=new RegExp(`url\\("?(${r.DATAURI})"?\\),?\\s*`,"g"),_=["backgroundImage","listStyleImage","content"];function y(e,t,i=0,s=0){if(""!==t)if(i>0&&s>0||!e.getImage(t))e.addUnsafeData("image",t,{width:i,height:s,uri:t})}function E(e,t){if(""!==t)for(const i of t.split(","))y(e,p(i.trim().split(" ")[0]))}const x=e=>l.SVG.test(e),S=(e,t)=>{var i;return(null===(i=new RegExp(`\\s*@${e}([^{]+)`).exec(t))||void 0===i?void 0:i[1].trim())||t};class Application{constructor(e,t,i,s,n){if(this.framework=e,this.builtInExtensions={},this.extensions=[],this.closed=false,this.elementMap=new Map,this.session={active:new Map,unusedStyles:new Set},this._nextId=0,this._controllerHandler=new i(this),s)this._resourceHandler=new s(this);if(n)this._extensionManager=new n(this);this._afterInsertNode=this._controllerHandler.afterInsertNode,this.Node=t}afterCreateCache(e){if(this.userSettings.createElementMap){const t=this.elementMap;this.getProcessingCache(e.sessionId).each(e=>t.set(e.element,e))}}createNode(e,t){const i=new this.Node(this.nextId,e,t.element);return this.controllerHandler.afterInsertNode(i),i}copyToDisk(e,t){var i,s;return(null===(s=null===(i=this._resourceHandler)||void 0===i?void 0:i.fileHandler)||void 0===s?void 0:s.copyToDisk(e,t))||o()}appendToArchive(e,t){var i,s;return(null===(s=null===(i=this._resourceHandler)||void 0===i?void 0:i.fileHandler)||void 0===s?void 0:s.appendToArchive(e,t))||o()}saveToArchive(e,t){var i;const s=this._resourceHandler;return s&&(null===(i=s.fileHandler)||void 0===i?void 0:i.saveToArchive(e||s.userSettings.outputArchiveName,t))||o()}createFrom(e,t){var i,s;return(null===(s=null===(i=this._resourceHandler)||void 0===i?void 0:i.fileHandler)||void 0===s?void 0:s.createFrom(e,t))||o()}appendFromArchive(e,t){var i,s;return(null===(s=null===(i=this._resourceHandler)||void 0===i?void 0:i.fileHandler)||void 0===s?void 0:s.appendFromArchive(e,t))||o()}finalize(){return this.closed}reset(){var e;this._nextId=0,this.elementMap.clear(),this.session.active.clear(),this.session.unusedStyles.clear(),this.controllerHandler.reset(),null===(e=this.resourceHandler)||void 0===e||e.reset();for(const e of this.extensions)e.subscribers.clear();this.closed=false}parseDocument(...e){const t=this._resourceHandler,i=true===(null==t?void 0:t.userSettings.preloadImages),a=this._controllerHandler.generateSessionId,l=new Set,r=[],o={cache:new NodeList,excluded:new NodeList,rootElements:l,initializing:false};let h,c;this.session.active.set(a,o),this._controllerHandler.init(),this.setStyleMap(a);const d=n("html > body { overflow: hidden !important; }");if(0===e.length)h=this.mainElement,l.add(h);else{let t=0;while(t<e.length){let i=e[t++];if("string"==typeof i)i=document.getElementById(i);if(i&&s(i)){if(!h)h=i;l.add(i)}}}if(!h)return Promise.reject(new Error("Document root not found."));if(t)for(const e of l)e.querySelectorAll("picture > source").forEach(e=>E(t,e.srcset)),e.querySelectorAll("video").forEach(e=>y(t,e.poster)),e.querySelectorAll("input[type=image]").forEach(e=>y(t,e.src,e.width,e.height)),e.querySelectorAll("object, embed").forEach(e=>{const i=e.data||e.src;if(i&&(e.type.startsWith("image/")||f(i).startsWith("image/")))y(t,i.trim())}),e.querySelectorAll("svg use").forEach(e=>{const i=e.href.baseVal||e.getAttributeNS("xlink","href");if(i&&i.indexOf("#")>0){const e=p(i.split("#")[0]);if(x(e))y(t,e)}});const u=()=>{const t=this.extensions;let i,s;if(o.initializing=false,c){s=c.length,i=0;while(i<s){const e=c[i++];if(e.parentElement)h.removeChild(e)}}s=t.length,i=0;while(i<s)t[i++].beforeParseDocument(a);const n=[];for(const e of l){const t=this.createCache(e,a);if(t)this.afterCreateCache(t),n.push(t)}i=0;while(i<s)t[i++].afterParseDocument(a);try{document.head.removeChild(d)}catch(e){}return e.length>1?n:n[0]};if(i){const{image:e,rawData:i}=t.mapOfAssets;c=[];for(const t of e.values()){const e=t.uri;if(x(e))r.push(e);else if(0===t.width||0===t.height){const i=document.createElement("img");if(i.src=e,i.naturalWidth>0&&i.naturalHeight>0)t.width=i.naturalWidth,t.height=i.naturalHeight;else h.appendChild(i),c.push(i)}}for(const[t,s]of i.entries()){const i=s.mimeType;if((null==i?void 0:i.startsWith("image/"))&&!i.endsWith("svg+xml")){const n=document.createElement("img");n.src=`data:${i};${s.base64?"base64,"+s.base64:s.content}`;const{naturalWidth:a,naturalHeight:l}=n;if(a>0&&l>0)s.width=a,s.height=l,e.set(t,{width:a,height:l,uri:s.filename});else document.body.appendChild(n),c.push(n)}}}if(t)for(const e of l)e.querySelectorAll("img").forEach(e=>{if(E(t,e.srcset),!i)t.addImage(e);else if(x(e.src))r.push(e.src);else if(e.complete)t.addImage(e);else r.push(e)});if(r.length>0)return o.initializing=true,Promise.all(g(r,e=>new Promise((t,i)=>{if("string"==typeof e)fetch(e,{method:"GET",headers:new Headers({Accept:"application/xhtml+xml, image/svg+xml","Content-Type":"image/svg+xml"})}).then(async e=>t(await e.text()));else e.addEventListener("load",()=>t(e)),e.addEventListener("error",()=>i(e))}))).then(e=>{const i=e.length;for(let s=0;s<i;++s){const i=e[s];if("string"==typeof i){const e=r[s];if("string"==typeof e)t.addRawData(e,"image/svg+xml",i,{encoding:"utf8"})}else t.addImage(i)}return u()}).catch(e=>{if(e instanceof Event)e=e.target;const t=e instanceof HTMLImageElement?e.src:"";return""===t||!this.userSettings.showErrorMessages||confirm("FAIL: "+t)?u():Promise.reject(t)});else return m(u)()}createCache(e,t){const i=this.createRootNode(e,t);if(i)this.controllerHandler.sortInitialCache(this.getProcessingCache(t));return i}setStyleMap(e){const i=document.styleSheets,s=i.length;let n=0;while(n<s){const s=i[n++];let a;try{a=s.media.mediaText}catch(e){}if(!a||t(a))this.applyStyleSheet(s,e)}}getProcessing(e){return this.session.active.get(e)}getProcessingCache(e){var t;return(null===(t=this.session.active.get(e))||void 0===t?void 0:t.cache)||new NodeList}getDatasetName(e,t){return t.dataset[e+d(this.systemName)]||t.dataset[e]}setDatasetName(e,t,i){t.dataset[e+d(this.systemName)]=i}toString(){return this.systemName}createRootNode(e,t){const i=this.getProcessing(t),s=this.extensionsCascade,n=this.cascadeParentNode(i.cache,i.excluded,i.rootElements,e,t,0,s.length>0?s:void 0);if(n){const s=new this.Node(0,t,e.parentElement);if(this._afterInsertNode(s),n.parent=s,n.actualParent=s,"HTML"===n.tagName)i.documentElement=n;else if("HTML"===s.tagName)i.documentElement=s;n.depth=0,n.childIndex=0,n.documentRoot=true,i.node=n}return n}cascadeParentNode(e,t,i,s,n,a,l){const r=this.insertNode(s,n);if(r){const o=this.controllerHandler;if(0===a)e.add(r);if(o.preventNodeCascade(r))return r;const h=a+1,c=s.childNodes,d=c.length,u=new Array(d),f=new Array(s.childElementCount);let g=true,m=0,p=0,v=0;while(m<d){const s=c[m++];let a;if("#"===s.nodeName.charAt(0)){if("#text"===s.nodeName)a=this.insertNode(s,n),null==a||a.cssApply(r.textStyle)}else if(o.includeElement(s)){if(a=this.cascadeParentNode(e,t,i,s,n,h,l),a)f[v++]=a,g=false}else if(a=this.insertNode(s,n),a)t.add(a),g=false;if(a)a.init(r,h,p),a.actualParent=r,u[p++]=a,e.add(a)}if(u.length=p,f.length=v,r.naturalChildren=u,r.naturalElements=f,r.inlineText=g,r.retainAs(u),v>0&&this.userSettings.createQuerySelectorMap)r.queryMap=this.createQueryMap(f,v)}return r}createQueryMap(e,t){var i;const s=[e];let n=0;while(n<t){const t=e[n++].queryMap;if(t){const e=t.length;for(let n=0;n<e;++n){const e=n+1;s[e]=(null===(i=s[e])||void 0===i?void 0:i.concat(t[n]))||t[n]}}}return s}applyStyleRule(t,s){var n,l,r,o,d,f,g,m;const E=this._resourceHandler,x=(null===(n=t.parentStyleSheet)||void 0===n?void 0:n.href)||location.href,S=t.cssText;switch(t.type){case CSSRule.SUPPORTS_RULE:this.applyCSSRuleList(t.cssRules,s);break;case CSSRule.STYLE_RULE:{const n=this.session.unusedStyles,r={},o={},d=t.style,f=Array.from(d),g=f.length;let m=0;while(m<g){const e=f[m++];r[u(e)]=d[e]}const v=/\s*([a-z-]+):[^!;]+!important;/g;let w;while(w=v.exec(S)){const t=u(w[1]),i=null===(l=e[t])||void 0===l?void 0:l.value;if(Array.isArray(i)){m=0;while(m<i.length)o[i[m++]]=true}else o[t]=true}m=0;while(m<3){const e=_[m++],t=r[e];if(t&&"initial"!==t){let i;while(w=b.exec(t))if(w[2]){if(E){const[e,t]=w[2].trim().split(/\s*;\s*/);E.addRawData(w[1],e,w[3],{encoding:t})}}else{const e=p(w[3],x);if(""!==e){if(E)y(E,e);i=(i||t).replace(w[0],`url("${e}")`)}}if(i)r[e]=i;b.lastIndex=0}}for(const e of a(t.selectorText,true)){const t=i(e),[a,l]=e.split("::"),d=l?"::"+l:"",u=document.querySelectorAll(a||"*"),f=u.length;if(0!==f){m=0;while(m<f){const e=u[m++],i="styleMap"+d,n="styleSpecificity"+d,a=h(e,i,s);if(a){const i=h(e,n,s)||{};for(const e in r){const s=i[e],n=t+(o[e]?1e3:0);if(!s||n>=s)a[e]=r[e],i[e]=n}}else{const a=Object.assign({},r),l={};for(const e in a)l[e]=t+(o[e]?1e3:0);c(e,"sessionId","0",s),c(e,i,s,a),c(e,n,s,l)}}}else n.add(e)}break}case CSSRule.FONT_FACE_RULE:if(E){const e=null===(r=/\s*@font-face\s*{([^}]+)}\s*/.exec(S))||void 0===r?void 0:r[1];if(e){const t=null===(o=/\s*src:\s*([^;]+);/.exec(e))||void 0===o?void 0:o[1];let i=null===(d=/\s*font-family:([^;]+);/.exec(e))||void 0===d?void 0:d[1].trim();if(t&&i){i=v(i,'"');const s=(null===(f=/\s*font-style:\s*(\w+)\s*;/.exec(e))||void 0===f?void 0:f[1].toLowerCase())||"normal",n=parseInt((null===(g=/\s*font-weight:\s*(\d+)\s*;/.exec(e))||void 0===g?void 0:g[1])||"400");for(const e of t.split(",")){const t=/\s*(url|local)\((?:"((?:[^"]|\\")+)"|([^)]+))\)(?:\s*format\("?([\w-]+)"?\))?\s*/.exec(e);if(t){const e={fontFamily:i,fontWeight:n,fontStyle:s,srcFormat:(null===(m=t[4])||void 0===m?void 0:m.toLowerCase().trim())||"truetype"},a=(t[2]||t[3]).trim();if("url"===t[1])e.srcUrl=p(a,x);else e.srcLocal=a;E.addFont(e)}}}}}break}}applyStyleSheet(e,i){var s;try{const n=e.cssRules;if(n){const e=n.length;let a=0;while(a<e){const e=n[a++];switch(e.type){case CSSRule.STYLE_RULE:case CSSRule.FONT_FACE_RULE:this.applyStyleRule(e,i);break;case CSSRule.IMPORT_RULE:if(this._resourceHandler){const t=p(e.href,(null===(s=e.parentStyleSheet)||void 0===s?void 0:s.href)||location.href);if(""!==t)this._resourceHandler.addRawData(t,"text/css",void 0,{encoding:"utf8"})}this.applyStyleSheet(e.styleSheet,i);break;case CSSRule.MEDIA_RULE:if(t(e.conditionText||S("media",e.cssText)))this.applyCSSRuleList(e.cssRules,i);break;case CSSRule.SUPPORTS_RULE:if(CSS.supports(e.conditionText||S("supports",e.cssText)))this.applyCSSRuleList(e.cssRules,i);break}}}}catch(t){(this.userSettings.showErrorMessages?alert:console.log)("CSS cannot be parsed inside <link> tags when loading files directly from your hard drive or from external websites. Either use a local web server, embed your CSS into a <style> tag, or you can also try using a different browser. See the README for more detailed instructions.\n\n"+e.href+"\n\n"+t)}}applyCSSRuleList(e,t){const i=e.length;let s=0;while(s<i)this.applyStyleRule(e[s++],t)}get mainElement(){return document.documentElement}get initializing(){for(const e of this.session.active.values())if(e.initializing)return true;return false}get controllerHandler(){return this._controllerHandler}get resourceHandler(){return this._resourceHandler}get extensionManager(){return this._extensionManager}get extensionsCascade(){return[]}get childrenAll(){const e=this.session.active;if(1===e.size)return e.values().next().value.cache.children;let t=[];for(const i of e.values())t=t.concat(i.cache.children);return t}get nextId(){return++this._nextId}get length(){return this.session.active.size}}Application.KEY_NAME="squared.application";class Application$1 extends Application{constructor(e,t,i){super(e,t,i),this.systemName="vdom"}insertNode(e,t){return"#text"!==e.nodeName?new this.Node(this.nextId,t,e):void 0}}class Controller{constructor(e){this.application=e,this.localSettings={mimeType:{font:"*",image:"*",audio:"*",video:"*"}}}init(){}sortInitialCache(e){}applyDefaultStyles(e,t){}reset(){}includeElement(e){return true}preventNodeCascade(e){return false}get generateSessionId(){return Date.now().toString()+"-"+this.application.session.active.size}get afterInsertNode(){return e=>{}}get userSettings(){return this.application.userSettings}}const{USER_AGENT:w,isUserAgent:k}=squared.lib.client,{CSS_PROPERTIES:T,CSS_TRAITS:C,CSS_UNIT:I,checkStyleValue:N,checkWritingMode:P,formatPX:M,getInheritedStyle:A,getStyle:R,hasComputedStyle:B,isAngle:L,isLength:W,isPercent:H,isTime:F,isPx:O,parseSelectorText:U,parseUnit:z}=squared.lib.css,{ELEMENT_BLOCK:X,assignRect:q,getNamedItem:D,getRangeClientRect:j,newBoxRectDimension:V}=squared.lib.dom,{CSS:$,FILE:G}=squared.lib.regex,{actualClientRect:Y,actualTextRangeRect:Q,deleteElementCache:K,getElementAsNode:J,getElementCache:Z,getPseudoElt:ee,setElementCache:te}=squared.lib.session,{aboveRange:ie,belowRange:se,convertCamelCase:ne,convertFloat:ae,convertInt:le,hasBit:re,hasValue:oe,isNumber:he,isObject:ce,iterateArray:de,spliceString:ue,splitEnclosing:fe}=squared.lib.util,{SELECTOR_ATTR:ge,SELECTOR_G:me,SELECTOR_LABEL:pe,SELECTOR_PSEUDO_CLASS:ve}=$,be=T.borderTop.value,_e=T.borderRight.value,ye=T.borderBottom.value,Ee=T.borderLeft.value;function xe(e,t,i,s,n){if(n!==s)if(e.style.setProperty(t,s),we(s,e.style.getPropertyValue(t)))te(e,t,i,"auto"!==s?n:"");else return false;return true}function Se(e,t,i){const s=Z(e,t,i);if(void 0!==s)e.style.setProperty(t,s),K(e,t,i)}const we=(e,t)=>e===t||W(e,true)&&O(t),ke=(e,t)=>e.id<t.id?-1:1,Te=e=>parseFloat(e.getPropertyValue("font-size")),Ce=e=>/\dem$/.test(e),Ie=e=>/^(inline|table-cell)/.test(e);function Ne(e,t,i,s){const n=(s||e).css(t);if(he(n))return parseFloat(n);else if("inherit"===n&&!s)return Ne(e,t,i,e.actualParent);return i}function Pe(e,...t){const i=e.cssAscend("textAlign",{startSelf:e.textElement&&e.blockStatic&&!e.hasPX("width",{initial:true})});return""!==i&&t.includes(i)&&(e.blockStatic?e.textElement&&!e.hasPX("width",{initial:true})&&!e.hasPX("maxWidth",{initial:true}):e.display.startsWith("inline"))}function Me(e,t,i,s,n){const a={dimension:i},l=t[i],r=t[s],o=l?e.parseUnit(l,a):0;let h=Math.max(o,r?e.parseUnit(r,a):0);if(0===h&&e.styleElement){const t=e.element;switch(t.tagName){case"IMG":case"INPUT":if("image"!==t.type)break;case"TD":case"TH":case"SVG":case"IFRAME":case"VIDEO":case"AUDIO":case"CANVAS":case"OBJECT":case"EMBED":{const s=D(t,i);if(""!==s)if(h=he(s)?parseFloat(s):e.parseUnit(s,a),h>0)e.css(i,H(s)?s:s+"px");break}}}if(o>0&&!e.imageElement){const s=t[n];if(s)if(l===s)delete t[n];else{const a=e.parseUnit(s,{dimension:i});if(a>0)if(a<=o&&l&&W(l))t[i]=s,delete t[n];else return Math.min(h,a)}}return h}function Ae(e,t,i){if(!e.plainText){switch(e.css(i[1])){case"none":case"initial":case"hidden":return 0}const s=e.css(i[0]),n=W(s,true)?e.parseUnit(s,{dimension:t}):ae(e.style[i[0]]);if(n>0)return Math.max(Math.round(n),1)}return 0}function Re(e,t,i){var s;switch(e.display){case"table":if(!i&&"collapse"===e.css("borderCollapse"))return 0;break;case"table-row":return 0;case"table-cell":if(i){switch(e.tagName){case"TD":case"TH":return 0;default:{const i=e.ascend({condition:e=>"TABLE"===e.tagName})[0];if(i){const[s,n]=i.css("borderSpacing").split(" ");switch(t){case"marginTop":case"marginBottom":return n?e.parseUnit(n,{dimension:"height",parent:false}):e.parseUnit(s,{parent:false});case"marginRight":if(e.actualParent.lastChild!==e)return e.parseUnit(s,{parent:false});case"marginLeft":return 0}}break}}return 0}break}return e.parseUnit(e.css(t),{parent:!(true===(null===(s=e.actualParent)||void 0===s?void 0:s.gridElement))})}function Be(e,t){if(!e.positionStatic){const i=Fe.call(e,t,{modified:true});if(W(i))return e.parseUnit(i,{dimension:"left"===t||"right"===t?"width":"height"});else if(H(i)&&e.styleElement)return ae(e.style[t])}return 0}function Le(e,t,i,s,n,a){var l;if(i.all)return true;let r=i.tagName;if(r&&r!==t.tagName.toUpperCase())return false;if(i.id&&i.id!==t.elementId)return false;const{attrList:o,classList:h,notList:c,pseudoList:d}=i;if(d){const i=t.actualParent;r=t.tagName;let s=0;while(s<d.length){const o=d[s++];switch(o){case":first-child":case":nth-child(1)":if(t!==i.firstChild)return false;break;case":last-child":case":nth-last-child(1)":if(t!==i.lastChild)return false;break;case":only-child":if(i.naturalElements.length>1)return false;break;case":only-of-type":{const e=i.naturalElements,t=e.length;let s=0,n=0;while(s<t)if(e[s++].tagName===r&&++n>1)return false;break}case":first-of-type":{const e=i.naturalElements,s=e.length;let n=0;while(n<s){const i=e[n++];if(i.tagName===r){if(i!==t)return false;break}}break}case":nth-child(n)":case":nth-last-child(n)":break;case":empty":if(t.element.childNodes.length>0)return false;break;case":checked":switch(r){case"INPUT":if(!t.toElementBoolean("checked"))return false;break;case"OPTION":if(!t.toElementBoolean("selected"))return false;break;default:return false}break;case":enabled":if(!t.inputElement||t.toElementBoolean("disabled",true))return false;break;case":disabled":if(!t.inputElement||!t.toElementBoolean("disabled"))return false;break;case":read-only":{const e=t.element;if(e.isContentEditable||("INPUT"===r||"TEXTAREA"===r)&&!e.readOnly)return false;break}case":read-write":{const e=t.element;if(!e.isContentEditable||("INPUT"===r||"TEXTAREA"===r)&&e.readOnly)return false;break}case":required":if(!t.inputElement||"BUTTON"===r||!t.toElementBoolean("required"))return false;break;case":optional":if(!t.inputElement||"BUTTON"===r||t.toElementBoolean("required",true))return false;break;case":placeholder-shown":if(!(("INPUT"===r||"TEXTAREA"===r)&&""!==t.toElementString("placeholder")))return false;break;case":default":switch(r){case"INPUT":{const e=t.element;switch(e.type){case"radio":case"checkbox":if(!e.checked)return false;break;default:return false}break}case"OPTION":if(void 0===t.element.attributes.selected)return false;break;case"BUTTON":{const e=t.ascend({condition:e=>"FORM"===e.tagName})[0];if(e){let i=false;const s=t.element;if(de(e.element.querySelectorAll("*"),e=>{switch(e.tagName){case"BUTTON":return i=s===e,true;case"INPUT":switch(e.type){case"submit":case"image":return i=s===e,true}break}}),!i)return false}break}default:return false}break;case":in-range":case":out-of-range":if("INPUT"===r){const e=t.element,i=parseFloat(e.value);if(!isNaN(i)){const t=parseFloat(e.min),s=parseFloat(e.max);if(i>=t&&i<=s){if(":out-of-range"===o)return false}else if(":in-range"===o)return false}else if(":in-range"===o)return false}else return false;break;case":indeterminate":if("INPUT"===r){const e=t.element;switch(e.type){case"checkbox":if(!e.indeterminate)return false;break;case"radio":if(e.checked)return false;else if(e.name)if(de(((null===(l=t.ascend({condition:e=>"FORM"===e.tagName})[0])||void 0===l?void 0:l.element)||document).querySelectorAll(`input[type=radio][name="${e.name}"`),e=>e.checked)===1/0)return false;break;default:return false}}else if("PROGRESS"===r){if(-1!==t.toElementInt("value",-1))return false}else return false;break;case":target":if(""===location.hash)return false;else if(!(location.hash==="#"+t.elementId||"A"===r&&location.hash==="#"+t.toElementString("name")))return false;break;case":scope":if(!n||">"===a&&t!==e)return false;break;case":root":if(!n&&"HTML"!==e.tagName)return false;break;case":link":case":visited":case":any-link":case":hover":case":focus":case":focus-within":case":valid":case":invalid":{const e=t.element;if(de(i.element.querySelectorAll(":scope > "+o),t=>t===e)!==1/0)return false;break}default:{let e=/^:nth(-last)?-(child|of-type)\((.+)\)$/.exec(o);if(e){const s=e[3].trim();let n=i.naturalElements;if(e[1])n=n.slice(0).reverse();const a="child"===e[2]?n.indexOf(t)+1:n.filter(e=>e.tagName===r).indexOf(t)+1;if(a>0){if(he(s)){if(parseInt(s)!==a)return false}else switch(s){case"even":if(a%2!=0)return false;break;case"odd":if(a%2==0)return false;break;default:{const e=/^(-)?(\d+)?n\s*([+-]\d+)?$/.exec(s);if(e){const t=le(e[3]);if(e[2]){if(e[1])return false;const i=parseInt(e[2]);if(0!==i){if(a!==t)for(let e=i;;e+=i){const e=i+t;if(e===a)break;else if(e>a)return false}}else if(a!==t)return false}else if(e[3])if(t>0){if(e[1]){if(a>t)return false}else if(a<t)return false}else return false}break}}continue}}else if(t.attributes.lang)if(e=/^:lang\((.+)\)$/.exec(o),e)if(t.attributes.lang.trim().toLowerCase()===e[1].trim().toLowerCase())continue;return false}}}}if(c){let i=0;while(i<c.length){const a=c[i++],l={};switch(a.charAt(0)){case".":l.classList=[a];break;case"#":l.id=a.substring(1);break;case":":l.pseudoList=[a];break;case"[":{const e=ge.exec(a);if(e){const t="i"===e[6];let i=e[3]||e[4]||e[5]||"";if(t)i=i.toLowerCase();l.attrList=[{key:e[1],symbol:e[2],value:i,caseInsensitive:t}],ge.lastIndex=0}else continue;break}default:if(/^[a-z\d+#.-]+$/i.test(a))l.tagName=a;else return false;break}if(Le(e,t,l,s,n))return false}}if(h){const e=t.element.classList;let i=0;while(i<h.length)if(!e.contains(h[i++]))return false}if(o){const e=t.attributes;let i=0;while(i<o.length){const t=o[i++];let s;if(t.endsWith){const i=new RegExp(`^(.+:)?${t.key}$`);for(const t in e)if(i.test(t)){s=e[t];break}}else s=e[t.key];if(void 0===s)return false;else{const e=t.value;if(e){if(t.caseInsensitive)s=s.toLowerCase();if(t.symbol)switch(t.symbol){case"~":if(!s.split(/\s+/).includes(e))return false;break;case"^":if(!s.startsWith(e))return false;break;case"$":if(!s.endsWith(e))return false;break;case"*":if(!s.includes(e))return false;break;case"|":if(s!==e&&!s.startsWith(e+"-"))return false;break}else if(s!==e)return false}}}}return true}function We(e,t,i,s,n,a){const l=e.depth,r=t[s],o=t.length,h=s===o-1,c=[],d=a.length;let u=0;while(u<d){const t=a[u++];if(n){const s=t.actualParent;if(">"===n){if(Le(e,s,r,i,h,n))c.push(s)}else{const a=s.naturalElements;switch(n){case"+":{const s=a.indexOf(t)-1;if(s>=0){const t=a[s];if(Le(e,t,r,i,h,n))c.push(t)}break}case"~":{const s=a.length;let l=0;while(l<s){const s=a[l++];if(s===t)break;else if(Le(e,s,r,i,h,n))c.push(s)}break}}}}else if(t.depth-l>=o-s){let s=t.actualParent;do{if(Le(e,s,r,i,h))c.push(s);s=s.actualParent}while(null!==s)}}return c.length?++s===o?true:We(e,t,i,s,r.adjacent,c):false}const He=e=>e.naturalChild&&(0===e.length||Ie(e.display))&&!e.floating&&true!==e.autoMargin.horizontal;function Fe(e,t){return!this._preferInitial&&this._styleMap[e]||this.cssInitial(e,t)}class Node extends squared.lib.base.Container{constructor(e,t="0",i){if(super(),this.id=e,this.sessionId=t,this.documentRoot=false,this.depth=-1,this.childIndex=1/0,this._parent=null,this._cached={},this._preferInitial=false,this._element=null,this._data={},this._inlineText=false,i){if(this._element=i,this.style=!this.pseudoElement?R(i):R(i.parentElement,ee(i,t)),!this.syncWith(t))this._styleMap={};if("0"!==t)te(i,"node",t,this)}else this.style={},this._styleMap={}}init(e,t,i){this._parent=e,this.depth=t,this.childIndex=i}syncWith(e,t){const i=this._element;if(i){if(!e)if((e=Z(i,"sessionId","0"))===this.sessionId)return true;const s=Z(i,"styleMap",e);if(s){if(this.styleElement){const e=this.style,t={},n=e.writingMode;if(!this.pseudoElement){const e=Array.from(i.style),t=e.length;if(t>0){let n=0;while(n<t){const t=e[n++];s[ne(t)]=i.style.getPropertyValue(t)}}}for(let a in s){const l=s[a],r=P(a,n);if(""!==r)if(!s[r])a=r;else continue;const o=N(i,a,l,e);if(""!==o)t[a]=o}this._styleMap=t}else this._styleMap=s;if(this._cssStyle=s,t)this._cached={};return true}}return false}saveAsInitial(){this._initial={styleMap:Object.assign({},this._styleMap),children:this.length>0?this.duplicate():void 0,bounds:this._bounds}}data(e,t,i,s=true){const n=this._data;if(null===i){if(n[e])delete n[e][t];return}else if(void 0!==i){let a=n[e];if(!ce(a))a={},n[e]=a;if(s||void 0===a[t])a[t]=i}const a=n[e];return ce(a)?a[t]:void 0}unsetCache(...e){const t=e.length;if(t>0){const i=this._cached;let s=0;while(s<t){const t=e[s++];switch(t){case"position":if(!this._preferInitial)this.cascade(e=>!e.pageFlow&&e.unsetCache("absoluteParent"));case"display":case"float":case"tagName":return void(this._cached={});case"width":i.actualWidth=void 0,i.percentWidth=void 0;case"minWidth":i.width=void 0;break;case"height":i.actualHeight=void 0,i.percentHeight=void 0;case"minHeight":if(i.height=void 0,!this._preferInitial)this.unsetCache("blockVertical"),this.each(e=>e.unsetCache("height","actualHeight","blockVertical","overflow","bottomAligned"));break;case"verticalAlign":i.baseline=void 0;break;case"left":case"right":case"textAlign":i.rightAligned=void 0,i.centerAligned=void 0;break;case"top":case"bottom":i.bottomAligned=void 0;break;default:if(t.startsWith("margin"))i.autoMargin=void 0,i.rightAligned=void 0,i.centerAligned=void 0;else if(t.startsWith("padding"))i.contentBoxWidth=void 0,i.contentBoxHeight=void 0;else if(t.startsWith("border"))i.visibleStyle=void 0,i.contentBoxWidth=void 0,i.contentBoxHeight=void 0;else if(t.startsWith("background"))i.visibleStyle=void 0;else if(Node.TEXT_STYLE.includes(t))i.lineHeight=void 0,this._textStyle=void 0;break}if(t in i)i[t]=void 0}}else this._cached={},this._textStyle=void 0;if(!this._preferInitial){let t;if(e.some(e=>re(T[e].trait,4)))t=this.pageFlow&&this.ascend({condition:e=>e.documentRoot})[0]||this;else if(e.some(e=>re(T[e].trait,8)))t=this;if(t){t.resetBounds();const e=t.queryMap;if(e){const t=e.length;let i,s=0;while(s<t){const t=e[s++],n=t.length;i=0;while(i<n)t[i++].resetBounds()}}else this.cascade(e=>e.resetBounds())}}}ascend(e){let t=e.attr;if(!t)t="actualParent";else if(!/[pP]arent$/.test(t))return[];const{condition:i,including:s,error:n,every:a,excluding:l}=e,r=[];let o=e.startSelf?this:this[t];while(o&&o!==l){if(n&&n(o))break;if(i){if(i(o))if(r.push(o),!a)break}else r.push(o);if(o===s)break;o=o[t]}return r}intersectX(e,t="linear"){if(e.width>0){const{left:i,right:s}=this[t],{left:n,right:a}=e;return Math.ceil(i)>=n&&i<Math.floor(a)||Math.floor(s)>n&&s<=Math.ceil(a)||Math.ceil(n)>=i&&n<Math.floor(s)||Math.floor(a)>i&&a<=Math.ceil(s)}return false}intersectY(e,t="linear"){if(e.height>0){const{top:i,bottom:s}=this[t],{top:n,bottom:a}=e;return Math.ceil(i)>=n&&i<Math.floor(a)||Math.floor(s)>n&&s<=Math.ceil(a)||Math.ceil(n)>=i&&n<Math.floor(s)||Math.floor(a)>i&&a<=Math.ceil(s)}return false}withinX(e,t="linear"){if(this.pageFlow||e.width>0){const{left:i,right:s}=this[t];return ie(i,e.left)&&se(s,e.right)}return true}withinY(e,t="linear"){if(this.pageFlow||e.height>0){const{top:i,bottom:s}=this[t];return Math.ceil(i)>=e.top&&Math.floor(s)<=e.bottom}return true}outsideX(e,t="linear"){if(this.pageFlow||e.width>0){const{left:i,right:s}=this[t];return i<Math.floor(e.left)||s>Math.ceil(e.right)}return false}outsideY(e,t="linear"){if(this.pageFlow||e.height>0){const{top:i,bottom:s}=this[t];return i<Math.floor(e.top)||s>Math.ceil(e.bottom)}return false}css(e,t,i=true){if(t&&this.styleElement)if(this.style[e]=t,we(t,this.style[e])){if(this._styleMap[e]=t,i)this.unsetCache(e);return t}return this._styleMap[e]||this.styleElement&&this.style[e]||""}cssApply(e,t=true){for(const i in e){const s=e[i];if(this.css(i,s,t)===s&&t)this.unsetCache(i)}return this}cssParent(e,t,i=false){var s;return(null===(s=this.actualParent)||void 0===s?void 0:s.css(e,t,i))||""}cssInitial(e,t){var i;return((null===(i=this._initial)||void 0===i?void 0:i.styleMap)||this._styleMap)[e]||(null==t?void 0:t.modified)&&this._styleMap[e]||(null==t?void 0:t.computed)&&this.style[e]||""}cssAscend(e,t){let i,s;if(t)({startSelf:i,initial:s}=t);let n,a=i?this:this.actualParent;while(null!==a){if(n=s?a.cssInitial(e):a.css(e),""!==n)return n;if(a.documentBody)break;a=a.actualParent}return""}cssAny(e,t){const i=t.initial?this.cssInitial(e,t):this.css(e);return""!==i&&t.values.includes(i)}cssSort(e,t={}){const i=false!==t.ascending,s=true===t.byFloat,n=!s&&true===t.byInt;return(t.duplicate?this.duplicate():this.children).sort((t,a)=>{let l,r;if(s)l=t.toFloat(e,t.childIndex),r=a.toFloat(e,a.childIndex);else if(n)l=t.toInt(e,t.childIndex),r=a.toInt(e,a.childIndex);else l=t.css(e),r=a.css(e);if(l===r)return 0;else if(i)return l<r?-1:1;return l>r?-1:1})}cssPX(e,t,i,s){const n=this._styleMap[e];if(n&&W(n)){if((t+=z(n,this.fontSize))<0&&true!==(null==s?void 0:s.negative))t=0;const a=M(t);if(this.css(e,a),i)this.unsetCache(e);return a}return""}cssSpecificity(e){var t,i;if(this.styleElement){const s=this._element;return(this.pseudoElement?null===(t=Z(s.parentElement,"styleSpecificity"+ee(s,this.sessionId),this.sessionId))||void 0===t?void 0:t[e]:null===(i=Z(s,"styleSpecificity",this.sessionId))||void 0===i?void 0:i[e])||0}return 0}cssTry(e,t){if(this.styleElement){const i=this._element;return xe(i,e,this.sessionId,t,R(i).getPropertyValue(e))}return false}cssFinally(e){if(this.styleElement){const t=this._element;if("string"==typeof e)Se(t,e,this.sessionId);else for(const i in e)Se(t,i,this.sessionId)}}cssTryAll(e){if(this.styleElement){const t=[],i=this._element,s=R(i);for(const n in e)if(xe(i,n,this.sessionId,e[n],s.getPropertyValue(n)))t.push(n);else{let e=0;while(e<t.length)this.cssFinally(t[e++]);return}return e}}cssCopy(e,...t){const i=this._styleMap;let s=0;while(s<t.length){const n=t[s++];i[n]=e.css(n)}}cssCopyIfEmpty(e,...t){const i=this._styleMap;let s=0;while(s<t.length){const n=t[s++];if(!oe(i[n]))i[n]=e.css(n)}}cssAsTuple(...e){const t=e.length,i=new Array(t);let s=0;while(s<t)i[s]=this.css(e[s++]);return i}cssAsObject(...e){const t={};let i=0;while(i<e.length){const s=e[i++];t[s]=this.css(s)}return t}toInt(e,t=NaN,i=false){var s;const n=parseInt((i&&(null===(s=this._initial)||void 0===s?void 0:s.styleMap)||this._styleMap)[e]);return!isNaN(n)?n:t}toFloat(e,t=NaN,i=false){var s;const n=parseFloat((i&&(null===(s=this._initial)||void 0===s?void 0:s.styleMap)||this._styleMap)[e]);return!isNaN(n)?n:t}toElementInt(e,t=NaN){var i;const s=parseInt(null===(i=this._element)||void 0===i?void 0:i[e]);return!isNaN(s)?s:t}toElementFloat(e,t=NaN){var i;const s=parseFloat(null===(i=this._element)||void 0===i?void 0:i[e]);return!isNaN(s)?s:t}toElementBoolean(e,t=false){var i;const s=null===(i=this._element)||void 0===i?void 0:i[e];return"boolean"==typeof s?s:t}toElementString(e,t=""){var i,s;return(null!==(s=null===(i=this._element)||void 0===i?void 0:i[e])&&void 0!==s?s:t).toString()}parseUnit(e,t){var i;let s,n,a;if(t)({parent:s,dimension:n,screenDimension:a}=t);if(H(e)){const t=false!==s&&(null===(i=this.absoluteParent)||void 0===i?void 0:i.box)||this.bounds;let a=parseFloat(e)/100;switch(n){case"height":a*=t.height;break;default:a*=t.width;break}return a}return z(e,this.fontSize,a)}has(e,t){var i,s;const n=("initial"===(null==t?void 0:t.map)&&(null===(i=this._initial)||void 0===i?void 0:i.styleMap)||this._styleMap)[e];if(n){if("initial"===n||n===(null===(s=T[e])||void 0===s?void 0:s.value))return false;let i,a;if(t)({not:i,type:a}=t);if(i)if(n===i)return false;else if(Array.isArray(i)){let e=0;while(e<i.length)if(n===i[e++])return false}if(a)return re(a,1)&&W(n)||re(a,2)&&H(n)||re(a,4)&&F(n)||re(a,8)&&L(n);else return true}return false}hasPX(e,t){var i;let s,n;if(t)({initial:s,percent:n}=t);const a=(s&&(null===(i=this._initial)||void 0===i?void 0:i.styleMap)||this._styleMap)[e];return!!a&&W(a,false!==n)}setBounds(e=true){let t;if(this.styleElement){if(!e)K(this._element,"clientRect",this.sessionId);t=q(Y(this._element,this.sessionId)),this._bounds=t}else if(this.plainText){const e=j(this._element);t=q(e);const i=e.numberOfLines;t.numberOfLines=i,this._bounds=t,this._textBounds=t,this._cached.multiline=i>1}if(!e&&t)this._box=void 0,this._linear=void 0;return t}resetBounds(){this._bounds=void 0,this._box=void 0,this._linear=void 0,this._textBounds=void 0,this._cached.multiline=void 0}querySelector(e){return this.querySelectorAll(e,1)[0]||null}querySelectorAll(e,t=-1){let i=[];const s=this.queryMap;if(s&&0!==t){const n=U(e);let a=n.length,l=0;while(l<a){const e=n[l++],r=[];let o=-1;if("*"===e)r.push({all:true}),++o;else{e:{let t,i;while(i=me.exec(e)){let e=i[1],s=false;if(1===e.length){const i=e.charAt(0);switch(i){case"+":case"~":--o;case">":if(t||0===r.length){r.length=0;break e}t=i;continue;case"*":s=true;break}}else if(e.startsWith("*|*")){if(e.length>3){r.length=0;break e}s=true}else if(e.startsWith("*|"))e=e.substring(2);else if(e.startsWith("::")){r.length=0;break e}if(s)r.push({all:true});else{let i,s,n,a,l,o,h;while(h=ge.exec(e)){if(!a)a=[];let t=h[1].replace("\\:",":"),i=false;switch(t.indexOf("|")){case-1:break;case 1:if("*"===t.charAt(0)){i=true,t=t.substring(2);break}default:r.length=0;break e}const s="i"===h[6];let n=h[3]||h[4]||h[5]||"";if(s)n=n.toLowerCase();a.push({key:t,symbol:h[2],value:n,endsWith:i,caseInsensitive:s}),e=ue(e,h.index,h[0].length)}if(e.includes("::")){r.length=0;break e}while(h=ve.exec(e)){const t=h[0];if(t.startsWith(":not(")){if(h[1]){if(!o)o=[];o.push(h[1])}}else{if(!l)l=[];l.push(t)}e=ue(e,h.index,t.length)}while(h=pe.exec(e)){const t=h[0];switch(t.charAt(0)){case"#":s=t.substring(1);break;case".":if(!n)n=[];n.push(t.substring(1));break;default:i=t.toUpperCase();break}e=ue(e,h.index,t.length)}r.push({tagName:i,id:s,adjacent:t,classList:n,pseudoList:l,notList:o,attrList:a})}++o,t=void 0}}me.lastIndex=0}if(a=s.length,r.length>0&&-1!==o&&o<a){const e=r.pop(),h=0===r.length,c=i.length;let d;if(e.all&&a-o==1)d=s[o];else{d=[];let t=o;while(t<a){const n=s[t++];if(e.all)d=d.concat(n);else{const t=n.length;let s=0;while(s<t){const t=n[s++];if((0===c||!i.includes(t))&&Le(this,t,e,l,h))d.push(t)}}}}if(r.length>0){r.reverse();let s=c;const n=d.length;let a=0;while(a<n){const n=d[a++];if((0===c||!i.includes(n))&&We(this,r,l,0,e.adjacent,[n]))if(i.push(n),++s===t)return i.sort(ke)}}else if(0===c)if(l===n.length-1||t>0&&t<=d.length){if(t>0&&d.length>t)d.length=t;return d.sort(ke)}else i=d;else{const e=d.length;if(t>0){let s=c,n=0;while(n<e){const e=d[n++];if(!i.includes(e))if(i.push(e),++s===t)return i.sort(ke)}}else{let t=0;while(t<e){const e=d[t++];if(!i.includes(e))i.push(e)}}}}}}return i.sort(ke)}set parent(e){if(e){const t=this._parent;if(e!==t)null==t||t.remove(this),this._parent=e,e.add(this);else if(!e.contains(this))e.add(this);if(-1===this.depth)this.depth=e.depth+1}}get parent(){return this._parent}get tagName(){const e=this._cached.tagName;if(void 0===e){const e=this._element;if(e){const t=e.nodeName;return this._cached.tagName="#"===t.charAt(0)?t:e.tagName}return this._cached.tagName=""}return e}get element(){return this._element}get elementId(){var e;return((null===(e=this._element)||void 0===e?void 0:e.id)||"").trim()}get htmlElement(){const e=this._cached.htmlElement;return void 0===e?this._cached.htmlElement=!this.plainText&&this._element instanceof HTMLElement:e}get svgElement(){const e=this._cached.svgElement;return void 0===e?this._cached.svgElement=!this.htmlElement&&!this.plainText&&this._element instanceof SVGElement||this.imageElement&&G.SVG.test(this.toElementString("src")):e}get styleElement(){return this.htmlElement||this.svgElement}get naturalChild(){return true}get naturalElement(){const e=this._cached.naturalElement;return void 0===e?this._cached.naturalElement=this.naturalChild&&this.styleElement&&!this.pseudoElement:e}get parentElement(){var e,t;return(null===(e=this._element)||void 0===e?void 0:e.parentElement)||(null===(t=this.actualParent)||void 0===t?void 0:t.element)||null}get textElement(){return this.plainText||this.inlineText&&"BUTTON"!==this.tagName}get pseudoElement(){return false}get imageElement(){return"IMG"===this.tagName}get flexElement(){return this.display.endsWith("flex")}get gridElement(){return this.display.endsWith("grid")}get tableElement(){return"TABLE"===this.tagName||"table"===this.display}get inputElement(){switch(this.tagName){case"INPUT":case"BUTTON":case"SELECT":case"TEXTAREA":return true;default:return false}}get plainText(){return"#text"===this.tagName}get styleText(){return this.naturalElement&&this.inlineText}get lineBreak(){return"BR"===this.tagName}get display(){return this.css("display")}get positionRelative(){return"relative"===this.css("position")}get floating(){return"none"!==this.float}get float(){return this.pageFlow&&this.css("float")||"none"}get zIndex(){return this.toInt("zIndex",0)}get textContent(){return this.naturalChild&&!this.svgElement?this._element.textContent:""}get dataset(){if(this.styleElement)return this._element.dataset;else{const e=this._dataset;return void 0===e?this._dataset={}:e}}get documentBody(){return this._element===document.body}get initial(){return this._initial}get bounds(){return this._bounds||this.setBounds(false)||q(this.boundingClientRect)}get linear(){if(void 0===this._linear){const e=this.bounds;if(e){if(this.styleElement){const{marginBottom:t,marginRight:i}=this,s=Math.max(this.marginTop,0),n=Math.max(this.marginLeft,0);return this._linear={top:e.top-s,right:e.right+i,bottom:e.bottom+t,left:e.left-n,width:e.width+n+i,height:e.height+s+t}}return this._linear=e}return V()}return this._linear}get box(){if(void 0===this._box){const e=this.bounds;if(e)if(this.styleElement&&this.naturalChildren.length>0)return this._box={top:e.top+(this.paddingTop+this.borderTopWidth),right:e.right-(this.paddingRight+this.borderRightWidth),bottom:e.bottom-(this.paddingBottom+this.borderBottomWidth),left:e.left+(this.paddingLeft+this.borderLeftWidth),width:e.width-this.contentBoxWidth,height:e.height-this.contentBoxHeight};else return this._box=e;return V()}return this._box}get flexdata(){const e=this._cached.flexdata;if(void 0===e){if(this.flexElement){const{flexWrap:e,flexDirection:t,alignContent:i,justifyContent:s}=this.cssAsObject("flexWrap","flexDirection","alignContent","justifyContent"),n=t.startsWith("row");return this._cached.flexdata={row:n,column:!n,reverse:t.endsWith("reverse"),wrap:e.startsWith("wrap"),wrapReverse:"wrap-reverse"===e,alignContent:i,justifyContent:s}}return this._cached.flexdata={}}return e}get flexbox(){const e=this._cached.flexbox;if(void 0===e){if(this.styleElement&&this.actualParent.flexElement){const[e,t,i]=this.cssAsTuple("alignSelf","justifySelf","flexBasis");return this._cached.flexbox={alignSelf:"auto"===e?this.cssParent("alignItems"):e,justifySelf:"auto"===t?this.cssParent("justifyItems"):t,basis:i,grow:Ne(this,"flexGrow",0),shrink:Ne(this,"flexShrink",1),order:this.toInt("order",0)}}return this._cached.flexbox={}}return e}get width(){const e=this._cached.width;return void 0===e?this._cached.width=Me(this,this._styleMap,"width","minWidth","maxWidth"):e}get height(){const e=this._cached.height;return void 0===e?this._cached.height=Me(this,this._styleMap,"height","minHeight","maxHeight"):e}get hasWidth(){const e=this._cached.hasWidth;return void 0===e?this._cached.hasWidth=this.width>0:e}get hasHeight(){var e;const t=this._cached.hasHeight;if(void 0===t){const t=this.css("height");if(H(t))return this._cached.hasHeight=this.pageFlow?(null===(e=this.actualParent)||void 0===e?void 0:e.hasHeight)||this.documentBody:"fixed"===this.css("position")||this.hasPX("top")||this.hasPX("bottom");else return this._cached.hasHeight=this.height>0||this.hasPX("height",{percent:false})}return t}get lineHeight(){var e;let t=this._cached.lineHeight;if(void 0===t){if(!this.imageElement&&!this.svgElement){let i=this.has("lineHeight"),s=0;if(i){const t=this.css("lineHeight");if(H(t))s=ae(this.style.lineHeight);else if(he(t))s=parseFloat(t)*this.fontSize;else if(s=z(t,this.fontSize),O(t)&&"inherit"!==(null===(e=this._cssStyle)||void 0===e?void 0:e.lineHeight)){const e=Fe.call(this,"fontSize");if(Ce(e))s*=parseFloat(e)}}else{let e=this.ascend({condition:e=>e.has("lineHeight")})[0];if(e){const t=e.css("lineHeight");if(he(t))s=parseFloat(t)*this.fontSize,i=true}if(0===s)if(e=this.ascend({condition:e=>e.lineHeight>0})[0],e)s=e.lineHeight;if(this.styleElement){const e=Fe.call(this,"fontSize");if(Ce(e)){const t=parseFloat(e);if(1!==t)s*=t,this.css("lineHeight",M(s)),i=true}}}t=i||s>this.height||this.multiline||this.block&&this.naturalChildren.some(e=>e.textElement)?s:0}else t=0;this._cached.lineHeight=t}return t}get positionStatic(){var e;let t=this._cached.positionStatic;if(void 0===t){switch(this.css("position")){case"absolute":case"fixed":t=false;break;case"relative":t=!this.documentBody&&0===this.toFloat("top",0)&&0===this.toFloat("right",0)&&0===this.toFloat("bottom",0)&&0===this.toFloat("left",0),this._cached.positionRelative=!t;break;case"inherit":{const i=null===(e=this._element)||void 0===e?void 0:e.parentElement;if(i){const e=A(i,"position");t="static"===e||"initial"===e;break}}default:t=true;break}this._cached.positionStatic=t}return t}get top(){const e=this._cached.top;return void 0===e?this._cached.top=Be(this,"top"):e}get right(){const e=this._cached.right;return void 0===e?this._cached.right=Be(this,"right"):e}get bottom(){const e=this._cached.bottom;return void 0===e?this._cached.bottom=Be(this,"bottom"):e}get left(){const e=this._cached.left;return void 0===e?this._cached.left=Be(this,"left"):e}get marginTop(){const e=this._cached.marginTop;return void 0===e?this._cached.marginTop=this.inlineStatic?0:Re(this,"marginTop",true):e}get marginRight(){const e=this._cached.marginRight;return void 0===e?this._cached.marginRight=Re(this,"marginRight",true):e}get marginBottom(){const e=this._cached.marginBottom;return void 0===e?this._cached.marginBottom=this.inlineStatic?0:Re(this,"marginBottom",true):e}get marginLeft(){const e=this._cached.marginLeft;return void 0===e?this._cached.marginLeft=Re(this,"marginLeft",true):e}get borderTopWidth(){const e=this._cached.borderTopWidth;return void 0===e?this._cached.borderTopWidth=Ae(this,"height",be):e}get borderRightWidth(){const e=this._cached.borderRightWidth;return void 0===e?this._cached.borderRightWidth=Ae(this,"height",_e):e}get borderBottomWidth(){const e=this._cached.borderBottomWidth;return void 0===e?this._cached.borderBottomWidth=Ae(this,"width",ye):e}get borderLeftWidth(){const e=this._cached.borderLeftWidth;return void 0===e?this._cached.borderLeftWidth=Ae(this,"width",Ee):e}get paddingTop(){const e=this._cached.paddingTop;return void 0===e?this._cached.paddingTop=Re(this,"paddingTop",false):e}get paddingRight(){const e=this._cached.paddingRight;return void 0===e?this._cached.paddingRight=Re(this,"paddingRight",false):e}get paddingBottom(){const e=this._cached.paddingBottom;return void 0===e?this._cached.paddingBottom=Re(this,"paddingBottom",false):e}get paddingLeft(){const e=this._cached.paddingLeft;return void 0===e?this._cached.paddingLeft=Re(this,"paddingLeft",false):e}get contentBox(){return"border-box"!==this.css("boxSizing")||this.tableElement&&k(4)}get contentBoxWidth(){const e=this._cached.contentBoxWidth;if(void 0===e)return this._cached.contentBoxWidth=this.tableElement&&"collapse"===this.css("borderCollapse")?0:this.borderLeftWidth+this.paddingLeft+this.paddingRight+this.borderRightWidth;else return e}get contentBoxHeight(){const e=this._cached.contentBoxHeight;if(void 0===e)return this._cached.contentBoxHeight=this.tableElement&&"collapse"===this.css("borderCollapse")?0:this.borderTopWidth+this.paddingTop+this.paddingBottom+this.borderBottomWidth;else return e}get inline(){const e=this._cached.inline;if(void 0===e){const e=this.display;return this._cached.inline="inline"===e||"initial"===e&&!X.includes(this.tagName)}return e}get inlineStatic(){const e=this._cached.inlineStatic;return void 0===e?this._cached.inlineStatic=this.inline&&this.pageFlow&&!this.floating&&!this.imageElement:e}set inlineText(e){switch(this.tagName){case"IMG":case"INPUT":case"SELECT":case"TEXTAREA":case"SVG":case"BR":case"HR":case"PROGRESS":case"METER":case"CANVAS":this._inlineText=false;break;case"BUTTON":this._inlineText=""!==this.textContent.trim();break;default:this._inlineText=e;break}}get inlineText(){return this._inlineText}get block(){let e=this._cached.block;if(void 0===e){switch(this.display){case"block":case"flex":case"grid":case"list-item":e=true;break;case"initial":e=X.includes(this.tagName);break;case"inline":if("svg"===this.tagName&&this.actualParent.htmlElement){e=!this.hasPX("width")&&0===ae(D(this._element,"width"));break}default:e=false;break}this._cached.block=e}return e}get blockStatic(){const e=this._cached.blockStatic;if(void 0===e){const e=this.pageFlow;if(e&&(this.block&&!this.floating||this.lineBreak))return this._cached.blockStatic=true;else if(!e||!this.inline&&!this.display.startsWith("table-")&&!this.hasPX("maxWidth")){const e=Fe.call(this,"width"),t=Fe.call(this,"minWidth");let i=0;if(H(e))i=parseFloat(e);if(H(t))i=Math.max(parseFloat(t),i);if(i>0){const e=Fe.call(this,"marginLeft"),t=Fe.call(this,"marginRight");return this._cached.blockStatic=i+(H(e)?parseFloat(e):0)+(H(t)?parseFloat(t):0)>=100}}return this._cached.blockStatic=false}return e}get pageFlow(){const e=this._cached.pageFlow;return void 0===e?this._cached.pageFlow=this.positionStatic||this.positionRelative:e}get centerAligned(){const e=this._cached.centerAligned;if(void 0===e)return this._cached.centerAligned=!this.pageFlow?this.hasPX("left")&&this.hasPX("right"):this.autoMargin.leftRight||He(this)&&Pe(this,"center");else return e}get rightAligned(){const e=this._cached.rightAligned;if(void 0===e)return this._cached.rightAligned=!this.pageFlow?this.hasPX("right")&&!this.hasPX("left"):"right"===this.float||this.autoMargin.left||He(this)&&Pe(this,"right","end");else return e}get bottomAligned(){var e;const t=this._cached.bottomAligned;if(void 0===t)return this._cached.bottomAligned=!this.pageFlow?this.hasPX("bottom")&&!this.hasPX("top"):true===(null===(e=this.actualParent)||void 0===e?void 0:e.hasHeight)&&true===this.autoMargin.top;else return t}get autoMargin(){const e=this._cached.autoMargin;if(void 0===e){if(!this.pageFlow||this.blockStatic||"table"===this.display){const e=this._styleMap,t="auto"===e.marginLeft&&(this.pageFlow||this.hasPX("right")),i="auto"===e.marginRight&&(this.pageFlow||this.hasPX("left")),s="auto"===e.marginTop&&(this.pageFlow||this.hasPX("bottom")),n="auto"===e.marginBottom&&(this.pageFlow||this.hasPX("top"));return this._cached.autoMargin={horizontal:t||i,left:t&&!i,right:!t&&i,leftRight:t&&i,vertical:s||n,top:s&&!n,bottom:!s&&n,topBottom:s&&n}}return this._cached.autoMargin={}}return e}get baseline(){const e=this._cached.baseline;if(void 0===e){if(this.pageFlow&&!this.floating){const e=this.css("verticalAlign");return this._cached.baseline="baseline"===e||"initial"===e||0===this.naturalElements.length&&W(e,true)}return this._cached.baseline=false}return e}get verticalAlign(){let e=this._cached.verticalAlign;if(void 0===e){if(this.pageFlow){if(e=this.css("verticalAlign"),W(e,true))e=this.parseUnit(e,{dimension:"height"})+"px"}else e="0px";this._cached.verticalAlign=e}return e}set textBounds(e){this._textBounds=e}get textBounds(){const e=this._textBounds;if(void 0===e){if(this.naturalChild)if(this.textElement)return this._textBounds=Q(this._element,this.sessionId);else{const e=this.naturalChildren,t=e.length;if(t>0){let i=1/0,s=-1/0,n=-1/0,a=1/0,l=0,r=0;while(r<t){const t=e[r++];if(t.textElement){const e=Q(t.element,t.sessionId);i=Math.min(e.top,i),s=Math.max(e.right,s),a=Math.min(e.left,a),n=Math.max(e.bottom,n),l+=e.numberOfLines||0}}if(l>0)return this._textBounds={top:i,right:s,left:a,bottom:n,width:s-a,height:n-i,numberOfLines:l}}}return this._textBounds=null}return e}get multiline(){var e;const t=this._cached.multiline;if(void 0===t)return this._cached.multiline=this.styleText?(this.inline||0===this.naturalElements.length||Ie(this.display)||this.floating)&&(null===(e=this.textBounds)||void 0===e?void 0:e.numberOfLines)>1:this.plainText&&Math.floor(j(this._element).width)>this.actualParent.box.width;else return t}get backgroundColor(){let e=this._cached.backgroundColor;if(void 0===e){if(!this.plainText)switch(e=this.css("backgroundColor"),e){case"initial":case"transparent":case"rgba(0, 0, 0, 0)":if(e="",this.inputElement)if("BUTTON"===this.tagName)e="rgba(0, 0, 0, 0)";else switch(this.toElementString("type")){case"button":case"submit":case"reset":case"image":e="rgba(0, 0, 0, 0)";break}break;default:if(""!==e&&this.styleElement&&!this.inputElement&&(!this._initial||Fe.call(this,"backgroundColor")===e)){let t=this.actualParent;while(null!==t){const i=Fe.call(t,"backgroundColor",{modified:true});if(""!==i){if(i===e&&""===t.backgroundColor)e="";break}t=t.actualParent}}break}else e="";this._cached.backgroundColor=e}return e}get backgroundImage(){let e=this._cached.backgroundImage;if(void 0===e){if(!this.plainText){let t=this.css("backgroundImage");if(""!==t&&"none"!==t&&"initial"!==t)e=t;else{e="";const i=/\s*(url|[a-z-]+gradient)/;if(t=this.css("background"),i.test(t)){const s=fe(t),n=s.length;for(let t=1;t<n;++t){const n=s[t-1].trim();if(i.test(n))e+=(""!==e?", ":"")+n+s[t]}}}}else e="";this._cached.backgroundImage=e}return e}get percentWidth(){const e=this._cached.percentWidth;if(void 0===e){const e=Fe.call(this,"width");return this._cached.percentWidth=H(e)?parseFloat(e)/100:0}return e}get percentHeight(){var e;const t=this._cached.percentHeight;if(void 0===t){const t=Fe.call(this,"height");return this._cached.percentHeight=H(t)&&((null===(e=this.actualParent)||void 0===e?void 0:e.hasHeight)||"fixed"===this.css("position"))?parseFloat(t)/100:0}return t}get visibleStyle(){const e=this._cached.visibleStyle;if(void 0===e){if(!this.plainText){const e=this.borderTopWidth>0||this.borderRightWidth>0||this.borderBottomWidth>0||this.borderLeftWidth>0,t=""!==this.backgroundColor,i=""!==this.backgroundImage;let s=false,n=false;if(i)for(const e of this.css("backgroundRepeat").split(",")){const[t,i]=e.trim().split(" ");if(!s)s="repeat"===t||"repeat-x"===t;if(!n)n="repeat"===t||"repeat-y"===t||"repeat"===i}return this._cached.visibleStyle={background:e||i||t,borderWidth:e,backgroundImage:i,backgroundColor:t,backgroundRepeat:s||n,backgroundRepeatX:s,backgroundRepeatY:n}}return this._cached.visibleStyle={}}return e}get absoluteParent(){let e=this._cached.absoluteParent;if(void 0===e){if(e=this.actualParent,!this.pageFlow&&!this.documentBody)while(e&&!e.documentBody){switch(Fe.call(e,"position",{computed:true})){case"static":case"initial":case"unset":e=e.actualParent;continue}break}this._cached.absoluteParent=e}return e}set actualParent(e){this._cached.actualParent=e}get actualParent(){var e;const t=this._cached.actualParent;if(void 0===t){const t=null===(e=this._element)||void 0===e?void 0:e.parentElement;return this._cached.actualParent=t&&J(t,this.sessionId)||null}return t}get actualWidth(){var e;let t=this._cached.actualWidth;if(void 0===t){if(this.plainText){const e=this.bounds;switch(e.numberOfLines||1){case 1:t=e.width;break;case 2:t=Math.min(e.width,this.actualParent.box.width);break;default:t=Math.min(e.right-e.left,this.actualParent.box.width);break}}else if(this.inlineStatic||"table-cell"===this.display||true===(null===(e=this.actualParent)||void 0===e?void 0:e.flexdata.row))t=this.bounds.width;else if(t=this.width,t>0){if(this.contentBox&&!this.tableElement)t+=this.contentBoxWidth}else t=this.bounds.width;this._cached.actualWidth=t}return t}get actualHeight(){var e;let t=this._cached.actualHeight;if(void 0===t){if(this.inlineStatic||"table-cell"===this.display||true===(null===(e=this.actualParent)||void 0===e?void 0:e.flexdata.column))t=this.bounds.height;else if(t=this.height,t>0){if(this.contentBox&&!this.tableElement)t+=this.contentBoxHeight}else t=this.bounds.height;this._cached.actualHeight=t}return t}get actualDimension(){return{width:this.actualWidth,height:this.actualHeight}}set naturalChildren(e){this._naturalChildren=e}get naturalChildren(){return this._naturalChildren||function(e){var t;let i;if(e.naturalElement){i=[];const t=e.sessionId;let s=0;e.element.childNodes.forEach(e=>{const n=J(e,t);if(n)n.childIndex=s++,i.push(n)})}else i=((null===(t=e.initial)||void 0===t?void 0:t.children)||e.children).slice(0);return e.naturalChildren=i,i}(this)}set naturalElements(e){this._naturalElements=e}get naturalElements(){return this._naturalElements||function(e){const t=e.naturalChildren.filter(e=>e.naturalElement);return e.naturalElements=t,t}(this)}get firstChild(){return this.naturalElements[0]||null}get lastChild(){const e=this.naturalElements,t=e.length;return t?e[t-1]:null}get previousSibling(){var e;return(null===(e=this.actualParent)||void 0===e?void 0:e.naturalChildren[this.childIndex-1])||null}get nextSibling(){var e;return(null===(e=this.actualParent)||void 0===e?void 0:e.naturalChildren[this.childIndex+1])||null}get previousElementSibling(){var e;const t=null===(e=this.actualParent)||void 0===e?void 0:e.naturalElements;if(t){const e=t.indexOf(this);if(e>0)return t[e-1]}return null}get nextElementSibling(){var e;const t=null===(e=this.actualParent)||void 0===e?void 0:e.naturalElements;if(t){const e=t.indexOf(this);if(-1!==e)return t[e+1]||null}return null}get attributes(){let e=this._cached.attributes;if(void 0===e){if(e={},this.styleElement){const t=this._element.attributes,i=t.length;let s=0;while(s<i){const i=t.item(s++);e[i.name]=i.value}}this._cached.attributes=e}return e}get boundingClientRect(){var e;return this.naturalElement&&(null===(e=this._element)||void 0===e?void 0:e.getBoundingClientRect())||this._bounds||V()}get fontSize(){var e,t,i,s;let n=this._fontSize;if(void 0===n){if(this.naturalChild&&this.styleElement){const i=Fe.call(this,"fontSize");if(O(i))n=parseFloat(i);else if(H(i)&&this._element!==document.documentElement)n=(null!==(t=null===(e=this.actualParent)||void 0===e?void 0:e.fontSize)&&void 0!==t?t:Te(R(this._element.parentElement||document.documentElement)))*parseFloat(i)/100;else n=Te(this.style)}else n=z(this.css("fontSize"));if(0===n&&!this.naturalChild){const e=this.element;n=e&&B(e)?(null===(i=J(e,this.sessionId))||void 0===i?void 0:i.fontSize)||Te(R(e)):(null===(s=this.ascend({condition:e=>e.fontSize>0})[0])||void 0===s?void 0:s.fontSize)||Te(R(document.documentElement))}this._fontSize=n}return n}get cssStyle(){return Object.assign({},this._cssStyle)}get textStyle(){let e=this._textStyle;if(void 0===e)e=this.cssAsObject(...Node.TEXT_STYLE),e.fontSize=this.fontSize+"px",this._textStyle=e;return e}set dir(e){this._cached.dir=e}get dir(){let e=this._cached.dir;if(void 0===e){if(e=this.naturalElement?this._element.dir:"",""===e){let t=this.actualParent;while(null!==t){if(e=t.dir,""!==e)break;t=t.actualParent}}this._cached.dir=e}return e}get center(){const e=this.bounds;return{x:(e.left+e.right)/2,y:(e.top+e.bottom)/2}}}Node.BOX_POSITION=["top","right","bottom","left"],Node.TEXT_STYLE=["fontFamily","fontWeight","fontStyle","fontVariant","fontStretch","color","whiteSpace","textDecoration","textTransform","letterSpacing","wordSpacing"];const Oe={builtInExtensions:[],createElementMap:true,createQuerySelectorMap:true,showErrorMessages:false};let Ue,ze=false;const Xe={base:{Application:Application$1},lib:{},extensions:{},system:{},create:()=>(Ue=new Application$1(1,Node,Controller),ze=true,{application:Ue,framework:1,userSettings:Object.assign({},Oe)}),cached(){if(ze)return{application:Ue,framework:1,userSettings:Ue.userSettings};else return Xe.create()}};return Xe}));
