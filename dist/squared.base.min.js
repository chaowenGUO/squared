!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(((e=e||self).squared=e.squared||{},e.squared.base={}))}(this,(function(e){"use strict";class NodeList extends squared.lib.base.Container{constructor(e){super(e)}add(e,t=false,i=false){var s;if(super.add(e),t)null===(s=this.afterAdd)||void 0===s||s.call(this,e,i);return this}reset(){return this.clear(),this}}const{CSS_PROPERTIES:t,checkMediaRule:i,getSpecificity:s,hasComputedStyle:n,insertStyleSheetRule:a,parseSelectorText:r}=squared.lib.css,{FILE:l,STRING:o}=squared.lib.regex,{frameworkNotInstalled:c,getElementCache:h,setElementCache:d}=squared.lib.session,{capitalize:u,convertCamelCase:f,parseMimeType:g,plainMap:p,promisify:m,resolvePath:b,trimBoth:x}=squared.lib.util,y=new RegExp(`url\\("?(${o.DATAURI})"?\\),?\\s*`,"g"),v=["backgroundImage","listStyleImage","content"];function w(e,t,i=0,s=0){if(""!==t)if(i>0&&s>0||!e.getImage(t))e.addUnsafeData("image",t,{width:i,height:s,uri:t})}function S(e,t){if(""!==t)for(const i of t.split(","))w(e,b(i.trim().split(" ")[0]))}const E=e=>l.SVG.test(e),_=(e,t)=>{var i;return(null===(i=new RegExp(`\\s*@${e}([^{]+)`).exec(t))||void 0===i?void 0:i[1].trim())||t};class Application{constructor(e,t,i,s,n){if(this.framework=e,this.builtInExtensions={},this.extensions=[],this.closed=false,this.elementMap=new Map,this.session={active:new Map,unusedStyles:new Set},this._nextId=0,this._controllerHandler=new i(this),s)this._resourceHandler=new s(this);if(n)this._extensionManager=new n(this);this._afterInsertNode=this._controllerHandler.afterInsertNode,this.Node=t}afterCreateCache(e){if(this.userSettings.createElementMap){const t=this.elementMap;this.getProcessingCache(e.sessionId).each(e=>t.set(e.element,e))}}createNode(e,t){const i=new this.Node(this.nextId,e,t.element);return this.controllerHandler.afterInsertNode(i),i}copyToDisk(e,t){var i,s;return(null===(s=null===(i=this._resourceHandler)||void 0===i?void 0:i.fileHandler)||void 0===s?void 0:s.copyToDisk(e,t))||c()}appendToArchive(e,t){var i,s;return(null===(s=null===(i=this._resourceHandler)||void 0===i?void 0:i.fileHandler)||void 0===s?void 0:s.appendToArchive(e,t))||c()}saveToArchive(e,t){var i;const s=this._resourceHandler;return s&&(null===(i=s.fileHandler)||void 0===i?void 0:i.saveToArchive(e||s.userSettings.outputArchiveName,t))||c()}createFrom(e,t){var i,s;return(null===(s=null===(i=this._resourceHandler)||void 0===i?void 0:i.fileHandler)||void 0===s?void 0:s.createFrom(e,t))||c()}appendFromArchive(e,t){var i,s;return(null===(s=null===(i=this._resourceHandler)||void 0===i?void 0:i.fileHandler)||void 0===s?void 0:s.appendFromArchive(e,t))||c()}finalize(){return this.closed}reset(){var e;this._nextId=0,this.elementMap.clear(),this.session.active.clear(),this.session.unusedStyles.clear(),this.controllerHandler.reset(),null===(e=this.resourceHandler)||void 0===e||e.reset();for(const e of this.extensions)e.subscribers.clear();this.closed=false}parseDocument(...e){const t=this._resourceHandler,i=true===(null==t?void 0:t.userSettings.preloadImages),s=this._controllerHandler.generateSessionId,r=new Set,l=[],o={cache:new NodeList,excluded:new NodeList,rootElements:r,initializing:false};let c,h;this.session.active.set(s,o),this._controllerHandler.init(),this.setStyleMap(s);const d=a("html > body { overflow: hidden !important; }");if(0===e.length)c=this.mainElement,r.add(c);else{let t=0;while(t<e.length){let i=e[t++];if("string"==typeof i)i=document.getElementById(i);if(i&&n(i)){if(!c)c=i;r.add(i)}}}if(!c)return Promise.reject(new Error("Document root not found."));if(t)for(const e of r)e.querySelectorAll("picture > source").forEach(e=>S(t,e.srcset)),e.querySelectorAll("video").forEach(e=>w(t,e.poster)),e.querySelectorAll("input[type=image]").forEach(e=>w(t,e.src,e.width,e.height)),e.querySelectorAll("object, embed").forEach(e=>{const i=e.data||e.src;if(i&&(e.type.startsWith("image/")||g(i).startsWith("image/")))w(t,i.trim())}),e.querySelectorAll("svg use").forEach(e=>{const i=e.href.baseVal||e.getAttributeNS("xlink","href");if(i&&i.indexOf("#")>0){const e=b(i.split("#")[0]);if(E(e))w(t,e)}});const u=()=>{const t=this.extensions;let i,n;if(o.initializing=false,h){n=h.length,i=0;while(i<n){const e=h[i++];if(e.parentElement)c.removeChild(e)}}n=t.length,i=0;while(i<n)t[i++].beforeParseDocument(s);const a=[];for(const e of r){const t=this.createCache(e,s);if(t)this.afterCreateCache(t),a.push(t)}i=0;while(i<n)t[i++].afterParseDocument(s);try{document.head.removeChild(d)}catch(e){}return e.length>1?a:a[0]};if(i){const{image:e,rawData:i}=t.mapOfAssets;h=[];for(const t of e.values()){const e=t.uri;if(E(e))l.push(e);else if(0===t.width||0===t.height){const i=document.createElement("img");if(i.src=e,i.naturalWidth>0&&i.naturalHeight>0)t.width=i.naturalWidth,t.height=i.naturalHeight;else c.appendChild(i),h.push(i)}}for(const[t,s]of i.entries()){const i=s.mimeType;if((null==i?void 0:i.startsWith("image/"))&&!i.endsWith("svg+xml")){const n=document.createElement("img");n.src=`data:${i};${s.base64?"base64,"+s.base64:s.content}`;const{naturalWidth:a,naturalHeight:r}=n;if(a>0&&r>0)s.width=a,s.height=r,e.set(t,{width:a,height:r,uri:s.filename});else document.body.appendChild(n),h.push(n)}}}if(t)for(const e of r)e.querySelectorAll("img").forEach(e=>{if(S(t,e.srcset),!i)t.addImage(e);else if(E(e.src))l.push(e.src);else if(e.complete)t.addImage(e);else l.push(e)});if(l.length>0)return o.initializing=true,Promise.all(p(l,e=>new Promise((t,i)=>{if("string"==typeof e)fetch(e,{method:"GET",headers:new Headers({Accept:"application/xhtml+xml, image/svg+xml","Content-Type":"image/svg+xml"})}).then(async e=>t(await e.text()));else e.addEventListener("load",()=>t(e)),e.addEventListener("error",()=>i(e))}))).then(e=>{const i=e.length;for(let s=0;s<i;++s){const i=e[s];if("string"==typeof i){const e=l[s];if("string"==typeof e)t.addRawData(e,"image/svg+xml",i,{encoding:"utf8"})}else t.addImage(i)}return u()}).catch(e=>{if(e instanceof Event)e=e.target;const t=e instanceof HTMLImageElement?e.src:"";return""===t||!this.userSettings.showErrorMessages||confirm("FAIL: "+t)?u():Promise.reject(t)});else return m(u)()}createCache(e,t){const i=this.createRootNode(e,t);if(i)this.controllerHandler.sortInitialCache(this.getProcessingCache(t));return i}setStyleMap(e){const t=document.styleSheets,s=t.length;let n=0;while(n<s){const s=t[n++];let a;try{a=s.media.mediaText}catch(e){}if(!a||i(a))this.applyStyleSheet(s,e)}}getProcessing(e){return this.session.active.get(e)}getProcessingCache(e){var t;return(null===(t=this.session.active.get(e))||void 0===t?void 0:t.cache)||new NodeList}getDatasetName(e,t){return t.dataset[e+u(this.systemName)]||t.dataset[e]}setDatasetName(e,t,i){t.dataset[e+u(this.systemName)]=i}toString(){return this.systemName}createRootNode(e,t){const i=this.getProcessing(t),s=this.extensionsCascade,n=this.cascadeParentNode(i.cache,i.excluded,i.rootElements,e,t,0,s.length>0?s:void 0);if(n){const s=new this.Node(0,t,e.parentElement);if(this._afterInsertNode(s),n.parent=s,n.actualParent=s,"HTML"===n.tagName)i.documentElement=n;else if("HTML"===s.tagName)i.documentElement=s;n.depth=0,n.childIndex=0,n.documentRoot=true,i.node=n}return n}cascadeParentNode(e,t,i,s,n,a,r){const l=this.insertNode(s,n);if(l){const o=this.controllerHandler;if(0===a)e.add(l);if(o.preventNodeCascade(l))return l;const c=a+1,h=s.childNodes,d=h.length,u=new Array(d),f=new Array(s.childElementCount);let g=true,p=0,m=0,b=0;while(p<d){const s=h[p++];let a;if("#"===s.nodeName.charAt(0)){if("#text"===s.nodeName)a=this.insertNode(s,n),null==a||a.cssApply(l.textStyle)}else if(o.includeElement(s)){if(a=this.cascadeParentNode(e,t,i,s,n,c,r),a)f[b++]=a,g=false}else if(a=this.insertNode(s,n),a)t.add(a),g=false;if(a)a.init(l,c,m),a.actualParent=l,u[m++]=a,e.add(a)}if(u.length=m,f.length=b,l.naturalChildren=u,l.naturalElements=f,l.inlineText=g,l.retainAs(u),b>0&&this.userSettings.createQuerySelectorMap)l.queryMap=this.createQueryMap(f,b)}return l}createQueryMap(e,t){var i;const s=[e];let n=0;while(n<t){const t=e[n++].queryMap;if(t){const e=t.length;for(let n=0;n<e;++n){const e=n+1;s[e]=(null===(i=s[e])||void 0===i?void 0:i.concat(t[n]))||t[n]}}}return s}applyStyleRule(e,i){var n,a,l,o,c,u,g,p;const m=this._resourceHandler,S=(null===(n=e.parentStyleSheet)||void 0===n?void 0:n.href)||location.href,E=e.cssText;switch(e.type){case CSSRule.SUPPORTS_RULE:this.applyCSSRuleList(e.cssRules,i);break;case CSSRule.STYLE_RULE:{const n=this.session.unusedStyles,l={},o={},c=e.style,u=Array.from(c),g=u.length;let p=0;while(p<g){const e=u[p++];l[f(e)]=c[e]}const x=/\s*([a-z-]+):[^!;]+!important;/g;let _;while(_=x.exec(E)){const e=f(_[1]),i=null===(a=t[e])||void 0===a?void 0:a.value;if(Array.isArray(i)){p=0;while(p<i.length)o[i[p++]]=true}else o[e]=true}p=0;while(p<3){const e=v[p++],t=l[e];if(t&&"initial"!==t){let i;while(_=y.exec(t))if(_[2]){if(m){const[e,t]=_[2].trim().split(/\s*;\s*/);m.addRawData(_[1],e,_[3],{encoding:t})}}else{const e=b(_[3],S);if(""!==e){if(m)w(m,e);i=(i||t).replace(_[0],`url("${e}")`)}}if(i)l[e]=i;y.lastIndex=0}}for(const t of r(e.selectorText,true)){const e=s(t),[a,r]=t.split("::"),c=r?"::"+r:"",u=document.querySelectorAll(a||"*"),f=u.length;if(0!==f){p=0;while(p<f){const t=u[p++],s="styleMap"+c,n="styleSpecificity"+c,a=h(t,s,i);if(a){const s=h(t,n,i)||{};for(const t in l){const i=s[t],n=e+(o[t]?1e3:0);if(!i||n>=i)a[t]=l[t],s[t]=n}}else{const a=Object.assign({},l),r={};for(const t in a)r[t]=e+(o[t]?1e3:0);d(t,"sessionId","0",i),d(t,s,i,a),d(t,n,i,r)}}}else n.add(t)}break}case CSSRule.FONT_FACE_RULE:if(m){const e=null===(l=/\s*@font-face\s*{([^}]+)}\s*/.exec(E))||void 0===l?void 0:l[1];if(e){const t=null===(o=/\s*src:\s*([^;]+);/.exec(e))||void 0===o?void 0:o[1];let i=null===(c=/\s*font-family:([^;]+);/.exec(e))||void 0===c?void 0:c[1].trim();if(t&&i){i=x(i,'"');const s=(null===(u=/\s*font-style:\s*(\w+)\s*;/.exec(e))||void 0===u?void 0:u[1].toLowerCase())||"normal",n=parseInt((null===(g=/\s*font-weight:\s*(\d+)\s*;/.exec(e))||void 0===g?void 0:g[1])||"400");for(const e of t.split(",")){const t=/\s*(url|local)\((?:"((?:[^"]|\\")+)"|([^)]+))\)(?:\s*format\("?([\w-]+)"?\))?\s*/.exec(e);if(t){const e={fontFamily:i,fontWeight:n,fontStyle:s,srcFormat:(null===(p=t[4])||void 0===p?void 0:p.toLowerCase().trim())||"truetype"},a=(t[2]||t[3]).trim();if("url"===t[1])e.srcUrl=b(a,S);else e.srcLocal=a;m.addFont(e)}}}}}break}}applyStyleSheet(e,t){var s;try{const n=e.cssRules;if(n){const e=n.length;let a=0;while(a<e){const e=n[a++];switch(e.type){case CSSRule.STYLE_RULE:case CSSRule.FONT_FACE_RULE:this.applyStyleRule(e,t);break;case CSSRule.IMPORT_RULE:if(this._resourceHandler){const t=b(e.href,(null===(s=e.parentStyleSheet)||void 0===s?void 0:s.href)||location.href);if(""!==t)this._resourceHandler.addRawData(t,"text/css",void 0,{encoding:"utf8"})}this.applyStyleSheet(e.styleSheet,t);break;case CSSRule.MEDIA_RULE:if(i(e.conditionText||_("media",e.cssText)))this.applyCSSRuleList(e.cssRules,t);break;case CSSRule.SUPPORTS_RULE:if(CSS.supports(e.conditionText||_("supports",e.cssText)))this.applyCSSRuleList(e.cssRules,t);break}}}}catch(t){(this.userSettings.showErrorMessages?alert:console.log)("CSS cannot be parsed inside <link> tags when loading files directly from your hard drive or from external websites. Either use a local web server, embed your CSS into a <style> tag, or you can also try using a different browser. See the README for more detailed instructions.\n\n"+e.href+"\n\n"+t)}}applyCSSRuleList(e,t){const i=e.length;let s=0;while(s<i)this.applyStyleRule(e[s++],t)}get mainElement(){return document.documentElement}get initializing(){for(const e of this.session.active.values())if(e.initializing)return true;return false}get controllerHandler(){return this._controllerHandler}get resourceHandler(){return this._resourceHandler}get extensionManager(){return this._extensionManager}get extensionsCascade(){return[]}get childrenAll(){const e=this.session.active;if(1===e.size)return e.values().next().value.cache.children;let t=[];for(const i of e.values())t=t.concat(i.cache.children);return t}get nextId(){return++this._nextId}get length(){return this.session.active.size}}Application.KEY_NAME="squared.application";class Controller{constructor(e){this.application=e,this.localSettings={mimeType:{font:"*",image:"*",audio:"*",video:"*"}}}init(){}sortInitialCache(e){}applyDefaultStyles(e,t){}reset(){}includeElement(e){return true}preventNodeCascade(e){return false}get generateSessionId(){return Date.now().toString()+"-"+this.application.session.active.size}get afterInsertNode(){return e=>{}}get userSettings(){return this.application.userSettings}}class Extension{constructor(e,t,i){if(this.name=e,this.framework=t,this.options={},this.dependencies=[],this.subscribers=new Set,i)Object.assign(this.options,i)}require(e,t=false){this.dependencies.push({name:e,preload:t})}beforeParseDocument(e){}afterParseDocument(e){}set application(e){this._application=e,this._controller=e.controllerHandler}get application(){return this._application}get controller(){return this._controller}}const{hasBit:k,isObject:T}=squared.lib.util;const{frameworkNotInstalled:C}=squared.lib.session,{fromLastIndexOf:A,trimEnd:I}=squared.lib.util;class File{constructor(){this.assets=[]}static downloadFile(e,t,i){const s=new Blob([e],{type:i||"application/octet-stream"}),n=window.URL.createObjectURL(s),a=document.createElement("a");if(a.style.setProperty("display","none"),a.setAttribute("href",n),a.setAttribute("download",t),!a.download)a.setAttribute("target","_blank");const r=document.body;r.appendChild(a),a.click(),r.removeChild(a),setTimeout(()=>window.URL.revokeObjectURL(n),1)}getDataMap(e){}getCopyQueryParameters(e){return""}getArchiveQueryParameters(e){return""}createFrom(e,t){return this.archiving(Object.assign(Object.assign({filename:this.userSettings.outputArchiveName},t),{format:e}))}appendFromArchive(e,t){return this.archiving(Object.assign(Object.assign({filename:this.userSettings.outputArchiveName},t),{appendTo:e,format:e.substring(e.lastIndexOf(".")+1)}))}addAsset(e){if(e.content||e.bytes||e.base64||e.uri){const{pathname:t,filename:i}=e,s=this.assets.find(e=>e.pathname===t&&e.filename===i);if(s)Object.assign(s,e);else this.assets.push(e)}}reset(){this.assets.length=0}copying(e){if(this.hasHttpProtocol()){const t=this.createRequestBody(e.assets,e);if(t&&e.directory)return fetch(this.hostname+"/api/assets/copy?to="+encodeURIComponent(e.directory.trim())+"&empty="+(this.userSettings.outputEmptyCopyDirectory?"1":"0")+this.getCopyQueryParameters(e),{method:"POST",headers:new Headers({Accept:"application/json, text/plain","Content-Type":"application/json"}),body:JSON.stringify(t)}).then(async e=>await e.json()).then(t=>{if(t){if("function"==typeof e.callback)e.callback(t);if(t.system)(this.userSettings.showErrorMessages?alert:console.log)(t.application+"\n\n"+t.system)}return t})}else(this.userSettings.showErrorMessages?alert:console.log)("SERVER (required): See README for instructions");return C()}archiving(e){if(this.hasHttpProtocol()){const t=this.createRequestBody(e.assets,e);if(t&&e.filename)return fetch(this.hostname+"/api/assets/archive?filename="+encodeURIComponent(e.filename.trim())+"&format="+(e.format||this.userSettings.outputArchiveFormat).trim().toLowerCase()+"&to="+encodeURIComponent((e.copyTo||"").trim())+"&append_to="+encodeURIComponent((e.appendTo||"").trim())+this.getArchiveQueryParameters(e),{method:"POST",headers:new Headers({Accept:"application/json, text/plain","Content-Type":"application/json"}),body:JSON.stringify(t)}).then(async e=>await e.json()).then(t=>{if(t){if("function"==typeof e.callback)e.callback(t);const i=t.zipname;if(i)fetch("/api/browser/download?filepath="+encodeURIComponent(i)).then(async e=>File.downloadFile(await e.blob(),A(i,"/","\\")));else if(t.system)(this.userSettings.showErrorMessages?alert:console.log)(t.application+"\n\n"+t.system)}return t})}else(this.userSettings.showErrorMessages?alert:console.log)("SERVER (required): See README for instructions");return C()}createRequestBody(e,t){const i=e?e.concat(this.assets):this.assets,s=i[0];if(s){if(t.exclusions)s.exclusions=t.exclusions;const e=this.getDataMap(t);if(e)s.dataMap=e;return i}}hasHttpProtocol(){return(this._hostname||location.protocol).startsWith("http")}set hostname(e){if(null==e?void 0:e.startsWith("http"))this._hostname=I(e,"/")}get hostname(){return this._hostname||location.origin}}const{USER_AGENT:R,isUserAgent:N}=squared.lib.client,{CSS_PROPERTIES:P,CSS_TRAITS:M,CSS_UNIT:B,checkStyleValue:L,checkWritingMode:W,formatPX:F,getInheritedStyle:O,getStyle:U,hasComputedStyle:H,isAngle:D,isLength:V,isPercent:q,isTime:z,isPx:X,parseSelectorText:G,parseUnit:j}=squared.lib.css,{ELEMENT_BLOCK:Y,assignRect:$,getNamedItem:K,getRangeClientRect:Q,newBoxRectDimension:J}=squared.lib.dom,{CSS:Z,FILE:ee}=squared.lib.regex,{actualClientRect:te,actualTextRangeRect:ie,deleteElementCache:se,getElementAsNode:ne,getElementCache:ae,getPseudoElt:re,setElementCache:le}=squared.lib.session,{aboveRange:oe,belowRange:ce,convertCamelCase:he,convertFloat:de,convertInt:ue,hasBit:fe,hasValue:ge,isNumber:pe,isObject:me,iterateArray:be,spliceString:xe,splitEnclosing:ye}=squared.lib.util,{SELECTOR_ATTR:ve,SELECTOR_G:we,SELECTOR_LABEL:Se,SELECTOR_PSEUDO_CLASS:Ee}=Z,_e=P.borderTop.value,ke=P.borderRight.value,Te=P.borderBottom.value,Ce=P.borderLeft.value;function Ae(e,t,i,s,n){if(n!==s)if(e.style.setProperty(t,s),Re(s,e.style.getPropertyValue(t)))le(e,t,i,"auto"!==s?n:"");else return false;return true}function Ie(e,t,i){const s=ae(e,t,i);if(void 0!==s)e.style.setProperty(t,s),se(e,t,i)}const Re=(e,t)=>e===t||V(e,true)&&X(t),Ne=(e,t)=>e.id<t.id?-1:1,Pe=e=>parseFloat(e.getPropertyValue("font-size")),Me=e=>/\dem$/.test(e),Be=e=>/^(inline|table-cell)/.test(e);function Le(e,t,i,s){const n=(s||e).css(t);if(pe(n))return parseFloat(n);else if("inherit"===n&&!s)return Le(e,t,i,e.actualParent);return i}function We(e,...t){const i=e.cssAscend("textAlign",{startSelf:e.textElement&&e.blockStatic&&!e.hasPX("width",{initial:true})});return""!==i&&t.includes(i)&&(e.blockStatic?e.textElement&&!e.hasPX("width",{initial:true})&&!e.hasPX("maxWidth",{initial:true}):e.display.startsWith("inline"))}function Fe(e,t,i,s,n){const a={dimension:i},r=t[i],l=t[s],o=r?e.parseUnit(r,a):0;let c=Math.max(o,l?e.parseUnit(l,a):0);if(0===c&&e.styleElement){const t=e.element;switch(t.tagName){case"IMG":case"INPUT":if("image"!==t.type)break;case"TD":case"TH":case"SVG":case"IFRAME":case"VIDEO":case"AUDIO":case"CANVAS":case"OBJECT":case"EMBED":{const s=K(t,i);if(""!==s)if(c=pe(s)?parseFloat(s):e.parseUnit(s,a),c>0)e.css(i,q(s)?s:s+"px");break}}}if(o>0&&!e.imageElement){const s=t[n];if(s)if(r===s)delete t[n];else{const a=e.parseUnit(s,{dimension:i});if(a>0)if(a<=o&&r&&V(r))t[i]=s,delete t[n];else return Math.min(c,a)}}return c}function Oe(e,t,i){if(!e.plainText){switch(e.css(i[1])){case"none":case"initial":case"hidden":return 0}const s=e.css(i[0]),n=V(s,true)?e.parseUnit(s,{dimension:t}):de(e.style[i[0]]);if(n>0)return Math.max(Math.round(n),1)}return 0}function Ue(e,t,i){var s;switch(e.display){case"table":if(!i&&"collapse"===e.css("borderCollapse"))return 0;break;case"table-row":return 0;case"table-cell":if(i){switch(e.tagName){case"TD":case"TH":return 0;default:{const i=e.ascend({condition:e=>"TABLE"===e.tagName})[0];if(i){const[s,n]=i.css("borderSpacing").split(" ");switch(t){case"marginTop":case"marginBottom":return n?e.parseUnit(n,{dimension:"height",parent:false}):e.parseUnit(s,{parent:false});case"marginRight":if(e.actualParent.lastChild!==e)return e.parseUnit(s,{parent:false});case"marginLeft":return 0}}break}}return 0}break}return e.parseUnit(e.css(t),{parent:!(true===(null===(s=e.actualParent)||void 0===s?void 0:s.gridElement))})}function He(e,t){if(!e.positionStatic){const i=ze.call(e,t,{modified:true});if(V(i))return e.parseUnit(i,{dimension:"left"===t||"right"===t?"width":"height"});else if(q(i)&&e.styleElement)return de(e.style[t])}return 0}function De(e,t,i,s,n,a){var r;if(i.all)return true;let l=i.tagName;if(l&&l!==t.tagName.toUpperCase())return false;if(i.id&&i.id!==t.elementId)return false;const{attrList:o,classList:c,notList:h,pseudoList:d}=i;if(d){const i=t.actualParent;l=t.tagName;let s=0;while(s<d.length){const o=d[s++];switch(o){case":first-child":case":nth-child(1)":if(t!==i.firstChild)return false;break;case":last-child":case":nth-last-child(1)":if(t!==i.lastChild)return false;break;case":only-child":if(i.naturalElements.length>1)return false;break;case":only-of-type":{const e=i.naturalElements,t=e.length;let s=0,n=0;while(s<t)if(e[s++].tagName===l&&++n>1)return false;break}case":first-of-type":{const e=i.naturalElements,s=e.length;let n=0;while(n<s){const i=e[n++];if(i.tagName===l){if(i!==t)return false;break}}break}case":nth-child(n)":case":nth-last-child(n)":break;case":empty":if(t.element.childNodes.length>0)return false;break;case":checked":switch(l){case"INPUT":if(!t.toElementBoolean("checked"))return false;break;case"OPTION":if(!t.toElementBoolean("selected"))return false;break;default:return false}break;case":enabled":if(!t.inputElement||t.toElementBoolean("disabled",true))return false;break;case":disabled":if(!t.inputElement||!t.toElementBoolean("disabled"))return false;break;case":read-only":{const e=t.element;if(e.isContentEditable||("INPUT"===l||"TEXTAREA"===l)&&!e.readOnly)return false;break}case":read-write":{const e=t.element;if(!e.isContentEditable||("INPUT"===l||"TEXTAREA"===l)&&e.readOnly)return false;break}case":required":if(!t.inputElement||"BUTTON"===l||!t.toElementBoolean("required"))return false;break;case":optional":if(!t.inputElement||"BUTTON"===l||t.toElementBoolean("required",true))return false;break;case":placeholder-shown":if(!(("INPUT"===l||"TEXTAREA"===l)&&""!==t.toElementString("placeholder")))return false;break;case":default":switch(l){case"INPUT":{const e=t.element;switch(e.type){case"radio":case"checkbox":if(!e.checked)return false;break;default:return false}break}case"OPTION":if(void 0===t.element.attributes.selected)return false;break;case"BUTTON":{const e=t.ascend({condition:e=>"FORM"===e.tagName})[0];if(e){let i=false;const s=t.element;if(be(e.element.querySelectorAll("*"),e=>{switch(e.tagName){case"BUTTON":return i=s===e,true;case"INPUT":switch(e.type){case"submit":case"image":return i=s===e,true}break}}),!i)return false}break}default:return false}break;case":in-range":case":out-of-range":if("INPUT"===l){const e=t.element,i=parseFloat(e.value);if(!isNaN(i)){const t=parseFloat(e.min),s=parseFloat(e.max);if(i>=t&&i<=s){if(":out-of-range"===o)return false}else if(":in-range"===o)return false}else if(":in-range"===o)return false}else return false;break;case":indeterminate":if("INPUT"===l){const e=t.element;switch(e.type){case"checkbox":if(!e.indeterminate)return false;break;case"radio":if(e.checked)return false;else if(e.name)if(be(((null===(r=t.ascend({condition:e=>"FORM"===e.tagName})[0])||void 0===r?void 0:r.element)||document).querySelectorAll(`input[type=radio][name="${e.name}"`),e=>e.checked)===1/0)return false;break;default:return false}}else if("PROGRESS"===l){if(-1!==t.toElementInt("value",-1))return false}else return false;break;case":target":if(""===location.hash)return false;else if(!(location.hash==="#"+t.elementId||"A"===l&&location.hash==="#"+t.toElementString("name")))return false;break;case":scope":if(!n||">"===a&&t!==e)return false;break;case":root":if(!n&&"HTML"!==e.tagName)return false;break;case":link":case":visited":case":any-link":case":hover":case":focus":case":focus-within":case":valid":case":invalid":{const e=t.element;if(be(i.element.querySelectorAll(":scope > "+o),t=>t===e)!==1/0)return false;break}default:{let e=/^:nth(-last)?-(child|of-type)\((.+)\)$/.exec(o);if(e){const s=e[3].trim();let n=i.naturalElements;if(e[1])n=n.slice(0).reverse();const a="child"===e[2]?n.indexOf(t)+1:n.filter(e=>e.tagName===l).indexOf(t)+1;if(a>0){if(pe(s)){if(parseInt(s)!==a)return false}else switch(s){case"even":if(a%2!=0)return false;break;case"odd":if(a%2==0)return false;break;default:{const e=/^(-)?(\d+)?n\s*([+-]\d+)?$/.exec(s);if(e){const t=ue(e[3]);if(e[2]){if(e[1])return false;const i=parseInt(e[2]);if(0!==i){if(a!==t)for(let e=i;;e+=i){const e=i+t;if(e===a)break;else if(e>a)return false}}else if(a!==t)return false}else if(e[3])if(t>0){if(e[1]){if(a>t)return false}else if(a<t)return false}else return false}break}}continue}}else if(t.attributes.lang)if(e=/^:lang\((.+)\)$/.exec(o),e)if(t.attributes.lang.trim().toLowerCase()===e[1].trim().toLowerCase())continue;return false}}}}if(h){let i=0;while(i<h.length){const a=h[i++],r={};switch(a.charAt(0)){case".":r.classList=[a];break;case"#":r.id=a.substring(1);break;case":":r.pseudoList=[a];break;case"[":{const e=ve.exec(a);if(e){const t="i"===e[6];let i=e[3]||e[4]||e[5]||"";if(t)i=i.toLowerCase();r.attrList=[{key:e[1],symbol:e[2],value:i,caseInsensitive:t}],ve.lastIndex=0}else continue;break}default:if(/^[a-z\d+#.-]+$/i.test(a))r.tagName=a;else return false;break}if(De(e,t,r,s,n))return false}}if(c){const e=t.element.classList;let i=0;while(i<c.length)if(!e.contains(c[i++]))return false}if(o){const e=t.attributes;let i=0;while(i<o.length){const t=o[i++];let s;if(t.endsWith){const i=new RegExp(`^(.+:)?${t.key}$`);for(const t in e)if(i.test(t)){s=e[t];break}}else s=e[t.key];if(void 0===s)return false;else{const e=t.value;if(e){if(t.caseInsensitive)s=s.toLowerCase();if(t.symbol)switch(t.symbol){case"~":if(!s.split(/\s+/).includes(e))return false;break;case"^":if(!s.startsWith(e))return false;break;case"$":if(!s.endsWith(e))return false;break;case"*":if(!s.includes(e))return false;break;case"|":if(s!==e&&!s.startsWith(e+"-"))return false;break}else if(s!==e)return false}}}}return true}function Ve(e,t,i,s,n,a){const r=e.depth,l=t[s],o=t.length,c=s===o-1,h=[],d=a.length;let u=0;while(u<d){const t=a[u++];if(n){const s=t.actualParent;if(">"===n){if(De(e,s,l,i,c,n))h.push(s)}else{const a=s.naturalElements;switch(n){case"+":{const s=a.indexOf(t)-1;if(s>=0){const t=a[s];if(De(e,t,l,i,c,n))h.push(t)}break}case"~":{const s=a.length;let r=0;while(r<s){const s=a[r++];if(s===t)break;else if(De(e,s,l,i,c,n))h.push(s)}break}}}}else if(t.depth-r>=o-s){let s=t.actualParent;do{if(De(e,s,l,i,c))h.push(s);s=s.actualParent}while(null!==s)}}return h.length?++s===o?true:Ve(e,t,i,s,l.adjacent,h):false}const qe=e=>e.naturalChild&&(0===e.length||Be(e.display))&&!e.floating&&true!==e.autoMargin.horizontal;function ze(e,t){return!this._preferInitial&&this._styleMap[e]||this.cssInitial(e,t)}class Node extends squared.lib.base.Container{constructor(e,t="0",i){if(super(),this.id=e,this.sessionId=t,this.documentRoot=false,this.depth=-1,this.childIndex=1/0,this._parent=null,this._cached={},this._preferInitial=false,this._element=null,this._data={},this._inlineText=false,i){if(this._element=i,this.style=!this.pseudoElement?U(i):U(i.parentElement,re(i,t)),!this.syncWith(t))this._styleMap={};if("0"!==t)le(i,"node",t,this)}else this.style={},this._styleMap={}}init(e,t,i){this._parent=e,this.depth=t,this.childIndex=i}syncWith(e,t){const i=this._element;if(i){if(!e)if((e=ae(i,"sessionId","0"))===this.sessionId)return true;const s=ae(i,"styleMap",e);if(s){if(this.styleElement){const e=this.style,t={},n=e.writingMode;if(!this.pseudoElement){const e=Array.from(i.style),t=e.length;if(t>0){let n=0;while(n<t){const t=e[n++];s[he(t)]=i.style.getPropertyValue(t)}}}for(let a in s){const r=s[a],l=W(a,n);if(""!==l)if(!s[l])a=l;else continue;const o=L(i,a,r,e);if(""!==o)t[a]=o}this._styleMap=t}else this._styleMap=s;if(this._cssStyle=s,t)this._cached={};return true}}return false}saveAsInitial(){this._initial={styleMap:Object.assign({},this._styleMap),children:this.length>0?this.duplicate():void 0,bounds:this._bounds}}data(e,t,i,s=true){const n=this._data;if(null===i){if(n[e])delete n[e][t];return}else if(void 0!==i){let a=n[e];if(!me(a))a={},n[e]=a;if(s||void 0===a[t])a[t]=i}const a=n[e];return me(a)?a[t]:void 0}unsetCache(...e){const t=e.length;if(t>0){const i=this._cached;let s=0;while(s<t){const t=e[s++];switch(t){case"position":if(!this._preferInitial)this.cascade(e=>!e.pageFlow&&e.unsetCache("absoluteParent"));case"display":case"float":case"tagName":return void(this._cached={});case"width":i.actualWidth=void 0,i.percentWidth=void 0;case"minWidth":i.width=void 0;break;case"height":i.actualHeight=void 0,i.percentHeight=void 0;case"minHeight":if(i.height=void 0,!this._preferInitial)this.unsetCache("blockVertical"),this.each(e=>e.unsetCache("height","actualHeight","blockVertical","overflow","bottomAligned"));break;case"verticalAlign":i.baseline=void 0;break;case"left":case"right":case"textAlign":i.rightAligned=void 0,i.centerAligned=void 0;break;case"top":case"bottom":i.bottomAligned=void 0;break;default:if(t.startsWith("margin"))i.autoMargin=void 0,i.rightAligned=void 0,i.centerAligned=void 0;else if(t.startsWith("padding"))i.contentBoxWidth=void 0,i.contentBoxHeight=void 0;else if(t.startsWith("border"))i.visibleStyle=void 0,i.contentBoxWidth=void 0,i.contentBoxHeight=void 0;else if(t.startsWith("background"))i.visibleStyle=void 0;else if(Node.TEXT_STYLE.includes(t))i.lineHeight=void 0,this._textStyle=void 0;break}if(t in i)i[t]=void 0}}else this._cached={},this._textStyle=void 0;if(!this._preferInitial){let t;if(e.some(e=>fe(P[e].trait,4)))t=this.pageFlow&&this.ascend({condition:e=>e.documentRoot})[0]||this;else if(e.some(e=>fe(P[e].trait,8)))t=this;if(t){t.resetBounds();const e=t.queryMap;if(e){const t=e.length;let i,s=0;while(s<t){const t=e[s++],n=t.length;i=0;while(i<n)t[i++].resetBounds()}}else this.cascade(e=>e.resetBounds())}}}ascend(e){let t=e.attr;if(!t)t="actualParent";else if(!/[pP]arent$/.test(t))return[];const{condition:i,including:s,error:n,every:a,excluding:r}=e,l=[];let o=e.startSelf?this:this[t];while(o&&o!==r){if(n&&n(o))break;if(i){if(i(o))if(l.push(o),!a)break}else l.push(o);if(o===s)break;o=o[t]}return l}intersectX(e,t="linear"){if(e.width>0){const{left:i,right:s}=this[t],{left:n,right:a}=e;return Math.ceil(i)>=n&&i<Math.floor(a)||Math.floor(s)>n&&s<=Math.ceil(a)||Math.ceil(n)>=i&&n<Math.floor(s)||Math.floor(a)>i&&a<=Math.ceil(s)}return false}intersectY(e,t="linear"){if(e.height>0){const{top:i,bottom:s}=this[t],{top:n,bottom:a}=e;return Math.ceil(i)>=n&&i<Math.floor(a)||Math.floor(s)>n&&s<=Math.ceil(a)||Math.ceil(n)>=i&&n<Math.floor(s)||Math.floor(a)>i&&a<=Math.ceil(s)}return false}withinX(e,t="linear"){if(this.pageFlow||e.width>0){const{left:i,right:s}=this[t];return oe(i,e.left)&&ce(s,e.right)}return true}withinY(e,t="linear"){if(this.pageFlow||e.height>0){const{top:i,bottom:s}=this[t];return Math.ceil(i)>=e.top&&Math.floor(s)<=e.bottom}return true}outsideX(e,t="linear"){if(this.pageFlow||e.width>0){const{left:i,right:s}=this[t];return i<Math.floor(e.left)||s>Math.ceil(e.right)}return false}outsideY(e,t="linear"){if(this.pageFlow||e.height>0){const{top:i,bottom:s}=this[t];return i<Math.floor(e.top)||s>Math.ceil(e.bottom)}return false}css(e,t,i=true){if(t&&this.styleElement)if(this.style[e]=t,Re(t,this.style[e])){if(this._styleMap[e]=t,i)this.unsetCache(e);return t}return this._styleMap[e]||this.styleElement&&this.style[e]||""}cssApply(e,t=true){for(const i in e){const s=e[i];if(this.css(i,s,t)===s&&t)this.unsetCache(i)}return this}cssParent(e,t,i=false){var s;return(null===(s=this.actualParent)||void 0===s?void 0:s.css(e,t,i))||""}cssInitial(e,t){var i;return((null===(i=this._initial)||void 0===i?void 0:i.styleMap)||this._styleMap)[e]||(null==t?void 0:t.modified)&&this._styleMap[e]||(null==t?void 0:t.computed)&&this.style[e]||""}cssAscend(e,t){let i,s;if(t)({startSelf:i,initial:s}=t);let n,a=i?this:this.actualParent;while(null!==a){if(n=s?a.cssInitial(e):a.css(e),""!==n)return n;if(a.documentBody)break;a=a.actualParent}return""}cssAny(e,t){const i=t.initial?this.cssInitial(e,t):this.css(e);return""!==i&&t.values.includes(i)}cssSort(e,t={}){const i=false!==t.ascending,s=true===t.byFloat,n=!s&&true===t.byInt;return(t.duplicate?this.duplicate():this.children).sort((t,a)=>{let r,l;if(s)r=t.toFloat(e,t.childIndex),l=a.toFloat(e,a.childIndex);else if(n)r=t.toInt(e,t.childIndex),l=a.toInt(e,a.childIndex);else r=t.css(e),l=a.css(e);if(r===l)return 0;else if(i)return r<l?-1:1;return r>l?-1:1})}cssPX(e,t,i,s){const n=this._styleMap[e];if(n&&V(n)){if((t+=j(n,this.fontSize))<0&&true!==(null==s?void 0:s.negative))t=0;const a=F(t);if(this.css(e,a),i)this.unsetCache(e);return a}return""}cssSpecificity(e){var t,i;if(this.styleElement){const s=this._element;return(this.pseudoElement?null===(t=ae(s.parentElement,"styleSpecificity"+re(s,this.sessionId),this.sessionId))||void 0===t?void 0:t[e]:null===(i=ae(s,"styleSpecificity",this.sessionId))||void 0===i?void 0:i[e])||0}return 0}cssTry(e,t){if(this.styleElement){const i=this._element;return Ae(i,e,this.sessionId,t,U(i).getPropertyValue(e))}return false}cssFinally(e){if(this.styleElement){const t=this._element;if("string"==typeof e)Ie(t,e,this.sessionId);else for(const i in e)Ie(t,i,this.sessionId)}}cssTryAll(e){if(this.styleElement){const t=[],i=this._element,s=U(i);for(const n in e)if(Ae(i,n,this.sessionId,e[n],s.getPropertyValue(n)))t.push(n);else{let e=0;while(e<t.length)this.cssFinally(t[e++]);return}return e}}cssCopy(e,...t){const i=this._styleMap;let s=0;while(s<t.length){const n=t[s++];i[n]=e.css(n)}}cssCopyIfEmpty(e,...t){const i=this._styleMap;let s=0;while(s<t.length){const n=t[s++];if(!ge(i[n]))i[n]=e.css(n)}}cssAsTuple(...e){const t=e.length,i=new Array(t);let s=0;while(s<t)i[s]=this.css(e[s++]);return i}cssAsObject(...e){const t={};let i=0;while(i<e.length){const s=e[i++];t[s]=this.css(s)}return t}toInt(e,t=NaN,i=false){var s;const n=parseInt((i&&(null===(s=this._initial)||void 0===s?void 0:s.styleMap)||this._styleMap)[e]);return!isNaN(n)?n:t}toFloat(e,t=NaN,i=false){var s;const n=parseFloat((i&&(null===(s=this._initial)||void 0===s?void 0:s.styleMap)||this._styleMap)[e]);return!isNaN(n)?n:t}toElementInt(e,t=NaN){var i;const s=parseInt(null===(i=this._element)||void 0===i?void 0:i[e]);return!isNaN(s)?s:t}toElementFloat(e,t=NaN){var i;const s=parseFloat(null===(i=this._element)||void 0===i?void 0:i[e]);return!isNaN(s)?s:t}toElementBoolean(e,t=false){var i;const s=null===(i=this._element)||void 0===i?void 0:i[e];return"boolean"==typeof s?s:t}toElementString(e,t=""){var i,s;return(null!==(s=null===(i=this._element)||void 0===i?void 0:i[e])&&void 0!==s?s:t).toString()}parseUnit(e,t){var i;let s,n,a;if(t)({parent:s,dimension:n,screenDimension:a}=t);if(q(e)){const t=false!==s&&(null===(i=this.absoluteParent)||void 0===i?void 0:i.box)||this.bounds;let a=parseFloat(e)/100;switch(n){case"height":a*=t.height;break;default:a*=t.width;break}return a}return j(e,this.fontSize,a)}has(e,t){var i,s;const n=("initial"===(null==t?void 0:t.map)&&(null===(i=this._initial)||void 0===i?void 0:i.styleMap)||this._styleMap)[e];if(n){if("initial"===n||n===(null===(s=P[e])||void 0===s?void 0:s.value))return false;let i,a;if(t)({not:i,type:a}=t);if(i)if(n===i)return false;else if(Array.isArray(i)){let e=0;while(e<i.length)if(n===i[e++])return false}if(a)return fe(a,1)&&V(n)||fe(a,2)&&q(n)||fe(a,4)&&z(n)||fe(a,8)&&D(n);else return true}return false}hasPX(e,t){var i;let s,n;if(t)({initial:s,percent:n}=t);const a=(s&&(null===(i=this._initial)||void 0===i?void 0:i.styleMap)||this._styleMap)[e];return!!a&&V(a,false!==n)}setBounds(e=true){let t;if(this.styleElement){if(!e)se(this._element,"clientRect",this.sessionId);t=$(te(this._element,this.sessionId)),this._bounds=t}else if(this.plainText){const e=Q(this._element);t=$(e);const i=e.numberOfLines;t.numberOfLines=i,this._bounds=t,this._textBounds=t,this._cached.multiline=i>1}if(!e&&t)this._box=void 0,this._linear=void 0;return t}resetBounds(){this._bounds=void 0,this._box=void 0,this._linear=void 0,this._textBounds=void 0,this._cached.multiline=void 0}querySelector(e){return this.querySelectorAll(e,1)[0]||null}querySelectorAll(e,t=-1){let i=[];const s=this.queryMap;if(s&&0!==t){const n=G(e);let a=n.length,r=0;while(r<a){const e=n[r++],l=[];let o=-1;if("*"===e)l.push({all:true}),++o;else{e:{let t,i;while(i=we.exec(e)){let e=i[1],s=false;if(1===e.length){const i=e.charAt(0);switch(i){case"+":case"~":--o;case">":if(t||0===l.length){l.length=0;break e}t=i;continue;case"*":s=true;break}}else if(e.startsWith("*|*")){if(e.length>3){l.length=0;break e}s=true}else if(e.startsWith("*|"))e=e.substring(2);else if(e.startsWith("::")){l.length=0;break e}if(s)l.push({all:true});else{let i,s,n,a,r,o,c;while(c=ve.exec(e)){if(!a)a=[];let t=c[1].replace("\\:",":"),i=false;switch(t.indexOf("|")){case-1:break;case 1:if("*"===t.charAt(0)){i=true,t=t.substring(2);break}default:l.length=0;break e}const s="i"===c[6];let n=c[3]||c[4]||c[5]||"";if(s)n=n.toLowerCase();a.push({key:t,symbol:c[2],value:n,endsWith:i,caseInsensitive:s}),e=xe(e,c.index,c[0].length)}if(e.includes("::")){l.length=0;break e}while(c=Ee.exec(e)){const t=c[0];if(t.startsWith(":not(")){if(c[1]){if(!o)o=[];o.push(c[1])}}else{if(!r)r=[];r.push(t)}e=xe(e,c.index,t.length)}while(c=Se.exec(e)){const t=c[0];switch(t.charAt(0)){case"#":s=t.substring(1);break;case".":if(!n)n=[];n.push(t.substring(1));break;default:i=t.toUpperCase();break}e=xe(e,c.index,t.length)}l.push({tagName:i,id:s,adjacent:t,classList:n,pseudoList:r,notList:o,attrList:a})}++o,t=void 0}}we.lastIndex=0}if(a=s.length,l.length>0&&-1!==o&&o<a){const e=l.pop(),c=0===l.length,h=i.length;let d;if(e.all&&a-o==1)d=s[o];else{d=[];let t=o;while(t<a){const n=s[t++];if(e.all)d=d.concat(n);else{const t=n.length;let s=0;while(s<t){const t=n[s++];if((0===h||!i.includes(t))&&De(this,t,e,r,c))d.push(t)}}}}if(l.length>0){l.reverse();let s=h;const n=d.length;let a=0;while(a<n){const n=d[a++];if((0===h||!i.includes(n))&&Ve(this,l,r,0,e.adjacent,[n]))if(i.push(n),++s===t)return i.sort(Ne)}}else if(0===h)if(r===n.length-1||t>0&&t<=d.length){if(t>0&&d.length>t)d.length=t;return d.sort(Ne)}else i=d;else{const e=d.length;if(t>0){let s=h,n=0;while(n<e){const e=d[n++];if(!i.includes(e))if(i.push(e),++s===t)return i.sort(Ne)}}else{let t=0;while(t<e){const e=d[t++];if(!i.includes(e))i.push(e)}}}}}}return i.sort(Ne)}set parent(e){if(e){const t=this._parent;if(e!==t)null==t||t.remove(this),this._parent=e,e.add(this);else if(!e.contains(this))e.add(this);if(-1===this.depth)this.depth=e.depth+1}}get parent(){return this._parent}get tagName(){const e=this._cached.tagName;if(void 0===e){const e=this._element;if(e){const t=e.nodeName;return this._cached.tagName="#"===t.charAt(0)?t:e.tagName}return this._cached.tagName=""}return e}get element(){return this._element}get elementId(){var e;return((null===(e=this._element)||void 0===e?void 0:e.id)||"").trim()}get htmlElement(){const e=this._cached.htmlElement;return void 0===e?this._cached.htmlElement=!this.plainText&&this._element instanceof HTMLElement:e}get svgElement(){const e=this._cached.svgElement;return void 0===e?this._cached.svgElement=!this.htmlElement&&!this.plainText&&this._element instanceof SVGElement||this.imageElement&&ee.SVG.test(this.toElementString("src")):e}get styleElement(){return this.htmlElement||this.svgElement}get naturalChild(){return true}get naturalElement(){const e=this._cached.naturalElement;return void 0===e?this._cached.naturalElement=this.naturalChild&&this.styleElement&&!this.pseudoElement:e}get parentElement(){var e,t;return(null===(e=this._element)||void 0===e?void 0:e.parentElement)||(null===(t=this.actualParent)||void 0===t?void 0:t.element)||null}get textElement(){return this.plainText||this.inlineText&&"BUTTON"!==this.tagName}get pseudoElement(){return false}get imageElement(){return"IMG"===this.tagName}get flexElement(){return this.display.endsWith("flex")}get gridElement(){return this.display.endsWith("grid")}get tableElement(){return"TABLE"===this.tagName||"table"===this.display}get inputElement(){switch(this.tagName){case"INPUT":case"BUTTON":case"SELECT":case"TEXTAREA":return true;default:return false}}get plainText(){return"#text"===this.tagName}get styleText(){return this.naturalElement&&this.inlineText}get lineBreak(){return"BR"===this.tagName}get display(){return this.css("display")}get positionRelative(){return"relative"===this.css("position")}get floating(){return"none"!==this.float}get float(){return this.pageFlow&&this.css("float")||"none"}get zIndex(){return this.toInt("zIndex",0)}get textContent(){return this.naturalChild&&!this.svgElement?this._element.textContent:""}get dataset(){if(this.styleElement)return this._element.dataset;else{const e=this._dataset;return void 0===e?this._dataset={}:e}}get documentBody(){return this._element===document.body}get initial(){return this._initial}get bounds(){return this._bounds||this.setBounds(false)||$(this.boundingClientRect)}get linear(){if(void 0===this._linear){const e=this.bounds;if(e){if(this.styleElement){const{marginBottom:t,marginRight:i}=this,s=Math.max(this.marginTop,0),n=Math.max(this.marginLeft,0);return this._linear={top:e.top-s,right:e.right+i,bottom:e.bottom+t,left:e.left-n,width:e.width+n+i,height:e.height+s+t}}return this._linear=e}return J()}return this._linear}get box(){if(void 0===this._box){const e=this.bounds;if(e)if(this.styleElement&&this.naturalChildren.length>0)return this._box={top:e.top+(this.paddingTop+this.borderTopWidth),right:e.right-(this.paddingRight+this.borderRightWidth),bottom:e.bottom-(this.paddingBottom+this.borderBottomWidth),left:e.left+(this.paddingLeft+this.borderLeftWidth),width:e.width-this.contentBoxWidth,height:e.height-this.contentBoxHeight};else return this._box=e;return J()}return this._box}get flexdata(){const e=this._cached.flexdata;if(void 0===e){if(this.flexElement){const{flexWrap:e,flexDirection:t,alignContent:i,justifyContent:s}=this.cssAsObject("flexWrap","flexDirection","alignContent","justifyContent"),n=t.startsWith("row");return this._cached.flexdata={row:n,column:!n,reverse:t.endsWith("reverse"),wrap:e.startsWith("wrap"),wrapReverse:"wrap-reverse"===e,alignContent:i,justifyContent:s}}return this._cached.flexdata={}}return e}get flexbox(){const e=this._cached.flexbox;if(void 0===e){if(this.styleElement&&this.actualParent.flexElement){const[e,t,i]=this.cssAsTuple("alignSelf","justifySelf","flexBasis");return this._cached.flexbox={alignSelf:"auto"===e?this.cssParent("alignItems"):e,justifySelf:"auto"===t?this.cssParent("justifyItems"):t,basis:i,grow:Le(this,"flexGrow",0),shrink:Le(this,"flexShrink",1),order:this.toInt("order",0)}}return this._cached.flexbox={}}return e}get width(){const e=this._cached.width;return void 0===e?this._cached.width=Fe(this,this._styleMap,"width","minWidth","maxWidth"):e}get height(){const e=this._cached.height;return void 0===e?this._cached.height=Fe(this,this._styleMap,"height","minHeight","maxHeight"):e}get hasWidth(){const e=this._cached.hasWidth;return void 0===e?this._cached.hasWidth=this.width>0:e}get hasHeight(){var e;const t=this._cached.hasHeight;if(void 0===t){const t=this.css("height");if(q(t))return this._cached.hasHeight=this.pageFlow?(null===(e=this.actualParent)||void 0===e?void 0:e.hasHeight)||this.documentBody:"fixed"===this.css("position")||this.hasPX("top")||this.hasPX("bottom");else return this._cached.hasHeight=this.height>0||this.hasPX("height",{percent:false})}return t}get lineHeight(){var e;let t=this._cached.lineHeight;if(void 0===t){if(!this.imageElement&&!this.svgElement){let i=this.has("lineHeight"),s=0;if(i){const t=this.css("lineHeight");if(q(t))s=de(this.style.lineHeight);else if(pe(t))s=parseFloat(t)*this.fontSize;else if(s=j(t,this.fontSize),X(t)&&"inherit"!==(null===(e=this._cssStyle)||void 0===e?void 0:e.lineHeight)){const e=ze.call(this,"fontSize");if(Me(e))s*=parseFloat(e)}}else{let e=this.ascend({condition:e=>e.has("lineHeight")})[0];if(e){const t=e.css("lineHeight");if(pe(t))s=parseFloat(t)*this.fontSize,i=true}if(0===s)if(e=this.ascend({condition:e=>e.lineHeight>0})[0],e)s=e.lineHeight;if(this.styleElement){const e=ze.call(this,"fontSize");if(Me(e)){const t=parseFloat(e);if(1!==t)s*=t,this.css("lineHeight",F(s)),i=true}}}t=i||s>this.height||this.multiline||this.block&&this.naturalChildren.some(e=>e.textElement)?s:0}else t=0;this._cached.lineHeight=t}return t}get positionStatic(){var e;let t=this._cached.positionStatic;if(void 0===t){switch(this.css("position")){case"absolute":case"fixed":t=false;break;case"relative":t=!this.documentBody&&0===this.toFloat("top",0)&&0===this.toFloat("right",0)&&0===this.toFloat("bottom",0)&&0===this.toFloat("left",0),this._cached.positionRelative=!t;break;case"inherit":{const i=null===(e=this._element)||void 0===e?void 0:e.parentElement;if(i){const e=O(i,"position");t="static"===e||"initial"===e;break}}default:t=true;break}this._cached.positionStatic=t}return t}get top(){const e=this._cached.top;return void 0===e?this._cached.top=He(this,"top"):e}get right(){const e=this._cached.right;return void 0===e?this._cached.right=He(this,"right"):e}get bottom(){const e=this._cached.bottom;return void 0===e?this._cached.bottom=He(this,"bottom"):e}get left(){const e=this._cached.left;return void 0===e?this._cached.left=He(this,"left"):e}get marginTop(){const e=this._cached.marginTop;return void 0===e?this._cached.marginTop=this.inlineStatic?0:Ue(this,"marginTop",true):e}get marginRight(){const e=this._cached.marginRight;return void 0===e?this._cached.marginRight=Ue(this,"marginRight",true):e}get marginBottom(){const e=this._cached.marginBottom;return void 0===e?this._cached.marginBottom=this.inlineStatic?0:Ue(this,"marginBottom",true):e}get marginLeft(){const e=this._cached.marginLeft;return void 0===e?this._cached.marginLeft=Ue(this,"marginLeft",true):e}get borderTopWidth(){const e=this._cached.borderTopWidth;return void 0===e?this._cached.borderTopWidth=Oe(this,"height",_e):e}get borderRightWidth(){const e=this._cached.borderRightWidth;return void 0===e?this._cached.borderRightWidth=Oe(this,"height",ke):e}get borderBottomWidth(){const e=this._cached.borderBottomWidth;return void 0===e?this._cached.borderBottomWidth=Oe(this,"width",Te):e}get borderLeftWidth(){const e=this._cached.borderLeftWidth;return void 0===e?this._cached.borderLeftWidth=Oe(this,"width",Ce):e}get paddingTop(){const e=this._cached.paddingTop;return void 0===e?this._cached.paddingTop=Ue(this,"paddingTop",false):e}get paddingRight(){const e=this._cached.paddingRight;return void 0===e?this._cached.paddingRight=Ue(this,"paddingRight",false):e}get paddingBottom(){const e=this._cached.paddingBottom;return void 0===e?this._cached.paddingBottom=Ue(this,"paddingBottom",false):e}get paddingLeft(){const e=this._cached.paddingLeft;return void 0===e?this._cached.paddingLeft=Ue(this,"paddingLeft",false):e}get contentBox(){return"border-box"!==this.css("boxSizing")||this.tableElement&&N(4)}get contentBoxWidth(){const e=this._cached.contentBoxWidth;if(void 0===e)return this._cached.contentBoxWidth=this.tableElement&&"collapse"===this.css("borderCollapse")?0:this.borderLeftWidth+this.paddingLeft+this.paddingRight+this.borderRightWidth;else return e}get contentBoxHeight(){const e=this._cached.contentBoxHeight;if(void 0===e)return this._cached.contentBoxHeight=this.tableElement&&"collapse"===this.css("borderCollapse")?0:this.borderTopWidth+this.paddingTop+this.paddingBottom+this.borderBottomWidth;else return e}get inline(){const e=this._cached.inline;if(void 0===e){const e=this.display;return this._cached.inline="inline"===e||"initial"===e&&!Y.includes(this.tagName)}return e}get inlineStatic(){const e=this._cached.inlineStatic;return void 0===e?this._cached.inlineStatic=this.inline&&this.pageFlow&&!this.floating&&!this.imageElement:e}set inlineText(e){switch(this.tagName){case"IMG":case"INPUT":case"SELECT":case"TEXTAREA":case"SVG":case"BR":case"HR":case"PROGRESS":case"METER":case"CANVAS":this._inlineText=false;break;case"BUTTON":this._inlineText=""!==this.textContent.trim();break;default:this._inlineText=e;break}}get inlineText(){return this._inlineText}get block(){let e=this._cached.block;if(void 0===e){switch(this.display){case"block":case"flex":case"grid":case"list-item":e=true;break;case"initial":e=Y.includes(this.tagName);break;case"inline":if("svg"===this.tagName&&this.actualParent.htmlElement){e=!this.hasPX("width")&&0===de(K(this._element,"width"));break}default:e=false;break}this._cached.block=e}return e}get blockStatic(){const e=this._cached.blockStatic;if(void 0===e){const e=this.pageFlow;if(e&&(this.block&&!this.floating||this.lineBreak))return this._cached.blockStatic=true;else if(!e||!this.inline&&!this.display.startsWith("table-")&&!this.hasPX("maxWidth")){const e=ze.call(this,"width"),t=ze.call(this,"minWidth");let i=0;if(q(e))i=parseFloat(e);if(q(t))i=Math.max(parseFloat(t),i);if(i>0){const e=ze.call(this,"marginLeft"),t=ze.call(this,"marginRight");return this._cached.blockStatic=i+(q(e)?parseFloat(e):0)+(q(t)?parseFloat(t):0)>=100}}return this._cached.blockStatic=false}return e}get pageFlow(){const e=this._cached.pageFlow;return void 0===e?this._cached.pageFlow=this.positionStatic||this.positionRelative:e}get centerAligned(){const e=this._cached.centerAligned;if(void 0===e)return this._cached.centerAligned=!this.pageFlow?this.hasPX("left")&&this.hasPX("right"):this.autoMargin.leftRight||qe(this)&&We(this,"center");else return e}get rightAligned(){const e=this._cached.rightAligned;if(void 0===e)return this._cached.rightAligned=!this.pageFlow?this.hasPX("right")&&!this.hasPX("left"):"right"===this.float||this.autoMargin.left||qe(this)&&We(this,"right","end");else return e}get bottomAligned(){var e;const t=this._cached.bottomAligned;if(void 0===t)return this._cached.bottomAligned=!this.pageFlow?this.hasPX("bottom")&&!this.hasPX("top"):true===(null===(e=this.actualParent)||void 0===e?void 0:e.hasHeight)&&true===this.autoMargin.top;else return t}get autoMargin(){const e=this._cached.autoMargin;if(void 0===e){if(!this.pageFlow||this.blockStatic||"table"===this.display){const e=this._styleMap,t="auto"===e.marginLeft&&(this.pageFlow||this.hasPX("right")),i="auto"===e.marginRight&&(this.pageFlow||this.hasPX("left")),s="auto"===e.marginTop&&(this.pageFlow||this.hasPX("bottom")),n="auto"===e.marginBottom&&(this.pageFlow||this.hasPX("top"));return this._cached.autoMargin={horizontal:t||i,left:t&&!i,right:!t&&i,leftRight:t&&i,vertical:s||n,top:s&&!n,bottom:!s&&n,topBottom:s&&n}}return this._cached.autoMargin={}}return e}get baseline(){const e=this._cached.baseline;if(void 0===e){if(this.pageFlow&&!this.floating){const e=this.css("verticalAlign");return this._cached.baseline="baseline"===e||"initial"===e||0===this.naturalElements.length&&V(e,true)}return this._cached.baseline=false}return e}get verticalAlign(){let e=this._cached.verticalAlign;if(void 0===e){if(this.pageFlow){if(e=this.css("verticalAlign"),V(e,true))e=this.parseUnit(e,{dimension:"height"})+"px"}else e="0px";this._cached.verticalAlign=e}return e}set textBounds(e){this._textBounds=e}get textBounds(){const e=this._textBounds;if(void 0===e){if(this.naturalChild)if(this.textElement)return this._textBounds=ie(this._element,this.sessionId);else{const e=this.naturalChildren,t=e.length;if(t>0){let i=1/0,s=-1/0,n=-1/0,a=1/0,r=0,l=0;while(l<t){const t=e[l++];if(t.textElement){const e=ie(t.element,t.sessionId);i=Math.min(e.top,i),s=Math.max(e.right,s),a=Math.min(e.left,a),n=Math.max(e.bottom,n),r+=e.numberOfLines||0}}if(r>0)return this._textBounds={top:i,right:s,left:a,bottom:n,width:s-a,height:n-i,numberOfLines:r}}}return this._textBounds=null}return e}get multiline(){var e;const t=this._cached.multiline;if(void 0===t)return this._cached.multiline=this.styleText?(this.inline||0===this.naturalElements.length||Be(this.display)||this.floating)&&(null===(e=this.textBounds)||void 0===e?void 0:e.numberOfLines)>1:this.plainText&&Math.floor(Q(this._element).width)>this.actualParent.box.width;else return t}get backgroundColor(){let e=this._cached.backgroundColor;if(void 0===e){if(!this.plainText)switch(e=this.css("backgroundColor"),e){case"initial":case"transparent":case"rgba(0, 0, 0, 0)":if(e="",this.inputElement)if("BUTTON"===this.tagName)e="rgba(0, 0, 0, 0)";else switch(this.toElementString("type")){case"button":case"submit":case"reset":case"image":e="rgba(0, 0, 0, 0)";break}break;default:if(""!==e&&this.styleElement&&!this.inputElement&&(!this._initial||ze.call(this,"backgroundColor")===e)){let t=this.actualParent;while(null!==t){const i=ze.call(t,"backgroundColor",{modified:true});if(""!==i){if(i===e&&""===t.backgroundColor)e="";break}t=t.actualParent}}break}else e="";this._cached.backgroundColor=e}return e}get backgroundImage(){let e=this._cached.backgroundImage;if(void 0===e){if(!this.plainText){let t=this.css("backgroundImage");if(""!==t&&"none"!==t&&"initial"!==t)e=t;else{e="";const i=/\s*(url|[a-z-]+gradient)/;if(t=this.css("background"),i.test(t)){const s=ye(t),n=s.length;for(let t=1;t<n;++t){const n=s[t-1].trim();if(i.test(n))e+=(""!==e?", ":"")+n+s[t]}}}}else e="";this._cached.backgroundImage=e}return e}get percentWidth(){const e=this._cached.percentWidth;if(void 0===e){const e=ze.call(this,"width");return this._cached.percentWidth=q(e)?parseFloat(e)/100:0}return e}get percentHeight(){var e;const t=this._cached.percentHeight;if(void 0===t){const t=ze.call(this,"height");return this._cached.percentHeight=q(t)&&((null===(e=this.actualParent)||void 0===e?void 0:e.hasHeight)||"fixed"===this.css("position"))?parseFloat(t)/100:0}return t}get visibleStyle(){const e=this._cached.visibleStyle;if(void 0===e){if(!this.plainText){const e=this.borderTopWidth>0||this.borderRightWidth>0||this.borderBottomWidth>0||this.borderLeftWidth>0,t=""!==this.backgroundColor,i=""!==this.backgroundImage;let s=false,n=false;if(i)for(const e of this.css("backgroundRepeat").split(",")){const[t,i]=e.trim().split(" ");if(!s)s="repeat"===t||"repeat-x"===t;if(!n)n="repeat"===t||"repeat-y"===t||"repeat"===i}return this._cached.visibleStyle={background:e||i||t,borderWidth:e,backgroundImage:i,backgroundColor:t,backgroundRepeat:s||n,backgroundRepeatX:s,backgroundRepeatY:n}}return this._cached.visibleStyle={}}return e}get absoluteParent(){let e=this._cached.absoluteParent;if(void 0===e){if(e=this.actualParent,!this.pageFlow&&!this.documentBody)while(e&&!e.documentBody){switch(ze.call(e,"position",{computed:true})){case"static":case"initial":case"unset":e=e.actualParent;continue}break}this._cached.absoluteParent=e}return e}set actualParent(e){this._cached.actualParent=e}get actualParent(){var e;const t=this._cached.actualParent;if(void 0===t){const t=null===(e=this._element)||void 0===e?void 0:e.parentElement;return this._cached.actualParent=t&&ne(t,this.sessionId)||null}return t}get actualWidth(){var e;let t=this._cached.actualWidth;if(void 0===t){if(this.plainText){const e=this.bounds;switch(e.numberOfLines||1){case 1:t=e.width;break;case 2:t=Math.min(e.width,this.actualParent.box.width);break;default:t=Math.min(e.right-e.left,this.actualParent.box.width);break}}else if(this.inlineStatic||"table-cell"===this.display||true===(null===(e=this.actualParent)||void 0===e?void 0:e.flexdata.row))t=this.bounds.width;else if(t=this.width,t>0){if(this.contentBox&&!this.tableElement)t+=this.contentBoxWidth}else t=this.bounds.width;this._cached.actualWidth=t}return t}get actualHeight(){var e;let t=this._cached.actualHeight;if(void 0===t){if(this.inlineStatic||"table-cell"===this.display||true===(null===(e=this.actualParent)||void 0===e?void 0:e.flexdata.column))t=this.bounds.height;else if(t=this.height,t>0){if(this.contentBox&&!this.tableElement)t+=this.contentBoxHeight}else t=this.bounds.height;this._cached.actualHeight=t}return t}get actualDimension(){return{width:this.actualWidth,height:this.actualHeight}}set naturalChildren(e){this._naturalChildren=e}get naturalChildren(){return this._naturalChildren||function(e){var t;let i;if(e.naturalElement){i=[];const t=e.sessionId;let s=0;e.element.childNodes.forEach(e=>{const n=ne(e,t);if(n)n.childIndex=s++,i.push(n)})}else i=((null===(t=e.initial)||void 0===t?void 0:t.children)||e.children).slice(0);return e.naturalChildren=i,i}(this)}set naturalElements(e){this._naturalElements=e}get naturalElements(){return this._naturalElements||function(e){const t=e.naturalChildren.filter(e=>e.naturalElement);return e.naturalElements=t,t}(this)}get firstChild(){return this.naturalElements[0]||null}get lastChild(){const e=this.naturalElements,t=e.length;return t?e[t-1]:null}get previousSibling(){var e;return(null===(e=this.actualParent)||void 0===e?void 0:e.naturalChildren[this.childIndex-1])||null}get nextSibling(){var e;return(null===(e=this.actualParent)||void 0===e?void 0:e.naturalChildren[this.childIndex+1])||null}get previousElementSibling(){var e;const t=null===(e=this.actualParent)||void 0===e?void 0:e.naturalElements;if(t){const e=t.indexOf(this);if(e>0)return t[e-1]}return null}get nextElementSibling(){var e;const t=null===(e=this.actualParent)||void 0===e?void 0:e.naturalElements;if(t){const e=t.indexOf(this);if(-1!==e)return t[e+1]||null}return null}get attributes(){let e=this._cached.attributes;if(void 0===e){if(e={},this.styleElement){const t=this._element.attributes,i=t.length;let s=0;while(s<i){const i=t.item(s++);e[i.name]=i.value}}this._cached.attributes=e}return e}get boundingClientRect(){var e;return this.naturalElement&&(null===(e=this._element)||void 0===e?void 0:e.getBoundingClientRect())||this._bounds||J()}get fontSize(){var e,t,i,s;let n=this._fontSize;if(void 0===n){if(this.naturalChild&&this.styleElement){const i=ze.call(this,"fontSize");if(X(i))n=parseFloat(i);else if(q(i)&&this._element!==document.documentElement)n=(null!==(t=null===(e=this.actualParent)||void 0===e?void 0:e.fontSize)&&void 0!==t?t:Pe(U(this._element.parentElement||document.documentElement)))*parseFloat(i)/100;else n=Pe(this.style)}else n=j(this.css("fontSize"));if(0===n&&!this.naturalChild){const e=this.element;n=e&&H(e)?(null===(i=ne(e,this.sessionId))||void 0===i?void 0:i.fontSize)||Pe(U(e)):(null===(s=this.ascend({condition:e=>e.fontSize>0})[0])||void 0===s?void 0:s.fontSize)||Pe(U(document.documentElement))}this._fontSize=n}return n}get cssStyle(){return Object.assign({},this._cssStyle)}get textStyle(){let e=this._textStyle;if(void 0===e)e=this.cssAsObject(...Node.TEXT_STYLE),e.fontSize=this.fontSize+"px",this._textStyle=e;return e}set dir(e){this._cached.dir=e}get dir(){let e=this._cached.dir;if(void 0===e){if(e=this.naturalElement?this._element.dir:"",""===e){let t=this.actualParent;while(null!==t){if(e=t.dir,""!==e)break;t=t.actualParent}}this._cached.dir=e}return e}get center(){const e=this.bounds;return{x:(e.left+e.right)/2,y:(e.top+e.bottom)/2}}}Node.BOX_POSITION=["top","right","bottom","left"],Node.TEXT_STYLE=["fontFamily","fontWeight","fontStyle","fontVariant","fontStretch","color","whiteSpace","textDecoration","textTransform","letterSpacing","wordSpacing"];const{extractURL:Xe}=squared.lib.css,{STRING:Ge}=squared.lib.regex,{fromLastIndexOf:je,fromMimeType:Ye,hasMimeType:$e,randomUUID:Ke}=squared.lib.util,Qe=new RegExp(`^${Ge.DATAURI}$`);class Resource{reset(){var e;const t=Resource.ASSETS;for(const e in t)t[e].clear();null===(e=this._fileHandler)||void 0===e||e.reset()}addImage(e){if(e.complete){const t=e.src;if(t.startsWith("data:image/")){const i=Qe.exec(t);if(i){const s=i[1].trim().split(/\s*;\s*/);this.addRawData(t,s[0],i[2],{encoding:s[1]||"base64",width:e.naturalWidth,height:e.naturalHeight})}}if(""!==t)Resource.ASSETS.image.set(t,{width:e.naturalWidth,height:e.naturalHeight,uri:t})}}addVideo(e,t){Resource.ASSETS.video.set(e,{uri:e,mimeType:t})}addAudio(e,t){Resource.ASSETS.audio.set(e,{uri:e,mimeType:t})}addFont(e){const t=Resource.ASSETS.fonts,i=e.fontFamily.trim().toLowerCase();e.fontFamily=i;const s=t.get(i);if(s)s.push(e);else t.set(i,[e])}addRawData(e,t,i,s){let n,a,r,l,o,c;if(s)if(({filename:n,encoding:a,data:r,width:l,height:o}=s),a)a=a.toLowerCase();if(t=t.toLowerCase(),"base64"===a)if(i)if("image/svg+xml"===t)i=window.atob(i);else c=i;else if(r)c=r;else return"";else if(i)i=i.replace(/\\(["'])/g,(e,...t)=>t[0]);else if(!Array.isArray(r))return"";const h=this.mimeTypeMap.image;if("*"===h||h.includes(t)){if(!n){const i="."+(Ye(t)||"unknown");n=e.endsWith(i)?je(e,"/","\\"):this.randomUUID+i}return Resource.ASSETS.rawData.set(e,{pathname:e.startsWith(location.origin)?e.substring(location.origin.length+1,e.lastIndexOf("/")):"",filename:n,content:i,base64:c,mimeType:t,bytes:r,width:l,height:o}),n}return""}getImage(e){return Resource.ASSETS.image.get(e)}getVideo(e){return Resource.ASSETS.video.get(e)}getAudio(e){return Resource.ASSETS.audio.get(e)}getFont(e,t="normal",i){const s=Resource.ASSETS.fonts.get(e.trim().toLowerCase());if(s){const e=this.mimeTypeMap.font;return s.find(s=>t.startsWith(s.fontStyle)&&(!i||s.fontWeight===parseInt(i))&&($e(e,s.srcFormat)||s.srcUrl&&$e(e,s.srcUrl)))}}getRawData(e){if(e.startsWith("url(")){const t=Xe(e);if(!t)return;e=t}return Resource.ASSETS.rawData.get(e)}addUnsafeData(e,t,i){Resource.ASSETS[e].set(t,i)}set fileHandler(e){if(e)e.resource=this;this._fileHandler=e}get fileHandler(){return this._fileHandler}get controllerSettings(){return this.application.controllerHandler.localSettings}get mimeTypeMap(){return this.controllerSettings.mimeType}get randomUUID(){return Ke()}get mapOfAssets(){return Resource.ASSETS}}var Je,Ze,et;Resource.KEY_NAME="squared.resource",Resource.ASSETS={fonts:new Map,image:new Map,video:new Map,audio:new Map,rawData:new Map},Resource.canCompressImage=(e,t)=>/\.(png|jpg|jpeg)$/i.test(e)||"image/png"===t||"image/jpeg"===t,Resource.getExtension=e=>{var t;return(null===(t=/\.(\w+)\s*$/.exec(e))||void 0===t?void 0:t[1])||""},function(e){e[e.DOM_TRAVERSE=1]="DOM_TRAVERSE",e[e.EXTENSION=2]="EXTENSION",e[e.RENDER=4]="RENDER",e[e.ALL=7]="ALL"}(Je||(Je={})),function(e){e[e.BOX_STYLE=1]="BOX_STYLE",e[e.BOX_SPACING=2]="BOX_SPACING",e[e.FONT_STYLE=4]="FONT_STYLE",e[e.VALUE_STRING=8]="VALUE_STRING",e[e.IMAGE_SOURCE=16]="IMAGE_SOURCE",e[e.ASSET=28]="ASSET",e[e.ALL=31]="ALL"}(Ze||(Ze={})),function(e){e[e.CONSTRAINT=1]="CONSTRAINT",e[e.LAYOUT=2]="LAYOUT",e[e.ALIGNMENT=4]="ALIGNMENT",e[e.ACCESSIBILITY=8]="ACCESSIBILITY",e[e.LOCALIZATION=16]="LOCALIZATION",e[e.CUSTOMIZATION=32]="CUSTOMIZATION",e[e.ALL=63]="ALL"}(et||(et={}));var tt=Object.freeze({__proto__:null,get APP_SECTION(){return Je},get NODE_RESOURCE(){return Ze},get NODE_PROCEDURE(){return et}});const{CSS_PROPERTIES:it}=squared.lib.css,{equal:st}=squared.lib.math,{getElementAsNode:nt}=squared.lib.session,{capitalize:at,cloneObject:rt,convertWord:lt,hasBit:ot,hasKeys:ct,isArray:ht,iterateArray:dt,safeNestedMap:ut,searchObject:ft,withinRange:gt}=squared.lib.util,pt=new Map,mt=[1,2,4,8],bt=it.margin.value,xt=[16,32,64,128],yt=it.padding.value;for(let e=0;e<4;++e)pt.set(mt[e],bt[e]),pt.set(xt[e],yt[e]);function vt(e,t,i,s){let n,a,r,l;if(s)({floating:n,pageFlow:a,lineBreak:r,excluded:l}=s);const o=[];while(null!==e){const s=nt(e,i);if(s)if(false!==r&&s.lineBreak||false!==l&&s.excluded&&!s.lineBreak)o.push(s);else if(s.pageFlow&&!s.excluded){if(false===a)break;if(o.push(s),false!==n||!s.floating&&(s.visible||s.rendered)&&"none"!==s.display)break}e=e[t]}return o}function wt(e,t,i,s,n,a){for(let r=0;r<4;++r){const l=s[r];if(ot(n,l)){const s=i[r];if(t[s]=1,a){const t=e.registerBox(l);if(t)t.resetBox(l,a);else{if(e.naturalChild){const t=e[s];if(t>=0)a.modifyBox(l,t)}e.transferBox(l,a)}}}}}function St(e,t,i,s,n,a){for(let r=0;r<4;++r){const l=s[r];if(ot(n,l)){const s=e.registerBox(l);if(s)s.transferBox(l,a);else{const s=i[r],n=t[s];if(0!==n)a.modifyBox(l,n,false),t[s]=0;e.registerBox(l,a)}}}}function Et(e){let t=0;if(e.scrollElement){const i=e.element,[s,n]=e.cssAsTuple("overflowX","overflowY");if(e.hasHeight&&(e.hasPX("height")||e.hasPX("maxHeight"))&&("scroll"===n||"auto"===n&&i.clientHeight!==i.scrollHeight))t|=8;if((e.hasPX("width")||e.hasPX("maxWidth"))&&("scroll"===s||"auto"===s&&i.clientWidth!==i.scrollWidth))t|=4}return t}function _t(e,t,i){if(i)for(const s of i.split("|")){const i=e[s.trim().toUpperCase()]||0;if(i>0&&!ot(t,i))t|=i}return t}const kt=e=>e.naturalElements.length>0&&!e.layoutElement&&!e.tableElement,Tt=(e,t)=>e.blockDimension&&Math.ceil(e.bounds.top)>=t.bounds.bottom&&(e.blockVertical||t.blockVertical||e.percentWidth>0||t.percentWidth>0),Ct=e=>e.inlineDimension&&!e.hasPX("maxWidth")?e.percentWidth:-1/0,At=e=>e.actualWidth+Math.max(e.marginLeft,0)+e.marginRight;class NodeUI extends Node{constructor(){super(...arguments),this.alignmentType=0,this.rendered=false,this.excluded=false,this.rootElement=false,this.floatContainer=false,this.lineBreakLeading=false,this.lineBreakTrailing=false,this.baselineActive=false,this.baselineAltered=false,this.visible=true,this._preferInitial=true,this._excludeSection=0,this._excludeProcedure=0,this._excludeResource=0,this._childIndex=1/0,this._containerIndex=1/0,this._renderAs=null,this._locked={}}static justified(e){if(e.naturalChild&&"justify"===e.cssAscend("textAlign")){let t=0;const{box:i,naturalChildren:s}=e.actualParent,n=s.length;let a=0;while(a<n){const e=s[a++];if(!e.inlineVertical){t=NaN;break}else t+=e.linear.width}if(Math.floor(t)>i.width)return true}return false}static refitScreen(e,t){const{width:i,height:s}=e.localSettings.screenDimension;let{width:n,height:a}=t;if(n>i)a=Math.round(a*i/n),n=i;else if(a>s)n=Math.round(n*s/a),a=s;else return t;return{width:n,height:a}}static outerRegion(e){let t,i,s,n,a=1/0,r=-1/0,l=-1/0,o=1/0,c=-1/0,h=-1/0;return e.each(e=>{if(e.companion)t=e.actualRect("top"),i=e.actualRect("right"),s=e.actualRect("bottom"),n=e.actualRect("left");else{if(({top:t,right:i,bottom:s,left:n}=e.linear),e.marginRight<0){const t=i+Math.abs(e.marginRight);if(t>c)c=t}if(e.marginBottom<0){const t=s+Math.abs(e.marginBottom);if(t>h)h=t}}if(t<a)a=t;if(i>r)r=i;if(s>l)l=s;if(n<o)o=n}),{top:a,right:r,bottom:l,left:o,width:Math.max(r,c)-o,height:Math.max(l,h)-a}}static baseline(e,t=false){const i=[],s=e.length;let n=0;while(n<s){const s=e[n++];if(s.baseline&&(!t||s.textElement)&&!s.baselineAltered)if(s.naturalElements.length>0){if(s.baselineElement)i.push(s)}else i.push(s)}if(i.length>1)i.sort((e,t)=>{if(e.length>0&&0===t.length)return 1;else if(t.length>0&&0===e.length)return-1;const i=e.baselineHeight+e.marginBottom,s=t.baselineHeight+t.marginBottom;if(!st(i,s))return i>s?-1:1;else if(e.textElement&&t.textElement){if(!e.pseudoElement&&t.pseudoElement)return-1;else if(e.pseudoElement&&!t.pseudoElement)return 1;else if(!e.plainText&&t.plainText)return-1;else if(e.plainText&&!t.plainText)return 1}else if(e.inputElement&&t.inputElement&&e.containerType!==t.containerType)return e.containerType>t.containerType?-1:1;else if(t.textElement&&e.inputElement&&t.childIndex<e.childIndex)return 1;else if(e.textElement&&t.inputElement&&e.childIndex<t.childIndex)return-1;const n=e.bounds.bottom,a=t.bounds.bottom;if(n>a)return-1;else if(n<a)return 1;return 0});return i[0]||null}static linearData(e,t){const i=new Set;let s=false,n=false;const a=e.length;if(a>1){const r=new Array(a);let l=0,o=0;while(l<a){const t=e[l++];if(t.pageFlow){if(t.floating)i.add(t.float);r[o++]=t}else if(t.autoPosition)r[o++]=t}if(o){r.length=o;const e=i.size>0,a=[r[0]];let c=1,h=1;l=1;while(l<o){const i=r[l++];if(i.alignedVertically(a,e?t:void 0)>0)++h;else++c;if(c>1&&h>1)break;a.push(i)}if(s=c===o,n=h===o,s&&e){let e=1/0,t=-1/0,i=-1/0,n=1/0;l=0;while(l<o){const s=r[l++],{left:a,right:o}=s.linear;switch(e=Math.min(e,a),t=Math.max(t,o),s.float){case"left":i=Math.max(i,o);break;case"right":n=Math.min(n,a);break}}let a=0,c=0,h=0,d=0;for(l=0;l<o;++l){const o=r[l],{left:u,right:f}=o.linear;if(Math.floor(u)<=e)++a;if(Math.ceil(f)>=t)++c;if(!o.floating){if(u===i)++h;if(f===n)++d}if(0===l)continue;if(2===a||2===c||2===h||2===d){s=false;break}const g=r[l-1];if(gt(u,g.linear.left)||g.floating&&Math.ceil(o.bounds.top)>=g.bounds.bottom){s=false;break}}}}}else if(a>0)n=e[0].blockStatic,s=!n;return{linearX:s,linearY:n,floated:i,cleared:t}}static partitionRows(e,t){const i=[];let s=[],n=[];const a=e.length;let r=0;while(r<a){const a=e[r++];let l=a;if(!a.naturalChild){if(a.nodeGroup){if(s.length>0)i.push(s);i.push([a]),s=[],n.length=0;continue}const e=a.innerMostWrapped;if(e!==a)l=e}if(0===s.length)s.push(a),n.push(l);else if(l.alignedVertically(n,t)>0){if(s.length>0)i.push(s);s=[a],n=[l]}else s.push(a),n.push(l)}if(s.length>0)i.push(s);return i}is(e){return this.containerType===e}of(e,...t){return this.is(e)&&t.some(e=>this.hasAlign(e))}attr(e,t,i,s=true){const n=this.namespace(e);if(i){if(s&&this.lockedAttr(e,t))s=false;if(!s&&n[t])return n[t];else return n[t]=i,i}return n[t]||""}delete(e,...t){const i=this._namespaces[e];if(i){let e=0;while(e<t.length){const s=t[e++];if(s.includes("*"))for(const[e]of ft(i,s))delete i[e];else delete i[s]}}}namespace(e){const t=this._namespaces[e];return void 0===t?this._namespaces[e]={}:t}namespaces(){return Object.entries(this._namespaces)}unsafe(e,t){if(void 0!==t)this["_"+e]=t;return this["_"+e]}unset(e){delete this["_"+e]}lockAttr(e,t){ut(this._locked,e)[t]=true}unlockAttr(e,t){const i=this._locked[e];if(i)i[t]=false}lockedAttr(e,t){var i;return true===(null===(i=this._locked[e])||void 0===i?void 0:i[t])}render(e){this.renderParent=e,this.rendered=true}parseUnit(e,t={}){if(!t.screenDimension)t.screenDimension=this.localSettings.screenDimension;return super.parseUnit(e,t)}parseWidth(e,t=true){return super.parseUnit(e,{parent:t,screenDimension:this.localSettings.screenDimension})}parseHeight(e,t=true){return super.parseUnit(e,{dimension:"height",parent:t,screenDimension:this.localSettings.screenDimension})}renderEach(e){const t=this.renderChildren,i=t.length;let s=0;while(s<i)e(t[s],s++,t);return this}hide(e){if(null==e?void 0:e.remove)this.removeTry(e);this.rendered=true,this.visible=false}inherit(e,...t){let i,s=0;while(s<t.length)switch(t[s++]){case"base":{if(this._documentParent=e.documentParent,this._bounds=e.bounds,this._linear=e.linear,this._box=e.box,-1===this.depth)this.depth=e.depth;const t=e.actualParent;if(t)this.actualParent=t,this.dir=t.dir;break}case"initial":if(i=e.unsafe("initial"),i)this.inheritApply("initial",i);break;case"alignment":if(this.cssCopy(e,"position","display","verticalAlign","float","clear","zIndex"),!this.positionStatic){let t=0;while(t<4){const i=NodeUI.BOX_POSITION[t++];if(e.hasPX(i))this._styleMap[i]=e.css(i)}}Object.assign(this.autoMargin,e.autoMargin),this.autoPosition=e.autoPosition;break;case"styleMap":this.cssCopyIfEmpty(e,...Object.keys(e.unsafe("styleMap")));break;case"textStyle":i=e.textStyle,this.inheritApply("textStyle",i);break;case"boxStyle":{i=e.cssAsObject("backgroundRepeat","backgroundSize","backgroundPositionX","backgroundPositionY","backgroundClip","boxSizing","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor","borderTopStyle","borderRightStyle","borderBottomStyle","borderLeftStyle","borderTopLeftRadius","borderTopRightRadius","borderBottomRightRadius","borderBottomLeftRadius"),Object.assign(i,{backgroundColor:e.backgroundColor,backgroundImage:e.backgroundImage,border:"inherit",borderRadius:"inherit"}),this.inheritApply("boxStyle",i),this.setCacheValue("visibleStyle",void 0),e.setCacheValue("backgroundColor",""),e.setCacheValue("backgroundImage",""),e.cssApply({backgroundColor:"transparent",backgroundImage:"none",border:"initial",borderRadius:"initial"});const t=e.visibleStyle;t.background=false,t.backgroundImage=false,t.backgroundRepeatX=false,t.backgroundRepeatY=false,t.backgroundColor=false,t.borderWidth=false;break}}return i}inheritApply(e,t){switch(e){case"initial":rt(t,this.initial);break;case"textStyle":this.cssApply(t),this.setCacheValue("fontSize",parseFloat(t.fontSize));break;case"boxStyle":this.cssApply(t),this.unsetCache("borderTopWidth","borderBottomWidth","borderRightWidth","borderLeftWidth"),this.setCacheValue("backgroundColor",t.backgroundColor),this.setCacheValue("backgroundImage",t.backgroundImage);break}}addAlign(e){if(!this.hasAlign(e))this.alignmentType|=e}removeAlign(e){if(this.hasAlign(e))this.alignmentType^=e}hasAlign(e){return ot(this.alignmentType,e)}hasResource(e){return!ot(this._excludeResource,e)}hasProcedure(e){return!ot(this._excludeProcedure,e)}hasSection(e){return!ot(this._excludeSection,e)}exclude(e){const{resource:t,procedure:i,section:s}=e;if(t&&!ot(this._excludeResource,t))this._excludeResource|=t;if(i&&!ot(this._excludeProcedure,i))this._excludeProcedure|=i;if(s&&!ot(this._excludeSection,s))this._excludeSection|=s}setExclusions(){if(this.naturalElement){const e=this._element.dataset;if(ct(e)){const t=at(this.localSettings.systemName);if(this._excludeResource=_t(Ze,this._excludeResource,e["excludeResource"+t]||e.excludeResource),this._excludeProcedure=_t(et,this._excludeProcedure,e["excludeProcedure"+t]||e.excludeProcedure),this._excludeSection=_t(Je,this._excludeSection,e["excludeSection"+t]||e.excludeSection),this.length){const i=_t(Ze,0,e["excludeResourceChild"+t]||e.excludeResourceChild),s=_t(et,0,e["excludeProcedureChild"+t]||e.excludeProcedureChild),n=_t(Je,0,e["excludeSectionChild"+t]||e.excludeSectionChild);if(i>0||s>0||n>0){const e={resource:i,procedure:s,section:n};this.each(t=>t.exclude(e))}}}}}replaceTry(e){var t;const{child:i,replaceWith:s}=e,n=this.children,a=n.length;for(let e=0;e<a;++e){const a=n[e];if(a===i||a===i.outerMostWrapper){if(null===(t=s.parent)||void 0===t||t.remove(s),s.naturalChild&&this.naturalElement)s.actualParent.naturalChildren.splice(s.childIndex,1),this.naturalChildren.splice(i.childIndex,1,s),s.init(this,i.depth,i.childIndex);else s.unsafe("parent",this),s.depth=i.depth;return n[e]=s,s.containerIndex=i.containerIndex,true}}if(e.notFoundAppend)return s.parent=this,true;else return false}removeTry(e){var t,i,s;const n=this.renderParent;if(n){const{renderTemplates:a,renderChildren:r}=n;if(a){const l=r.findIndex(e=>e===this);if(-1!==l){const o=a[l];if(o.node===this){const c=null==e?void 0:e.replaceWith;if(c){const s=c.renderParent;if(s){const h=s.renderTemplates;if(h){const d=h.findIndex(e=>e.node===c);if(-1!==d){if(null===(i=(t=e).beforeReplace)||void 0===i||i.call(t,this,c),r[l]=c,a[l]=h[d],h.splice(d,1),s.renderChildren.splice(d,1),c.renderParent=n,this.documentRoot)c.documentRoot=true,this.documentRoot=false;return c.depth=this.depth,this.renderParent=void 0,o}}}}else return null===(s=null==e?void 0:e.beforeReplace)||void 0===s||s.call(e,this,void 0),r.splice(l,1),this.renderParent=void 0,a.splice(l,1)[0]}}}}}sort(e){if(e)super.sort(e);else this.children.sort((e,t)=>e.containerIndex<t.containerIndex?-1:1);return this}alignedVertically(e,t,i){if(this.lineBreak)return 2;else if(!this.pageFlow){if(this.autoPosition){if(!e)e=this.siblingsLeading;let i=e.length-1;while(i>=0){const s=e[i--];if(s.pageFlow)return s.blockStatic||(null==t?void 0:t.has(s))?1:0}return 0}return 1}else{const s=this.floating;if(ht(e)){const n=e[e.length-1];if(t)if(t.size>0&&(t.has(this)||this.siblingsLeading.some(e=>e.excluded&&t.has(e))))return 4;else if(s&&n.floating){if(i&&this.float===n.float||Math.floor(this.bounds.top)===Math.floor(n.bounds.top))return 0;else if(Math.ceil(this.bounds.top)>=n.bounds.bottom){if(e.every(e=>e.inlineDimension)){const t=this.actualParent;if(t&&t.ascend({condition:e=>!e.inline&&e.hasWidth,error:e=>e.layoutElement,startSelf:true})){const i=e.length;if(t.naturalChildren.filter(e=>e.visible&&e.pageFlow).length===i+1){let s=t.box.width-At(this),n=0;while(n<i)s-=At(e[n++]);if(s>=0)return 0}}}return 6}}else if(this.blockStatic&&e.reduce((e,t)=>e+(t.floating?t.linear.width:-1/0),0)/this.actualParent.box.width>=.8)return 7;else if(e.every(e=>e.inlineDimension&&Math.ceil(this.bounds.top)>=e.bounds.bottom))return 5;else if(void 0!==i)if(s&&!i&&n.blockStatic)return 0;else if(!this.display.startsWith("inline-")){let{top:s,bottom:n}=this.bounds;if(this.textElement&&t.size>0&&e.some(e=>t.has(e))&&e.some(e=>Math.floor(s)<e.bounds.top&&Math.ceil(n)>e.bounds.bottom))return 7;else if(e[0].floating){const t=e.length;if(t>1){const a=e[0].float;let r=-1/0,l=0,o=0;while(o<t){const t=e[o++];if(t.floating){if(t.float===a)r=Math.max(t.actualRect("bottom","bounds"),r);l+=t.linear.width}}if(Math.ceil(l)>=this.actualParent.box.width)return 5;else if(this.multiline){if(this.styleText){const e=this.textBounds;if(e)n=e.bottom}const e=n-r;s=e<=0||e/(n-s)<.5?-1/0:1/0}else s=Math.ceil(s);if(s<Math.floor(r))return i?0:5;else return i?5:0}else if(!i)return 5}}if(Tt(this,n))return 3;else{const t=Ct(this);if(t>0&&e.reduce((e,t)=>e+Ct(t),t)>1)return 8}}const n=this.blockStatic||"table"===this.display,a=this.siblingsLeading.length;if(n&&(0===a||0===this.containerIndex))return 1;for(let e=a-1;e>=0;--e){const r=this.siblingsLeading[e];if(r.excluded&&(null==t?void 0:t.has(r)))return 4;else if(r.blockStatic||r.autoMargin.leftRight||(false===i||s&&0===r.childIndex)&&r.plainText&&r.multiline)return 1;else if(n&&(!r.floating||(null==t?void 0:t.has(r))||e===a-1&&!r.pageFlow))return 1;else if(r.floating){if("left"===r.float){if(this.autoMargin.right)return 5}else if(this.autoMargin.left)return 5;if(this.floatContainer&&this.some(e=>e.floating&&Math.ceil(e.bounds.top)>=r.bounds.bottom))return 5}if(Tt(this,r))return 3}return 0}}previousSiblings(e){var t;const i=this.innerMostWrapped;return e?vt(null===(t=i.element)||void 0===t?void 0:t.previousSibling,"previousSibling",this.sessionId,e):i.siblingsLeading}nextSiblings(e){var t;const i=this.innerMostWrapped;return e?vt(null===(t=i.element)||void 0===t?void 0:t.nextSibling,"nextSibling",this.sessionId,e):i.siblingsTrailing}modifyBox(e,t,i=true){var s;if(0!==t){const n=pt.get(e);if(n){const a=null===(s=this._boxRegister)||void 0===s?void 0:s[e];if(void 0===t)if(a){const t=this[n]||a.getBox(e)[1];if(t>0)a.modifyBox(e,-t,i)}else this._boxReset[n]=1;else if(a)a.modifyBox(e,t,i);else{const e=this._boxAdjustment;if(!i&&(0===this._boxReset[n]?this[n]:0)+e[n]+t<=0){if(e[n]=0,this[n]>=0&&t<0)this._boxReset[n]=1}else e[n]+=t}}}}getBox(e){const t=pt.get(e);return t?[this._boxReset[t],this._boxAdjustment[t]]:[NaN,0]}setBox(e,t){var i;const s=pt.get(e);if(s){const n=null===(i=this._boxRegister)||void 0===i?void 0:i[e];if(n)n.setBox(e,t);else{const{reset:e,adjustment:i}=t,n=this._boxReset,a=this._boxAdjustment;if(void 0!==e)n[s]=e;if(void 0!==i){let e=i;if(t.accumulate)e+=a[s];if(false===t.negative&&(0===n[s]?this[s]:0)+e<=0)if(e=0,this[s]>=0&&e<0)n[s]=1;a[s]=e}else if(1===e&&!this.naturalChild)a[s]=0}}}resetBox(e,t){if(ot(15,e))wt(this,this._boxReset,bt,mt,e,t);if(ot(240,e))wt(this,this._boxReset,yt,xt,e,t)}transferBox(e,t){if(ot(15,e))St(this,this._boxAdjustment,bt,mt,e,t);if(ot(240,e))St(this,this._boxAdjustment,yt,xt,e,t)}registerBox(e,t){var i;if(void 0===this._boxRegister)this._boxRegister={};if(t)this._boxRegister[e]=t;else t=this._boxRegister[e];while(void 0!==t){const s=null===(i=t.unsafe("boxRegister"))||void 0===i?void 0:i[e];if(s)t=s;else break}return t}actualPadding(e,t){if(t>0){if(!this.layoutElement){const i=this.innerMostWrapped;if(i!==this)if(i.naturalChild){if(0===i.getBox("paddingTop"===e?16:64)[0])return 0}else return t;if(i.naturalChild)return kt(i)&&function e(t,i,s){let n=false;const a=t.length;let r=0;while(r<a){const a=t[r++];if(a.blockStatic)return false;else if(a.inlineStatic)if(a.has("lineHeight")&&a.lineHeight>a.bounds.height)return false;else if(a[i]>=s)n=true;else if(kt(a))if(!e(a.naturalChildren,i,s))return false;else n=true}return n}(i.naturalChildren,e,t)?0:t}else if(this.gridElement)switch(this.css("alignContent")){case"space-around":case"space-evenly":return 0}return t}return 0}actualBoxWidth(e){if(!e)e=this.box.width;if(this.pageFlow){let t=0,i=0,s=this.actualParent;while(null!==s){if(s.hasPX("width",{percent:false})||!s.pageFlow)return e;else t+=Math.max(s.marginLeft,0)+s.borderLeftWidth+s.paddingLeft,i+=s.paddingRight+s.borderRightWidth+s.marginRight;s=s.actualParent}const n=this.localSettings.screenDimension.width-t-i;if(n>0)return Math.min(e,n)}return e}cloneBase(e){if(e.depth=this.depth,e.childIndex=this.childIndex,e.inlineText=this.inlineText,e.actualParent=this.actualParent,e.documentRoot=this.documentRoot,e.localSettings=this.localSettings,e.alignmentType=this.alignmentType,e.containerName=this.containerName,e.visible=this.visible,e.excluded=this.excluded,e.rendered=this.rendered,e.containerIndex=this.containerIndex,e.lineBreakLeading=this.lineBreakLeading,e.lineBreakTrailing=this.lineBreakTrailing,e.documentParent=this.documentParent,e.renderParent=this.renderParent,e.rootElement=this.rootElement,this.length>0)e.retainAs(this.duplicate());e.inherit(this,"initial","base","alignment","styleMap","textStyle"),Object.assign(e.unsafe("cached"),this._cached)}unsetCache(...e){const t=e.length;if(t>0){const i=this._cached;let s=0;while(s<t)switch(e[s++]){case"top":case"right":case"bottom":case"left":i.autoPosition=void 0,i.positiveAxis=void 0;break;case"float":i.floating=void 0;break;case"fontSize":case"lineHeight":i.baselineHeight=void 0;break;case"whiteSpace":i.preserveWhiteSpace=void 0,i.textEmpty=void 0;break;case"width":case"height":case"maxWidth":case"maxHeight":case"overflowX":case"overflowY":i.overflow=void 0;break}}super.unsetCache(...e)}css(e,t,i=false){if(arguments.length>=2){if(t)this._styleMap[e]=t;else if(null===t)delete this._styleMap[e];if(i)this.unsetCache(e)}return this._styleMap[e]||this.styleElement&&this.style[e]||""}cssApply(e,t){if(Object.assign(this._styleMap,e),t)this.unsetCache(...Object.keys(e));return this}cssSet(e,t,i=true){return super.css(e,t,i)}setCacheValue(e,t){this._cached[e]=t}get element(){return this._element||this.innerWrapped&&this.innerMostWrapped.unsafe("element")||null}set naturalChild(e){this._cached.naturalChild=e}get naturalChild(){const e=this._cached.naturalChild;if(void 0===e){const e=this._element;return this._cached.naturalChild=e?e.parentElement?true:e===document.documentElement:false}return e}get pseudoElement(){var e;return"__squared.pseudo"===(null===(e=this._element)||void 0===e?void 0:e.className)}get scrollElement(){let e=this._cached.scrollElement;if(void 0===e){if(this.htmlElement)switch(this.tagName){case"INPUT":switch(this.toElementString("type")){case"button":case"submit":case"reset":case"file":case"date":case"datetime-local":case"month":case"week":case"time":case"range":case"color":e=true;break;default:e=false;break}break;case"IMG":case"SELECT":case"TABLE":case"VIDEO":case"AUDIO":case"PROGRESS":case"METER":case"HR":case"BR":case"WBR":e=false;break;default:e=this.blockDimension;break}else e=false;this._cached.scrollElement=e}return e}get layoutElement(){const e=this._cached.layoutElement;return void 0===e?this._cached.layoutElement=this.flexElement||this.gridElement:e}get imageElement(){const e=this._cached.imageElement;return void 0===e?this._cached.imageElement=super.imageElement:e}get flexElement(){const e=this._cached.flexElement;return void 0===e?this._cached.flexElement=super.flexElement:e}get gridElement(){const e=this._cached.gridElement;return void 0===e?this._cached.gridElement=super.gridElement:e}get tableElement(){const e=this._cached.tableElement;return void 0===e?this._cached.tableElement=super.tableElement:e}get inputElement(){const e=this._cached.inputElement;return void 0===e?this._cached.inputElement=super.inputElement:e}get floating(){const e=this._cached.floating;return void 0===e?this._cached.floating=super.floating:e}get float(){const e=this._cached.float;return void 0===e?this._cached.float=super.float:e}set textContent(e){this._cached.textContent=e}get textContent(){const e=this._cached.textContent;return void 0===e?this._cached.textContent=super.textContent:e}get contentBox(){const e=this._cached.contentBox;return void 0===e?this._cached.contentBox=super.contentBox:e}get positionRelative(){const e=this._cached.positionRelative;return void 0===e?this._cached.positionRelative=super.positionRelative:e}set documentParent(e){this._documentParent=e}get documentParent(){return this._documentParent||this.absoluteParent||this.actualParent||this.parent||this}set containerName(e){this._cached.containerName=e.toUpperCase()}get containerName(){let e=this._cached.containerName;if(void 0===e){const t=this.element;if(t)if("#text"===t.nodeName)e="PLAINTEXT";else if("INPUT"===t.tagName)e="INPUT_"+lt(t.type,true).toUpperCase();else e=t.tagName.toUpperCase();else e="";this._cached.containerName=e}return e}get layoutHorizontal(){return this.hasAlign(4)}get layoutVertical(){if(this.hasAlign(8))return true;else if(this.naturalChild){const e=this.naturalChildren;return 1===e.length&&e[0].blockStatic}return false}get nodeGroup(){return false}set renderAs(e){if(e&&!e.renderParent&&!this.rendered)this._renderAs=e}get renderAs(){return this._renderAs}get inlineVertical(){const e=this._cached.inlineVertical;if(void 0===e){if((this.naturalElement||this.pseudoElement)&&!this.floating){const e=this.display;return this._cached.inlineVertical=e.startsWith("inline")||"table-cell"===e}return this._cached.inlineVertical=false}return e}get inlineDimension(){const e=this._cached.inlineDimension;return void 0===e?this._cached.inlineDimension=(this.naturalElement||this.pseudoElement)&&(this.display.startsWith("inline-")||this.floating):e}get inlineFlow(){var e;const t=this._cached.inlineFlow;return void 0===t?this._cached.inlineFlow=this.inline||this.inlineDimension||this.inlineVertical||this.imageElement||this.svgElement&&this.hasPX("width",{percent:false})||this.tableElement&&true===(null===(e=this.previousSibling)||void 0===e?void 0:e.floating):t}get blockStatic(){return super.blockStatic||this.hasAlign(32)&&this.pageFlow&&!this.floating}get blockDimension(){const e=this._cached.blockDimension;return void 0===e?this.block||this.inlineDimension||this.imageElement||this.svgElement||"table"===this.display:e}get blockVertical(){const e=this._cached.blockVertical;return void 0===e?this._cached.blockVertical=this.blockDimension&&this.hasHeight:e}get rightAligned(){if(this.hasAlign(1024))return true;else return super.rightAligned}set autoPosition(e){this._cached.autoPosition=e}get autoPosition(){const e=this._cached.autoPosition;if(void 0===e)if(this.pageFlow)return this._cached.autoPosition=false;else{const{top:e,right:t,bottom:i,left:s}=this._styleMap;return this._cached.autoPosition=!(e&&"auto"!==e||s&&"auto"!==s||t&&"auto"!==t||i&&"auto"!==i)}return e}get positiveAxis(){const e=this._cached.positiveAxis;return void 0===e?this._cached.positiveAxis=(!this.positionRelative||this.positionRelative&&this.top>=0&&this.left>=0&&(this.right<=0||this.hasPX("left"))&&(this.bottom<=0||this.hasPX("top")))&&this.marginTop>=0&&this.marginLeft>=0&&this.marginRight>=0:e}get leftTopAxis(){const e=this._cached.leftTopAxis;if(void 0===e)switch(this.cssInitial("position")){case"absolute":return this._cached.leftTopAxis=this.absoluteParent===this.documentParent;case"fixed":return this._cached.leftTopAxis=true;default:return this._cached.leftTopAxis=false}return e}get baselineElement(){let e=this._cached.baselineElement;if(void 0===e){if(this.baseline){const t=this.naturalChildren;if(t.length>0)e=t.every(e=>e.baselineElement&&0===e.length);else e=this.inlineText&&this.textElement||this.plainText&&!this.multiline||this.inputElement||this.imageElement||this.svgElement}else e=false;this._cached.baselineElement=e}return e}set multiline(e){this._cached.multiline=e,this._cached.baselineElement=void 0}get multiline(){return super.multiline}set controlName(e){if(!this.rendered||!this._controlName)this._controlName=e}get controlName(){return this._controlName||""}set actualParent(e){this._cached.actualParent=e}get actualParent(){const e=this._cached.actualParent;return void 0===e?this._cached.actualParent=super.actualParent||this.innerMostWrapped.actualParent:e}set siblingsLeading(e){this._siblingsLeading=e}get siblingsLeading(){var e;return null!==(e=this._siblingsLeading)&&void 0!==e?e:this._siblingsLeading=this.previousSiblings({lineBreak:true,excluded:true})}set siblingsTrailing(e){this._siblingsTrailing=e}get siblingsTrailing(){var e;return null!==(e=this._siblingsTrailing)&&void 0!==e?e:this._siblingsTrailing=this.nextSiblings({lineBreak:true,excluded:true})}get flowElement(){return this.pageFlow&&(!this.excluded||this.lineBreak)}get previousSibling(){const e=this.actualParent;if(e){const t=e.naturalChildren,i=t.indexOf(this);if(-1!==i){let e=i-1;while(e>=0){const i=t[e--];if(i.flowElement)return i}}}return null}get nextSibling(){const e=this.actualParent;if(e){const t=e.naturalChildren,i=t.indexOf(this);if(-1!==i){const e=t.length;let s=i+1;while(s<e){const e=t[s++];if(e.flowElement)return e}}}return null}get firstChild(){return this.naturalChildren.find(e=>!e.excluded||e.lineBreak)||null}get lastChild(){const e=this.naturalChildren;let t=e.length-1;while(t>=0){const i=e[t--];if(!i.excluded||i.lineBreak)return i}return null}get firstStaticChild(){return this.naturalChildren.find(e=>e.flowElement)||null}get lastStaticChild(){const e=this.naturalChildren;let t=e.length-1;while(t>=0){const i=e[t--];if(i.flowElement)return i}return null}get onlyChild(){var e,t,i;return 1===(null!==(t=null===(e=this.renderParent)||void 0===e?void 0:e.renderChildren.length)&&void 0!==t?t:null===(i=this.parent)||void 0===i?void 0:i.length)&&!this.documentRoot}get overflowX(){let e=this._cached.overflow;if(void 0===e)e=Et(this),this._cached.overflow=e;return ot(e,4)}get overflowY(){let e=this._cached.overflow;if(void 0===e)e=Et(this),this._cached.overflow=e;return ot(e,8)}get textEmpty(){const e=this._cached.textEmpty;if(void 0===e){if(this.styleElement&&!this.imageElement&&!this.svgElement&&!this.inputElement){const e=this.textContent;return this._cached.textEmpty=""===e||!this.preserveWhiteSpace&&""===e.trim()}return this._cached.textEmpty=false}return e}set childIndex(e){this._childIndex=e}get childIndex(){let e=this._childIndex;if(e===1/0){let t=this.innerWrapped;if(t)do{const i=t.childIndex;if(i!==1/0){e=i,this._childIndex=e;break}t=t.innerWrapped}while(void 0!==t);else{const t=this._element;if(t){const i=t.parentElement;if(i)dt(i.childNodes,(i,s)=>{if(i===t)return e=s,this._childIndex=s,true})}}}return e}set containerIndex(e){this._containerIndex=e}get containerIndex(){let e=this._containerIndex;if(e===1/0){let t=this.innerWrapped;while(void 0!==t){const i=t.containerIndex;if(i!==1/0){e=i,this._containerIndex=e;break}t=t.innerWrapped}}return e}get innerMostWrapped(){if(this.naturalChild)return this;let e=this.innerWrapped;while(void 0!==e){const t=e.innerWrapped;if(t)e=t;else break}return e||this}get outerMostWrapper(){let e=this.outerWrapper;while(void 0!==e){const t=e.outerWrapper;if(t)e=t;else break}return e||this}get preserveWhiteSpace(){const e=this._cached.preserveWhiteSpace;if(void 0===e){const e=this.css("whiteSpace");return this._cached.preserveWhiteSpace="pre"===e||"pre-wrap"===e}return e}set use(e){const t=this.use;this.dataset["use"+at(this.localSettings.systemName)]=(t?t+", ":"")+e}get use(){const e=this.dataset;return e["use"+at(this.localSettings.systemName)]||e.use}get extensions(){var e;const t=this._cached.extensions;if(void 0===t){const t=null===(e=this.use)||void 0===e?void 0:e.trim();return this._cached.extensions=t?t.split(/\s*,\s*/):[]}return t}}const{hasBit:It}=squared.lib.util;class LayoutUI extends squared.lib.base.Container{constructor(e,t,i=0,s=0,n){super(n),this.parent=e,this.node=t,this.containerType=i,this.alignmentType=s}static create(e){const{parent:t,node:i,containerType:s,alignmentType:n,children:a,itemCount:r,rowCount:l,columnCount:o}=e,c=new LayoutUI(t,i,s,n,a);if(r)c.itemCount=r;if(l)c.rowCount=l;if(o)c.columnCount=o;return c}init(){const e=this.length;if(e>1){const e=NodeUI.linearData(this.children);this._floated=e.floated,this._linearX=e.linearX,this._linearY=e.linearY}else if(1===e)this._linearY=this.children[0].blockStatic,this._linearX=!this._linearY;else return;this._initialized=true}setContainerType(e,t){if(this.containerType=e,t)this.addAlign(t)}addAlign(e){if(!It(this.alignmentType,e))this.alignmentType|=e;return this.alignmentType}hasAlign(e){return It(this.alignmentType,e)}addRender(e){if(void 0===this.renderType)this.renderType=0;if(!It(this.renderType,e))this.renderType|=e;return this.renderType}retainAs(e){if(super.retainAs(e),this._initialized)this.init();return this}set itemCount(e){this._itemCount=e}get itemCount(){var e;return null!==(e=this._itemCount)&&void 0!==e?e:this.length}set type(e){this.setContainerType(e.containerType,e.alignmentType);const t=e.renderType;if(t)this.addRender(t)}get linearX(){var e;if(!this._initialized)this.init();return null!==(e=this._linearX)&&void 0!==e?e:true}get linearY(){var e;if(!this._initialized)this.init();return null!==(e=this._linearY)&&void 0!==e?e:false}get floated(){if(!this._initialized)this.init();return this._floated||new Set}get singleRowAligned(){let e=this._singleRow;if(void 0===e){const t=this.children,i=t.length;if(i>0){if(e=true,i>1){let s=1/0,n=0;while(n<i){const i=t[n++];if(i.blockStatic||i.multiline||Math.ceil(i.bounds.top)>=s){e=false;break}s=i.bounds.bottom}}this._singleRow=e}else return false}return e}get unknownAligned(){return this.length>1&&!this.linearX&&!this.linearY}}const{convertListStyle:Rt,formatPX:Nt,getStyle:Pt,hasComputedStyle:Mt,hasCoords:Bt,insertStyleSheetRule:Lt,resolveURL:Wt}=squared.lib.css,{getNamedItem:Ft,removeElementsByClassName:Ot}=squared.lib.dom,{maxArray:Ut}=squared.lib.math,{getElementCache:Ht,getPseudoElt:Dt,setElementCache:Vt}=squared.lib.session,{appendSeparator:qt,capitalize:zt,convertWord:Xt,flatArray:Gt,hasBit:jt,hasMimeType:Yt,isString:$t,iterateArray:Kt,partitionArray:Qt,safeNestedArray:Jt,safeNestedMap:Zt,trimBoth:ei,trimString:ti}=squared.lib.util,ii=NodeUI.TEXT_STYLE.concat(["fontSize"]);function si(e,t){const i=e.trim().split(/\s*,\s*/),s=[],n=[],a=t.length;let r=0;while(r<a){const e=t[r++],a=i.indexOf(e.name);if(-1!==a)s[a]=e;else n.push(e)}return s.length>0?Gt(s).concat(n):t}function ni(e){let t=0,i=true,s=true;const n=e.length;let a=0;while(a<n){const t=e[a++];if(!t.floating)s=false;if(!t.rightAligned)i=false;if(!s&&!i)break}if(s)t|=256;if(i)t|=1024;return t}function ai(e,t,i){switch(e.display){case void 0:case"block":case"inline":case"inherit":case"initial":break;default:return true}if((t||!parseFloat(e.width))&&!parseFloat(e.height)){for(const t in e)if(/(padding|Width|Height)/.test(t)&&parseFloat(e[t])>0||!i&&t.startsWith("margin")&&parseFloat(e[t]))return true;return false}return true}function ri(e,t,i,s,n){var a;let r=e,l=0,o=0,c=-1;while("Q"===(null==r?void 0:r.tagName)){const e=(null===(a=Ht(r,"styleMap",n))||void 0===a?void 0:a.quotes)||getComputedStyle(r).quotes;if(e){const n=/("(?:[^"]|\\")+"|[^\s]+)\s+("(?:[^"]|\\")+"|[^\s]+)(?:\s+("(?:[^"]|\\")+"|[^\s]+)\s+("(?:[^"]|\\")+"|[^\s]+))?/.exec(e);if(n){if("::before"===t){if(0===l)i=fi(n[1]),++l;if(n[3]&&l<2)s=fi(n[3]),++l}else{if(0===l)i=fi(n[2]),++l;if(n[4]&&l<2)s=fi(n[4]),++l}c=o}}r=r.parentElement,++o}if(0===l)--o;else if(0===c)return i;else if(c>0)return s;return o%2==0?i:s}function li(e,t){return e.positionRelative?e.hasPX("left")?e.left*(t?1:-1):e.right*(t?-1:1):0}function oi(e,t,i){const s=e.get(t);if(s)s.add(i);else e.set(t,new Set([i]))}function ci(e,t,i=1){if(e&&"none"!==e){const s=/\b([^\-\d][^\-\d]?[^\s]*)\s+(-?\d+)\b/g;let n;while(n=s.exec(e))if(n[1]===t)return parseInt(n[2]);return i}}function hi(e,t){const i=e.length;let s=0;while(s<i){const i=e[s++];if(!(i.hasPX("width")||i.hasPX("maxWidth")||i.imageElement||i.svgElement))i.css("maxWidth",Nt(t))}}function di(e){const t=e.length;let i=0;while(i<t)switch(e.charCodeAt(i++)){case 32:case 9:case 10:case 11:case 13:continue;default:return true}return false}const ui=(e,t,i,s,n)=>{var a;return ci(null===(a=Ht(e,"styleMap"+i,s))||void 0===a?void 0:a.counterIncrement,t,n)},fi=e=>{var t;return(null===(t=/^"(.+)"$/.exec(e))||void 0===t?void 0:t[1])||e},gi=e=>!e.blockStatic&&true!==e.autoMargin.horizontal&&!(e.blockDimension&&"100%"===e.css("width"))&&(!(e.plainText&&e.multiline)||e.floating),pi=(e,t)=>e.textElement&&(e.blockStatic||e.multiline||1===t),mi=e=>-(e+2);const{USER_AGENT:bi,isUserAgent:xi}=squared.lib.client,{CSS_PROPERTIES:yi,formatPX:vi,getStyle:wi,hasCoords:Si,isLength:Ei,isPercent:_i}=squared.lib.css,{withinViewport:ki}=squared.lib.dom,{actualClientRect:Ti,getElementCache:Ci,setElementCache:Ai}=squared.lib.session,{capitalize:Ii,convertFloat:Ri,flatArray:Ni,iterateArray:Pi,joinArray:Mi,safeNestedArray:Bi}=squared.lib.util,Li=yi.borderTop.value,Wi=yi.borderRight.value,Fi=yi.borderBottom.value,Oi=yi.borderLeft.value,Ui=[Li,Wi,Fi,Oi];function Hi(e,t){if(!e.border&&!(Li[0]in e||Wi[0]in e||Fi[0]in e||Oi[0]in e)){e.border="1px outset "+t;let i=0;while(i<4){const s=Ui[i++];e[s[0]]="1px",e[s[1]]="outset",e[s[2]]=t}return true}return false}function Di(e,t,i){if(t){const t=e.backgroundColor;if(!t||"initial"===t)e.backgroundColor=i}if(!e.textAlign)e.textAlign="center";if(!e.padding&&!yi.padding.value.some(t=>!!e[t]))e.paddingTop="2px",e.paddingRight="6px",e.paddingBottom="3px",e.paddingLeft="6px"}function Vi(e,t,i="\t",s){if(t>0){if(void 0===s)s=i.repeat(t);return Mi(e.split("\n"),e=>""!==e?s+e:"")}return e}function qi(e,t,i="\t",s=""){if(t>0){let n="";const a=i.repeat(t),r=e.length;let l=0;while(l<r)n+=(l>0?s:"")+Vi(e[l++],t,i,a);return n}return e.join(s)}const{capitalize:zi,includes:Xi}=squared.lib.util;class ExtensionUI extends Extension{constructor(e,t,i,s=[]){super(e,t,i),this.tagNames=s,this._isAll=0===s.length}static findNestedElement(e,t){if(e.styleElement){const i=zi(e.localSettings.systemName),s=e.element.children,n=s.length;let a=0;while(a<n){const e=s[a++];if(Xi(e.dataset["use"+i]||e.dataset.use,t))return e}}return null}is(e){return this._isAll||this.tagNames.includes(e.tagName)}condition(e,t){return e.use?this.included(e.element):!this._isAll}included(e){return Xi(this.application.getDatasetName("use",e),this.name)}processNode(e,t){}processChild(e,t){}addDescendant(e){const t=this.application.session.extensionMap,i=t.get(e.id);if(i){if(!i.includes(this))i.push(this)}else t.set(e.id,[this])}postBaseLayout(e){}postConstraints(e){}postOptimize(e){}afterBaseLayout(e){}afterConstraints(e){}afterResources(e){}beforeBaseLayout(e){}beforeCascade(e,t){}afterFinalize(){}set application(e){this._application=e,this._controller=e.controllerHandler,this._resource=e.resourceHandler}get application(){return this._application}get controller(){return this._controller}get resource(){return this._resource}}const{hasCoords:Gi,isLength:ji}=squared.lib.css;const{USER_AGENT:Yi,isUserAgent:$i}=squared.lib.client,{parseColor:Ki}=squared.lib.color,{CSS_PROPERTIES:Qi,calculate:Ji,convertAngle:Zi,formatPX:es,getBackgroundPosition:ts,getInheritedStyle:is,hasComputedStyle:ss,hasCoords:ns,isCalc:as,isLength:rs,isParentStyle:ls,isPercent:os,parseAngle:cs}=squared.lib.css,{getNamedItem:hs}=squared.lib.dom,{cos:ds,equal:us,hypotenuse:fs,offsetAngleX:gs,offsetAngleY:ps,relativeAngle:ms,sin:bs,triangulate:xs,truncateFraction:ys}=squared.lib.math,{STRING:vs}=squared.lib.regex,{getElementAsNode:ws}=squared.lib.session,{appendSeparator:Ss,convertCamelCase:Es,hasValue:_s,isEqual:ks,isNumber:Ts,isString:Cs,iterateArray:As}=squared.lib.util,Is=Qi.borderTop.value,Rs=Qi.borderRight.value,Ns=Qi.borderBottom.value,Ps=Qi.borderLeft.value,Ms=Qi.outline.value,Bs=`((?:rgb|hsl)a?\\(\\d+,\\s+\\d+%?,\\s+\\d+%?(?:,\\s+[\\d.]+)?\\)|#[A-Za-z\\d]{3,8}|[a-z]+)\\s*(${vs.LENGTH_PERCENTAGE}|${vs.CSS_ANGLE}|(?:${vs.CSS_CALC}(?=,)|${vs.CSS_CALC}))?,?\\s*`,Ls=new RegExp(`(?:initial|url\\([^)]+\\)|(repeating-)?(linear|radial|conic)-gradient\\(((?:to\\s+[a-z\\s]+|(?:from\\s+)?-?[\\d.]+(?:deg|rad|turn|grad)|(?:circle|ellipse)?\\s*(?:closest-side|closest-corner|farthest-side|farthest-corner)?)?(?:\\s*(?:(?:-?[\\d.]+(?:[a-z%]+)?\\s*)+)?(?:at\\s+[\\w %]+)?)?),?\\s*((?:${Bs})+)\\))`,"g"),Ws=new RegExp(Bs,"g"),Fs=/\n([^\S\n]*)?$/,Os=/^\s+/,Us=/\s+$/;function Hs(e,t,i){const{width:s,height:n}=t.dimension,a=[];let r,l=false,o=true,c=1;switch(t.type){case"linear":{const{repeating:e,angle:i}=t;switch(l=e,i){case 0:case 180:case 360:r=n,o=false;break;case 90:case 270:r=s;break;default:r=Math.abs(s*bs(i-180))+Math.abs(n*ds(i-180)),o=s>=n;break}break}case"radial":{const{repeating:i,radiusExtent:s,radius:n}=t;o=e.actualWidth>=e.actualHeight,l=i,c=s/n,r=n;break}case"conic":r=Math.min(s,n);break;default:return a}let h,d=0;while(h=Ws.exec(i)){const i=Ki(h[1],1,true);if(i){let s=-1;if("conic"===t.type){const e=h[3],t=h[4];if(e&&t)s=Zi(e,t)/360}else{const t=h[2];if(os(t))s=parseFloat(t)/100;else if(rs(t))s=(o?e.parseWidth(t,false):e.parseHeight(t,false))/r;else if(as(t))if(s=Ji(h[6],{boundingSize:r,fontSize:e.fontSize})/r,isNaN(s))s=-1;if(l&&-1!==s)s*=c}if(isNaN(s))continue;if(0===a.length)if(-1===s)s=0;else if(s>0)a.push({color:i,offset:0});if(-1!==s)s=Math.max(d,s),d=s;a.push({color:i,offset:s})}}const u=a.length,f=a[u-1];if(-1===f.offset)f.offset=1;let g=0;for(let e=0;e<u;++e){const t=a[e];if(-1===t.offset)if(0===e)t.offset=0;else{for(let i=e+1,s=2;i<u-1;++s){const e=a[i++];if(-1!==e.offset){t.offset=(g+e.offset)/s;break}}if(-1===t.offset)t.offset=g+f.offset/(u-1)}g=t.offset}if(l){if(g<100)e:{let e=g;const t=a.slice(0);while(g<100){let i=0;while(i<u){const s=t[i++];if(g=Math.min(e+s.offset,1),a.push(Object.assign(Object.assign({},s),{offset:g})),1===g)break e}e=g}}}else if(g<1)a.push(Object.assign(Object.assign({},a[u-1]),{offset:1}));return Ws.lastIndex=0,a}function Ds(e,t,i,s){if(""!==i){const n=i.split(/\s*,\s*/);return ResourceUI.getBackgroundSize(e,n[t%n.length],s)}}function Vs(e,t,i,s){const n=e.css(s[1])||"none";if("none"!==n){let a=es("outline"!==i?e[s[0]]:parseFloat(e.style[s[0]]));if("0px"!==a){let r=e.css(s[2])||"initial";switch(r){case"initial":r="rgb(0, 0, 0)";break;case"inherit":case"currentcolor":case"currentColor":r=is(e.element,s[2]);break}if("2px"===a&&("inset"===n||"outset"===n))a="1px";if(r=Ki(r,1,true),r)return t[i]={width:a,style:n,color:r},true}}return false}function qs(e,t,i){let s=e.css(i);if("initial"===s)s="backgroundClip"===i?"border-box":"padding-box";switch(s){case"border-box":return true;case"padding-box":t[i]={top:e.borderTopWidth,right:e.borderRightWidth,bottom:e.borderBottomWidth,left:e.borderLeftWidth};break;case"content-box":t[i]={top:e.borderTopWidth+e.paddingTop,right:e.borderRightWidth+e.paddingRight,bottom:e.borderBottomWidth+e.paddingBottom,left:e.borderLeftWidth+e.paddingLeft};break}return false}function zs(e,t=0){if(""!==(e=e.trim())){let i=cs(e,t);if(!isNaN(i)){if(i<0)i+=360;return i}}return t}function Xs(e){return Cs(e)?e.includes("at ")?/(.+?)?\s*at (.+?)\s*$/.exec(e):[e,e]:null}class ResourceUI extends Resource{static isBackgroundVisible(e){return!!e&&("backgroundImage"in e||"borderTop"in e||"borderRight"in e||"borderBottom"in e||"borderLeft"in e)}static generateId(e,t,i=1){const s=t;let n=i;if(1===i)t+="_"+n;const a=this.STORED.ids,r=a.get(e)||[];do{if(!r.includes(t)){r.push(t);break}else t=s+"_"+ ++n}while(true);return a.set(e,r),t}static insertStoredAsset(e,t,i){const s=ResourceUI.STORED[e];if(s&&_s(i)){let e="";if(s)for(const[t,n]of s.entries())if(ks(i,n)){e=t;break}if(""===e){if(Ts(t))t="__"+t;let n=0;do{if(e=0===n?t:t+"_"+n,!s.has(e)){s.set(e,i);break}}while(++n)}return e}return""}static getOptionArray(e,t){let i=[],s=true;return As(e.children,e=>{if(!e.disabled||t)switch(e.tagName){case"OPTION":{const t=e.text.trim()||e.value.trim();if(""!==t){if(s&&!Ts(t))s=false;i.push(t)}break}case"OPTGROUP":{const[n,a]=this.getOptionArray(e,t);if(n)i=i.concat(n),s=false;else if(a)i=i.concat(a);break}}}),s?[void 0,i]:[i]}static parseBackgroundImage(e,t,i){var s,n;if(""!==t){const a=[];let r,l=0;while(r=Ls.exec(t)){const t=r[0];if(t.startsWith("url(")||"initial"===t)a.push(t);else{const t=!!r[1],o=r[2],c=r[3],h=Ds(e,l,e.css("backgroundSize"),i),d=NodeUI.refitScreen(e,h||e.actualDimension);let u;switch(o){case"linear":{const{width:i,height:s}=d;let n=180;switch(c){case"to top":n=360;break;case"to right top":n=45;break;case"to right":n=90;break;case"to right bottom":n=135;break;case"to bottom":break;case"to left bottom":n=225;break;case"to left":n=270;break;case"to left top":n=315;break;default:if(c)n=zs(c,180)||360;break}let a=ys(gs(n,i)),l=ys(ps(n,s));if(a!==i&&l!==s&&!us(Math.abs(a),Math.abs(l))){let e;if(n<=90)e=ms({x:0,y:s},{x:i,y:0});else if(n<=180)e=ms({x:0,y:0},{x:i,y:s});else if(n<=270)e=ms({x:0,y:0},{x:-i,y:s});else e=ms({x:0,y:s},{x:-i,y:0});const t=Math.abs(e-n);a=ys(gs(n,xs(t,90-t,fs(i,s))[1])),l=ys(ps(n,xs(90,90-n,a)[0]))}const h={type:o,repeating:t,dimension:d,angle:n,angleExtent:{x:a,y:l}};h.colorStops=Hs(e,h,r[4]),u=h;break}case"radial":{const a=Xs(c),l=ts((null==a?void 0:a[2])||"center",d,{fontSize:e.fontSize,imageDimension:h,screenDimension:i}),{left:f,top:g}=l,{width:p,height:m}=d;let b="ellipse",x=g,y=g,v=1/0,w=-1/0,S=0,E=0;if(a){const t=null===(s=a[1])||void 0===s?void 0:s.trim();if(t)if(t.startsWith("circle"))b="circle";else{let i=1/0;const s=t.split(" ");for(let t=0;t<s.length;++t)i=Math.min(0===t?e.parseWidth(s[t],false):e.parseHeight(s[t],false),i);if(S=i,E=i,1===length||s[0]===s[1])b="circle"}}for(const e of[[0,0],[p,0],[p,m],[0,m]]){const t=Math.round(fs(Math.abs(e[0]-f),Math.abs(e[1]-g)));v=Math.min(t,v),w=Math.max(t,w)}for(const e of[p-f,m-g,f])x=Math.min(e,x),y=Math.max(e,y);const _={type:o,repeating:t,dimension:d,shape:b,center:l,closestSide:x,farthestSide:y,closestCorner:v,farthestCorner:w};if(0===S&&0===E){S=w;const e=(null===(n=null==a?void 0:a[1])||void 0===n?void 0:n.split(" ").pop())||"";switch(e){case"closest-corner":case"closest-side":case"farthest-side":{const i=_[Es(e)];if(t)E=i;else S=i;break}default:E=w;break}}_.radius=S,_.radiusExtent=E,_.colorStops=Hs(e,_,r[4]),u=_;break}case"conic":{const t=Xs(c),s={type:o,dimension:d,angle:zs(c),center:ts((null==t?void 0:t[2])||"center",d,{fontSize:e.fontSize,imageDimension:h,screenDimension:i})};s.colorStops=Hs(e,s,r[4]),u=s;break}}a.push(u||"initial")}++l}if(Ls.lastIndex=0,a.length>0)return a}}static getBackgroundSize(e,t,i){let s=0,n=0;switch(t){case"":case"cover":case"contain":case"100% 100%":case"auto":case"auto auto":case"initial":return;default:{const a=t.split(" ");for(let t=0;t<a.length;++t){let r=a[t];if("auto"===r)r="100%";switch(t){case 0:s=e.parseUnit(r,{parent:false,screenDimension:i});break;case 1:n=e.parseUnit(r,{dimension:"height",parent:false,screenDimension:i});break}}break}}return s>0&&n>0?{width:Math.round(s),height:Math.round(n)}:void 0}static hasLineBreak(e,t,i){if(e.naturalElements.length>0)return e.naturalElements.some(e=>e.lineBreak);else if(!t&&e.naturalChild){const t=e.element;let s=t.textContent;if(i)s=s.trim();return s.includes("\n")&&(e.plainText&&ls(t,"whiteSpace","pre","pre-wrap")||e.css("whiteSpace").startsWith("pre"))}return false}static checkPreIndent(e){if(e.plainText){const t=e.actualParent;if(t.preserveWhiteSpace&&t.ascend({condition:e=>"PRE"===e.tagName,startSelf:true}).length>0){let t=e.nextSibling;if(null==t?void 0:t.naturalElement){const i=e.textContent;if(Cs(i)){const e=Fs.exec(i);if(e){if(!t.textElement)t=t.find(e=>e.naturalChild&&e.textElement,{cascade:true,error:e=>e.naturalChild&&!e.textElement&&0===e.length});if(t)return[e[1]?e[0]:"",t]}}}}}}finalize(e){}reset(){super.reset();const e=ResourceUI.STORED;for(const t in e)e[t].clear()}writeRawImage(e,t){const i=this.fileHandler;if(i){const{filename:s,data:n,encoding:a,width:r,height:l}=t;if(s&&n){const t={pathname:Ss(this.userSettings.outputDirectory,this.controllerSettings.directory.image),filename:s,mimeType:e,width:r,height:l};if("string"==typeof n){if("base64"===a)t.base64=n.startsWith("data:image/")?n.substring(n.indexOf(",")+1):n}else if(Array.isArray(n))t.bytes=n;else return;return i.addAsset(t),t}}}setBoxStyle(e){var t;if((e.styleElement||e.visibleStyle.background)&&e.hasResource(Ze.BOX_STYLE)){const i={};let s,n=e.visibleStyle.borderWidth,a=e.backgroundColor;if(n){if(e.borderTopWidth>0)Vs(e,i,"borderTop",Is);if(e.borderRightWidth>0)Vs(e,i,"borderRight",Rs);if(e.borderBottomWidth>0)Vs(e,i,"borderBottom",Ns);if(e.borderLeftWidth>0)Vs(e,i,"borderLeft",Ps)}if(Vs(e,i,"outline",Ms))n=true;if(""===a&&e.has("backgroundColor")&&!e.documentParent.visible)a=e.css("backgroundColor");if(e.hasResource(Ze.IMAGE_SOURCE))s=ResourceUI.parseBackgroundImage(e,e.backgroundImage,e.localSettings.screenDimension);if(a||s||n||e.data(Resource.KEY_NAME,"embedded")){if(i.backgroundColor=(null===(t=Ki(a,1,e.inputElement))||void 0===t?void 0:t.valueAsRGBA)||"",i.backgroundImage=s,Object.assign(i,e.cssAsObject("backgroundSize","backgroundRepeat","backgroundPositionX","backgroundPositionY")),qs(e,i,"backgroundClip"))qs(e,i,"backgroundOrigin");if("0px"!==e.css("borderRadius")){const[t,s,n,a]=e.cssAsTuple("borderTopLeftRadius","borderTopRightRadius","borderBottomRightRadius","borderBottomLeftRadius"),[r,l]=t.split(" "),[o,c]=s.split(" "),[h,d]=n.split(" "),[u,f]=a.split(" "),g=!(l||c||d||f)?[r,o,h,u]:[r,l||r,o,c||o,h,d||h,u,f||u],p=e.actualWidth>=e.actualHeight,m=g[0];if(g.every(e=>e===m))g.length="0px"===m||""===m?0:1;const b=g.length;if(b>0){const t=p?"width":"height";let s=0;while(s<b)g[s]=es(e.parseUnit(g[s++],{dimension:t,parent:false}));i.borderRadius=g}}e.data(ResourceUI.KEY_NAME,"boxStyle",i)}}}setFontStyle(e){if((e.textElement||e.inlineText)&&(!e.textEmpty||e.visibleStyle.background||e.pseudoElement)||e.inputElement){const t=Ki(e.css("color"));let i=e.css("fontWeight");if(!Ts(i))switch(i){case"lighter":i="200";break;case"bold":i="700";break;case"bolder":i="900";break;default:i="400";break}e.data(ResourceUI.KEY_NAME,"fontStyle",{fontFamily:e.css("fontFamily").trim(),fontStyle:e.css("fontStyle"),fontSize:e.fontSize,fontWeight:i,color:(null==t?void 0:t.valueAsRGBA)||""})}}setValueString(e){var t,i,s;const n=e.element;if(n){let a,r,l=false,o=false;switch(n.tagName){case"INPUT":switch(r=hs(n,"value"),n.type){case"radio":case"checkbox":{const t=e.companion;if(false===(null==t?void 0:t.visible))r=t.textContent.trim();break}case"submit":if(""===r&&!e.visibleStyle.backgroundImage)r="Submit";break;case"reset":if(""===r&&!e.visibleStyle.backgroundImage)r="Reset";break;case"time":if(""===r)a="--:-- --";break;case"date":case"datetime-local":if(""===r){switch((new Intl.DateTimeFormat).resolvedOptions().locale){case"en-US":a="mm/dd/yyyy";break;default:a="dd/mm/yyyy";break}if("datetime-local"===n.type)a+=" --:-- --"}break;case"week":if(""===r)a="Week: --, ----";break;case"month":if(""===r)a="--------- ----";break;case"text":case"password":case"url":case"email":case"search":case"number":case"tel":if(""===r)a=n.placeholder;break;case"file":r=$i(4)?"Browse...":"Choose File";break;case"color":{const t=this.controllerSettings.style.inputColorBorderColor,i=(Ki(r)||Ki("rgb(0, 0, 0)")).valueAsRGBA,{width:s,height:n}=e.actualDimension,a=`${s-10}px ${n-10}px, ${s-8}px ${n-8}px`,l="no-repeat, no-repeat",o="center, center",c="center, center",h=ResourceUI.parseBackgroundImage(e,`linear-gradient(${i}, ${i}), linear-gradient(${t}, ${t})`);r="";let d=e.data(ResourceUI.KEY_NAME,"boxStyle");if(d){const e=d.backgroundImage;if(e){d.backgroundSize=a+", "+d.backgroundSize,d.backgroundRepeat=l+", "+d.backgroundRepeat,d.backgroundPositionX=o+", "+d.backgroundPositionX,d.backgroundPositionY=c+", "+d.backgroundPositionY,e.unshift(...h);break}}else d={};e.data(ResourceUI.KEY_NAME,"boxStyle",Object.assign(d,{backgroundSize:a,backgroundRepeat:l,backgroundPositionX:o,backgroundPositionY:c,backgroundImage:h}));break}case"range":a=r,r="";break}break;case"TEXTAREA":r=n.value,a=n.placeholder;break;case"IFRAME":r=n.src;break;default:if(l=true,e.plainText||e.pseudoElement||e.hasAlign(512)&&e.textElement)r=e.textContent.replace(/&/g,"&amp;"),o=true;else if(e.inlineText)r=e.textEmpty?ResourceUI.STRING_SPACE:"BUTTON"===e.tagName?e.textContent:this.removeExcludedFromText(e,n);if(r)switch(r=r.replace(/\u00A0/g,ResourceUI.STRING_SPACE),e.css("whiteSpace")){case"pre":case"pre-wrap":{if(false===(null===(t=e.renderParent)||void 0===t?void 0:t.layoutVertical))r=r.replace(/^\s*\n/,"");const i=ResourceUI.checkPreIndent(e);if(i){const[e,t]=i;if(""!==e)t.textContent=e+t.textContent;r=r.replace(Fs,"")}r=r.replace(/\n/g,"\\n").replace(/\t/g,ResourceUI.STRING_SPACE.repeat(e.toInt("tabSize",8))).replace(/\s/g,ResourceUI.STRING_SPACE),o=true,l=false;break}case"pre-line":r.replace(/\n/g,"\\n").replace(/\s+/g," "),o=true,l=false;break;case"nowrap":r=r.replace(/\n+/g," "),o=true;default:{const t=e.onlyChild&&e.htmlElement;if(t||(null===(i=e.previousSibling)||void 0===i?void 0:i.blockStatic))r=r.replace(Os,"");if(t||(null===(s=e.nextSibling)||void 0===s?void 0:s.blockStatic))r=r.replace(Us,"")}}else if(0===e.naturalChildren.length&&!e.hasPX("height")&&ResourceUI.isBackgroundVisible(e.data(ResourceUI.KEY_NAME,"boxStyle"))&&!Cs(e.textContent))r=e.textContent;break}if(a)e.data(ResourceUI.KEY_NAME,"hintString",a);if(r){if(l)if(e.pageFlow){const t=e.siblingsLeading[0],i=e.siblingsTrailing.find(e=>!e.excluded||e.lineBreak);let s=false;if(r.length>1)if(!t||t.multiline||t.lineBreak||t.floating||t.plainText&&Us.test(t.textContent))r=r.replace(Os,"");else if(t.naturalElement){const e=t.textContent,i=e.length;if(i>0)s=32===e.charCodeAt(i-1)}if(o){const n=!e.lineBreakTrailing&&Us.test(r);if(Os.test(r)&&false===(null==t?void 0:t.block)&&!t.lineBreak&&!s)r=ResourceUI.STRING_SPACE+r.trim();else r=r.trim();if(n&&false===(null==i?void 0:i.blockStatic)&&!i.floating)r+=ResourceUI.STRING_SPACE}else if(!/^[\s\n]+$/.test(r))r=r.replace(Os,t&&(t.block||t.lineBreak||s&&t.htmlElement&&t.textContent.length>1||e.multiline&&ResourceUI.hasLineBreak(e))?"":ResourceUI.STRING_SPACE),r=r.replace(Us,"table-cell"===e.display||e.lineBreakTrailing||e.blockStatic||(null==i?void 0:i.floating)?"":ResourceUI.STRING_SPACE);else if(!e.inlineText)return}else r=r.trim();if(r)e.data(ResourceUI.KEY_NAME,"valueString",r)}}else if(e.inlineText){const t=e.textContent;if(t)e.data(ResourceUI.KEY_NAME,"valueString",t)}}removeExcludedFromText(e,t){const{preserveWhiteSpace:i,sessionId:s}=e,n=t.children.length>0||"CODE"===t.tagName,a=n?"innerHTML":"textContent";let r=t[a]||"";if(t.childNodes.forEach((e,t)=>{const l=ws(e,s);if(!l||!l.textElement||!l.pageFlow||l.positioned||l.pseudoElement||l.excluded){if(l)if(n&&l.htmlElement){const e=l.toElementString("outerHTML");if(l.lineBreak)r=r.replace(!i?new RegExp(`\\s*${e}\\s*`):e,"\\n");else if(l.positioned)r=r.replace(e,"");else if(!i)r=r.replace(e,l.pageFlow&&Cs(l.textContent)?ResourceUI.STRING_SPACE:"");return}else{const e=l.plainText?l.textContent:l[a];if(Cs(e)){if(!i)r=r.replace(e,"");return}}else if(ss(e))r=r.replace(e.outerHTML,!ns(getComputedStyle(e).getPropertyValue("position"))&&Cs(e.textContent)?ResourceUI.STRING_SPACE:"");if(!i)if(0===t)r=r.replace(Os,"");else if(t===length-1)r=r.replace(Us,"")}}),!n)return r;else if(!i&&/^[\s\n]+$/.test(r))return e.blockStatic?ResourceUI.STRING_SPACE:"";return r.replace(/&#(\d+);/g,(e,t)=>String.fromCharCode(parseInt(t)))}get controllerSettings(){return this.application.controllerHandler.localSettings}get mapOfStored(){return ResourceUI.STORED}}ResourceUI.STRING_SPACE="&#160;",ResourceUI.STORED={ids:new Map,strings:new Map,arrays:new Map,fonts:new Map,colors:new Map,images:new Map};const{formatPercent:Gs,formatPX:js,isLength:Ys,isPercent:$s,isPx:Ks}=squared.lib.css,{maxArray:Qs}=squared.lib.math,{isNumber:Js,plainMap:Zs,safeNestedArray:en,trimString:tn,withinRange:sn}=squared.lib.util,nn="[\\d.]+[a-z%]+|auto|max-content|min-content",an="minmax\\(\\s*([^,]+),\\s+([^)]+)\\s*\\)",rn=new RegExp(`^${nn}$`),ln=new RegExp(`\\s*(repeat\\(\\s*(auto-fit|auto-fill|\\d+),\\s+(.+)\\)|\\[([\\w\\s\\-]+)\\]|${an}|fit-content\\(\\s*([\\d.]+[a-z%]+)\\s*\\)|${nn}\\s*)\\s*`,"g"),on=new RegExp(`\\s*(\\[([\\w\\s\\-]+)\\]|${an}|fit-content\\(\\s*([\\d.]+[a-z%]+)\\s*\\)|${nn})\\s*`,"g"),cn=new RegExp(nn),hn=new RegExp(an),dn=new RegExp("fit-content\\(\\s*([\\d.]+[a-z%]+)\\s*\\)"),un=new RegExp("\\[([\\w\\s\\-]+)\\]");function fn(e,t){const i=e.repeat,s=[],n=[],a=t.length;for(let e=0;e<a;++e)if(i[e])n.push(t[e]);else s.push(t[e]);const r=e.length,l=r-s.length,o=new Array(r);for(let e=0;e<r;++e)if(i[e]){for(let t=0,i=0;t<l;++e,++t,++i){if(i===n.length)i=0;o[e]=n[i]}--e}else o[e]=s.shift();return o}function gn(e,t){const i=e.unit;if(1===i.length&&(e.autoFill||e.autoFit)){const s=e.unitMin;let n=0;for(const e of[i[0],s[0]])if($s(e))n=Math.max(parseFloat(e)/100*t,n);else if(Ys(e))n=Math.max(parseFloat(e),n);if(n>0)return e.length=Math.floor(t/(n+e.gap)),e.unit=fn(e,i),e.unitMin=fn(e,s),true}return false}function pn(e,t,i,s,n){let a=0,r=0,l=1;const o=s.length;let c=0;while(c<o){const e=s[c++];if(Ks(e))a+=parseFloat(e);else if(CssGrid.isFr(e))r+=parseFloat(e);else if($s(e))l-=parseFloat(e)/100}if(l<1&&r>0){const h=(e*l-(i-1)*t-n.reduce((e,t)=>e+Math.max(0,t),0)-a)/r;if(h>0)for(c=0;c<o;++c){const e=s[c];if(CssGrid.isFr(e))s[c]=js(parseFloat(e)*h)}}}function mn(e,t){if(0===e.length){let i=0;while(i<t)e[i++]="1fr"}}function bn(e,t,i){if(i){for(let s=0,n=-1,a=0;s<e;++s)if(0===i[s]){if(-1===n)n=s;if(++a===t)return n}else n=-1;return-1}return 0}function xn(e){const t=e.length;for(let i=0;i<t;++i)for(const t of e[i])if(0===t)return i;return Math.max(0,t-1)}function yn(e,t,i,s){let n=t.unit,a=n.length;if(a<i)if(t.autoFill||t.autoFit){if(0===a)n.push("auto"),t.unitMin.push(""),t.repeat.push(true);n=fn(t,n),t.unit=n,t.unitMin=fn(t,t.unitMin)}else{const e=t.auto,s=e.length;if(s>0){let t=0;while(n.length<i){if(t===s)t=0;n.push(e[t++])}}}else if(t.autoFit||t.autoFill&&(s&&e.blockStatic&&!e.hasWidth&&!e.hasPX("maxWidth",{percent:false})||!s&&!e.hasHeight))n.length=i;let r=1,l=0,o=0;a=n.length;let c=0;while(c<a){const e=n[c++];if($s(e))r-=parseFloat(e)/100;else if(CssGrid.isFr(e))l+=parseFloat(e);else if("auto"===e)++o}if(t.flexible=r<1||l>0,r<1)if(l>0)for(c=0;c<a;++c){const e=n[c];if(CssGrid.isFr(e))n[c]=r*(parseFloat(e)/l)+"fr"}else if(1===o){const e=n.findIndex(e=>"auto"===e);if(-1!==e)n[e]=Gs(r)}}const vn=(e,t,i)=>Ys(t)?js(e.parseUnit(t,{dimension:0!==i?"width":"height"})):t;class CssGrid extends ExtensionUI{static createDataRowAttribute(e=0){return{length:0,gap:e,unit:[],unitMin:[],unitTotal:[],repeat:[],auto:[],autoFill:false,autoFit:false,name:{},fixedWidth:false,flexible:false,frTotal:0}}is(e){return e.gridElement}condition(e){return e.length>0}processNode(e){const t=function(e){const t=e.cssAsObject("alignItems","alignContent","justifyItems","justifyContent","gridAutoFlow");return Object.assign(t,{children:[],rowData:[],rowSpanMultiple:[],rowDirection:!t.gridAutoFlow.includes("column"),dense:t.gridAutoFlow.includes("dense"),templateAreas:{},row:CssGrid.createDataRowAttribute(e.parseHeight(e.css("rowGap"),false)),column:CssGrid.createDataRowAttribute(e.parseWidth(e.css("columnGap"),false)),emptyRows:[],minCellHeight:0})}(e),{column:i,dense:s,row:n,rowDirection:a}=t,r=[],l=[],o=[],c=[e.cssInitial("gridTemplateRows"),e.cssInitial("gridTemplateColumns"),e.css("gridAutoRows"),e.css("gridAutoColumns")],[h,d,u,f]=a?[0,1,2,3]:[1,0,3,2];let g,p=false,m=false;for(let t=0;t<4;++t){const s=c[t];if(""!==s&&"none"!==s&&"auto"!==s){const a=0===t?n:i,{name:r,repeat:l,unit:o,unitMin:c}=a;let h,d=1;while(h=ln.exec(s)){const s=h[1].trim();switch(t){case 0:case 1:if(s.startsWith("["))for(const e of h[4].split(/\s+/))en(r,e).push(d);else if(s.startsWith("repeat")){let i=1;switch(h[2]){case"auto-fit":a.autoFit=true;break;case"auto-fill":a.autoFill=true;break;default:i=parseInt(h[2])||1;break}if(i>0){const s=[];let n;while(n=on.exec(h[3])){const i=n[1];let a;if(a=un.exec(i)){const e=a[1];if(!r[e])r[e]=[];s.push({name:e})}else if(a=hn.exec(i))s.push({unit:vn(e,a[2],t),unitMin:vn(e,a[1],t)});else if(a=dn.exec(i))s.push({unit:vn(e,a[1],t),unitMin:"0px"});else if(a=cn.exec(i))s.push({unit:vn(e,a[0],t)})}if(s.length>0)for(let e=0;e<i;++e)for(let e=0;e<s.length;++e){const t=s[e];if(t.name)r[t.name].push(d);else if(t.unit)o.push(t.unit),c.push(t.unitMin||""),l.push(true),++d}on.lastIndex=0}}else if(s.startsWith("minmax"))o.push(vn(e,h[6],t)),c.push(vn(e,h[5],t)),l.push(false),++d;else if(s.startsWith("fit-content"))o.push(vn(e,h[7],t)),c.push("0px"),l.push(false),++d;else if(rn.test(s))o.push(vn(e,s,t)),c.push(""),l.push(false),++d;break;case 2:case 3:(2===t?n:i).auto.push(Ys(s)?js(e.parseUnit(s,{dimension:2!==t?"width":"height"})):s);break}}ln.lastIndex=0}}if(a)e.sort((e,t)=>{const i=e.linear,s=t.linear;if(!sn(i.top,s.top))return i.top<s.top?-1:1;else if(!sn(i.left,s.left))return i.left<s.left?-1:1;return 0});else e.sort((e,t)=>{const i=e.linear,s=t.linear;if(!sn(i.left,s.left))return i.left<s.left?-1:1;else if(!sn(i.top,s.top))return i.top<s.top?-1:1;return 0});if(!e.has("gridTemplateAreas")&&e.every(e=>"auto"===e.css("gridRowStart")&&"auto"===e.css("gridColumnStart"))){const[s,r,l,c,h]=a?["top","bottom",2,1,3]:["left","right",3,0,2];let d,u=0,f=0,g=0;if(a){if(i.autoFill)p=gn(i,e.actualWidth)}else if(n.autoFill)m=gn(n,e.actualHeight);e.each((e,i)=>{if(!d||e.linear[s]>=d.linear[r]||f>0&&f===g)g=Math.max(f,g),++u,f=1;const[n,p]=e.cssAsTuple("gridRowEnd","gridColumnEnd");let m=1,b=1;if(n.startsWith("span"))m=parseInt(n.split(" ")[1]);else if(Js(n))m=parseInt(n)-u;if(p.startsWith("span"))b=parseInt(p.split(" ")[1]);else if(Js(p))b=parseInt(p)-f;if(1===f&&g>0){let e=false;do{const i=new Array(g-1).fill(1);for(const e of o){const t=e.placement;if(t[l]>u)for(let e=t[c];e<t[h];++e)i[e-1]=0}const s=i.length;for(let t=0,n=0,a=0;t<s;++t)if(i[t]){if(0===n)a=t;if(++n===b){f=a+1,e=true;break}}else n=0;if(!e)t.emptyRows[u-1]=i,++u}while(!e)}if(a)o[i]={outerCoord:e.linear.top,placement:[u,f,u+m,f+b],rowSpan:m,columnSpan:b};else o[i]={outerCoord:e.linear.left,placement:[f,u,f+b,u+m],rowSpan:m,columnSpan:b};f+=b,d=e})}else{const s=t.templateAreas;let r;p=gn(i,e.actualWidth),m=gn(n,e.actualHeight),e.css("gridTemplateAreas").split(/"[\s\n]+"/).forEach((e,t)=>{if("none"!==e)tn(e.trim(),'"').split(/\s+/).forEach((e,i)=>{if("."!==e.charAt(0)){const n=s[e];if(n)n.rowSpan=t-n.rowStart+1,n.columnSpan=i-n.columnStart+1;else s[e]={rowStart:t,rowSpan:1,columnStart:i,columnSpan:1}}})}),e.each((e,t)=>{const l=e.cssAsTuple("gridRowStart","gridColumnStart","gridRowEnd","gridColumnEnd"),c=[0,0,0,0];let h=-1,d=-1;if(Object.keys(s).length)for(let e=0;e<4;++e){const t=l[e];let i=s[t];if(i)switch(e){case 0:c[0]=i.rowStart+1;break;case 1:c[1]=i.columnStart+1;break;case 2:c[2]=i.rowStart+i.rowSpan+1;break;case 3:c[3]=i.columnStart+i.columnSpan+1;break}else{const n=/^([\w-]+)-(start|end)$/.exec(t);if(n)if(i=s[n[1]],i)if("start"===n[2])switch(e){case 0:case 2:c[e]=i.rowStart+1;break;case 1:case 3:c[e]=i.columnStart+1;break}else switch(e){case 0:case 2:c[e]=i.rowStart+i.rowSpan+1;break;case 1:case 3:c[e]=i.columnStart+i.columnSpan+1;break}}}if(0===c[0]||0===c[1]||0===c[2]||0===c[3]){const e=(e,t,i,s)=>{if(Js(e)){const i=parseInt(e);if(i>0)return c[t]=i,true;else if(i<0&&t>=2){const e=t-2;return c[c[e]>0?t:e]=i+s+2,true}}else if(e.startsWith("span")){const n=parseInt(e.split(" ")[1]);if(n===s&&r)if(a){if(!i){const e=r[2];if(e>0&&0===c[0])c[0]=e}}else if(i){const e=r[3];if(e>0&&0===c[1])c[1]=e}const o=c[t-2];switch(t){case 0:{const e=l[2];if(Js(e)){const t=parseInt(e);c[0]=t-n,c[2]=t}break}case 1:{const e=l[3];if(Js(e)){const t=parseInt(e);c[1]=t-n,c[3]=t}break}case 2:case 3:if(o>0)c[t]=o+n;break}if(i){if(-1===h)h=n}else if(-1===d)d=n;return true}return false};let t,s;for(let a=0;a<4;++a){const r=l[a];if("auto"!==r&&0===c[a]){const o=a%2==0,u=o?n:i;if(!e(r,a,o,Math.max(1,u.unit.length))){const e=r.split(" ");if(1===e.length)e[1]=e[0],e[0]="1";else if(Js(e[0]))if(o)if(t)h=parseInt(e[0])-parseInt(t[0]);else t=e;else if(s)d=parseInt(e[0])-parseInt(s[0]);else s=e;const i=u.name[e[1]];if(i){const t=parseInt(e[0]);if(t<=i.length)c[a]=i[t-1]+(e[1]===l[a-2]?1:0)}}}}}if(!r){if(0===c[0])c[0]=1;if(0===c[1])c[1]=1}const[u,f,g,p]=c;if(-1===h)h=u>0&&g>0?g-u:1;else if(u>0&&0===g)c[2]=u+h;if(-1===d)d=f>0&&p>0?p-f:1;else if(f>0&&0===p)c[3]=u+d;if(0===c[2]&&c[0]>0)c[2]=c[0]+h;if(0===c[3]&&c[1]>0)c[3]=c[1]+d;o[t]={outerCoord:a?e.bounds.top:e.bounds.left,placement:c,rowSpan:h,columnSpan:d},r=c})}{let t=1,s=0,r=0;while(r<o.length){const i=o[r++];if(i){const[n,r,l]=a?[i.columnSpan,1,3]:[i.rowSpan,0,2],o=i.placement;if(o.some(e=>e>0))t=Math.max(t,n,o[r],o[l]-1);if(sn(i.outerCoord,a?e.box.top:e.box.left))s+=n}}g=Math.max(t,s,a&&!p?i.unit.length:0,!a&&!m?n.unit.length:0)}e.each((e,i)=>{const{placement:n,rowSpan:c,columnSpan:p}=o[i],[m,b]=a?[c,p]:[p,c];while(0===n[0]||0===n[1]){const e=n.slice(0);if(0===e[h]){let t=r.length;for(let i=s?0:xn(l),n=0,a=-1;i<t;++i){if(-1!==bn(g,b,l[i])){if(0===n)a=i,t=Math.max(t,i+m);if(++n===m){e[h]=a+1;break}}else n=0,a=-1,t=r.length}}if(0===e[h]){if(n[h]=r.length+1,0===n[d])n[d]=1}else if(0===e[d]){if(0===e[u])e[u]=e[h]+m;const t=[],i=e[h]-1,s=e[u]-1;let n=i;while(n<s){const e=r[n++];if(!e)t.push([[0,-1]]);else if(e.reduce((e,t)=>e+(t?1:0),0)+b<=g){const i=[];let s=0;for(let t=0,n=-1;t<g;++t){const a=e[t];if(!a){if(-1===n)n=t;++s}if(a||t===g-1){if(s>=b)i.push([n,n+s]);n=-1,s=0}}if(i.length>0)t.push(i);else break}else break}const a=t.length;if(a>0){const r=t[0];if(-1===r[0][1])e[d]=1;else if(a===s-i)if(a>1)e:{const i=r.length;n=0;while(n<i){const i=r[n++];for(let s=i[0];s<i[1];++s){let i=1;while(i<a){const n=t[i++];let a=0;while(a<n.length){const t=n[a++];if(s>=t[0]&&(-1===t[1]||s+b<=t[1])){e[d]=s+1;break e}}}}}}else e[d]=r[0][0]+1}}const t=e[h];if(t>0){const i=e[d];if(i>0)n[h]=t,n[d]=i}}if(0===n[u])n[u]=n[h]+m;if(0===n[f])n[f]=n[d]+b;if(function(e,t,i,s,n,a,r,l,o,c){if(l.every(e=>e>0)){for(let h=l[i]-1;h<l[s]-1;++h){const i=en(e,h);let s=t[h],d=l[n]-1;if(!s){if(s=new Array(o).fill(0),!c){let e=0;while(e<d)s[e++]=1}t[h]=s}while(d<l[a]-1)en(i,d).push(r),s[d++]=1}return true}return false}(r,l,h,u,d,f,e,n,g,s)){const[i,r,o,c]=n,h=i-1,d=o-i,u=r-1;if(!s){const e=a?h:u;if(e>0){const t=l[e-1];let i=0;while(i<g)t[i++]=1}}if(d>1){const e=t.rowSpanMultiple,i=h+d;let s=h;while(s<i)e[s++]=true}e.data(this.name,"cellData",{rowStart:h,rowSpan:d,columnStart:u,columnSpan:c-r})}});let b=r.length;if(b>0){let s;if(a)s=r,t.rowData=r,b=Math.max(Qs(Zs(r,e=>e.length)),i.unit.length);else{let e;s=t.rowData;for(let t=0;t<b;++t){const i=r[t],n=i.length;e=0;while(e<n)en(s,e)[t]=i[e++]}}const l=a?n.unitTotal:i.unitTotal,o=t.children;{const e=s.length;let t,i,n=0;while(n<e){const e=s[n++],r=e.length;t=0;while(t<r){const s=e[t];let n=l[t]||0;if(s){let e=0;const t=s.length;i=0;while(i<t){const t=s[i++];if(!o.includes(t))e=Math.max(e,a?t.bounds.height:t.bounds.width),o.push(t)}n+=e}l[t++]=n}}}if(o.length===e.length){const{gap:r,unit:l}=n,c=i.gap,h=Math.max(l.length,s.length),d=new Array(h).fill(0),u=new Array(b).fill(0),f=new Set;n.length=h,i.length=b;let g=0;for(let e=0;e<h;++e){const i=s[e],n=l[e];if(i)for(let s=0;s<b;++s){const n=i[s];if(n){const t=n.length;let i=0;while(i<t){const t=n[i++];if(!f.has(t)){const{columnSpan:i,rowSpan:n}=t.data(this.name,"cellData"),a=s+i-1,l=e+n-1;if(c>0&&a<b-1)t.modifyBox(2,c);if(r>0&&l<h-1)t.modifyBox(4,r);if(1===n){const i=t.bounds.height,s=d[e];if(t.hasHeight)if(s<0){if(i>Math.abs(s))d[e]=i}else d[e]=Math.max(i,s);else if(i>Math.abs(s))d[e]=-i;g=Math.max(i,g)}if(1===i){const e=t.bounds.width,i=u[s];if(t.hasWidth)if(i<0){if(e>Math.abs(i))u[s]=e}else u[s]=Math.max(e,i);else if(e>Math.abs(i))u[s]=-e}f.add(t)}}}else if(!a)t.emptyRows[s]=[1/0]}else{if(Js(n))d[e]=parseFloat(n);if(a)t.emptyRows[e]=[1/0]}}if(t.minCellHeight=g,a){if(e.hasPX("width",{percent:false}))i.fixedWidth=true,i.flexible=false,pn(e.actualWidth,c,b,i.unit,u);if(e.hasHeight&&!CssGrid.isAligned(e))mn(n.unit,h)}else{if(e.hasPX("height",{percent:false}))n.fixedWidth=true,n.flexible=false,pn(e.actualHeight,r,h,l,d);if(e.hasWidth&&!CssGrid.isJustified(e))mn(i.unit,b)}if(e.retainAs(o),e.cssSort("zIndex",{byInt:true}),e.cssTry("display","block"))e.each(e=>{const{width:t,height:i}=e.boundingClientRect;e.data(this.name,"boundsData",Object.assign(Object.assign({},e.bounds),{width:t,height:i}))}),e.cssFinally("display");yn(e,i,b,true),yn(e,n,h,false),e.data(this.name,"mainData",t)}}}}CssGrid.isFr=e=>/\dfr$/.test(e),CssGrid.isAligned=e=>e.hasHeight&&/^space-|center|flex-end|end/.test(e.css("alignContent")),CssGrid.isJustified=e=>(e.blockStatic||e.hasWidth)&&/^space-|center|flex-end|end|right/.test(e.css("justifyContent"));const{withinRange:wn}=squared.lib.util;const{aboveRange:Sn,belowRange:En,safeNestedArray:_n,withinRange:kn}=squared.lib.util;function Tn(e,t){const i=t.bounds.top,s=e.length;let n=0;while(n<s){const t=e[n++].findIndex(e=>{if(!e)return false;const t=e.bounds.top;return kn(i,t)||Math.ceil(i)>=t&&i<Math.floor(e.bounds.bottom)});if(-1!==t)return t}return-1}class Grid extends ExtensionUI{static createDataCellAttribute(){return{rowSpan:0,columnSpan:0,index:-1,cellStart:false,cellEnd:false,rowEnd:false,rowStart:false}}condition(e){if(e.length>1&&!e.layoutElement&&"TABLE"!==e.tagName&&!e.has("listStyle"))if("table"===e.display)return e.every(e=>"table-row"===e.display&&e.every(e=>"table-cell"===e.display))||e.every(e=>"table-cell"===e.display);else if(0===e.percentWidth||!e.find(e=>e.percentWidth>0,{cascade:true})){let t=false,i=0;for(const s of e)if(s.pageFlow&&s.blockStatic&&!s.visibleStyle.background&&0===s.percentWidth&&!s.autoMargin.leftRight&&!s.autoMargin.left){if(s.length>1)t=true;if("list-item"===s.display&&!s.has("listStyleType"))++i}else return false;return i===e.length||t&&e.every(e=>e.length>0&&NodeUI.linearData(e.children).linearX)}return false}processNode(e){var t;const i=[],s={},n=[];e.each(e=>{e.each(e=>{if(e.visible)_n(s,Math.floor(e.linear.left)).push(e)})});const a=Object.keys(s),r=a.length;if(r>0){let l=-1;for(let e=0;e<r;++e){const t=s[a[e]];if(0===e)l=r;else if(l!==t.length){l=-1;break}}if(-1!==l){let e=0;while(e<r)n.push(s[a[e++]])}else{const l=[];for(let e=0;e<r;++e){const t=s[a[e]],i=t.length;if(0===e&&0===i)return;l[e]=0===e?0:l[e-1];for(let s=0;s<i;++s){const a=t[s],{left:r,right:o}=a.linear;if(0===e||Sn(r,l[e-1])){const t=_n(n,e);if(0===e||n[0].length===i)t[s]=a;else{const e=Tn(n,a);if(-1!==e)t[e]=a;else return}}else{const e=n[n.length-1];if(e){let t=1/0,i=-1/0,s=0;while(s<e.length){const n=e[s++].linear;t=Math.min(n.left,t),i=Math.max(n.right,i)}if(Math.floor(r)>Math.ceil(t)&&Math.floor(o)>Math.ceil(i)){const t=Tn(n,a);if(-1!==t){s=n.length-1;while(s>=0){const i=n[s--];if(i){if(!i[t])e.length=0;break}}}}}}l[e]=Math.max(o,l[e])}}const o=l.length;for(let e=0,t=-1;e<o;++e)if(!n[e]){if(-1===t)t=e-1;else if(e===o-1)l[t]=l[e]}else if(-1!==t)l[t]=l[e-1],t=-1;for(let e=0;e<n.length;++e)if(null===(t=n[e])||void 0===t?void 0:t.length)i.push(l[e]);else n.splice(e--,1);const c=n.reduce((e,t)=>Math.max(e,t.length),0);for(let e=0;e<c;++e){const t=n.length;let i=0;while(i<t){const t=n[i++];if(!t[e])t[e]={spacer:1}}}i.push(e.box.right)}}const l=n.length;if(l>1&&n[0].length===e.length){const t=[],s=new Set;for(let e=0,a=0;e<l;++e){const r=n[e],o=r.length;for(let c=0,h=0,d=0;c<o;++c){const u=r[c],f=_n(t,c);if(!u.spacer){const t=Object.assign(Grid.createDataCellAttribute(),u.data(this.name,"cellData"));let g=1,p=1+d,m=e+1;while(m<l){const e=n[m++][c];if(1===e.spacer)++p,e.spacer=2;else break}if(1===p){m=c+1;while(m<o){const e=r[m++];if(1===e.spacer)++g,e.spacer=2;else break}}if(i.length>0){const n=Math.min(e+(p-1),i.length-1),a=u.actualParent.naturalChildren,r=a.length;m=0;while(m<r){const e=a[m++];if(!s.has(e)&&e.visible&&!e.rendered){const{left:s,right:a}=e.linear;if(Sn(s,u.linear.right)&&En(a,i[n]))_n(t,"siblings").push(e)}}}t.rowSpan=g,t.columnSpan=p,t.rowStart=0==h++,t.rowEnd=p+e===l,t.cellStart=0==a++,t.cellEnd=t.rowEnd&&c===o-1,t.index=e,d=0,u.data(this.name,"cellData",t),f.push(u),s.add(u)}else if(1===u.spacer)++d}}e.each(e=>e.hide()),e.clear();const a=t.length;let r,o=0;while(o<a){const i=t[o++],s=i.length;r=0;while(r<s)i[r++].parent=e}if(e.tableElement&&"collapse"===e.css("borderCollapse"))e.resetBox(240);e.data(this.name,"columnCount",l)}}}const{convertListStyle:Cn}=squared.lib.css,{isNumber:An}=squared.lib.util,In=e=>e.backgroundImage&&!e.backgroundRepeat;const{assignRect:Rn}=squared.lib.dom,{convertFloat:Nn,withinRange:Pn}=squared.lib.util;const{getBackgroundPosition:Mn,resolveURL:Bn}=squared.lib.css;const{formatPercent:Ln,formatPX:Wn,getInheritedStyle:Fn,getStyle:On,isLength:Un,isPercent:Hn}=squared.lib.css,{getNamedItem:Dn}=squared.lib.dom,{maxArray:Vn}=squared.lib.math,{isNumber:qn,replaceMap:zn,safeNestedArray:Xn,withinRange:Gn}=squared.lib.util;function jn(e,t,i){i.percent=Math.round(t.bounds.width/e.box.width*100)+"%",i.expand=true}function Yn(e,t,i){const s=t+"Style";e.ascend({including:i}).some(i=>{if(i.has(s)){const n=t+"Color",a=t+"Width";return e.css("border","inherit"),e.cssApply(i.cssAsObject(s,n,a)),e.unsetCache(a),true}return false})}function $n(e){e.exclude({resource:Ze.ALL}),e.hide()}const Kn=e=>e.css("width",Wn(e.bounds.width),true);const{isLength:Qn}=squared.lib.css;var Jn;const{formatPX:Zn}=squared.lib.css,{maxArray:ea}=squared.lib.math,{getElementCache:ta}=squared.lib.session,{iterateReverseArray:ia}=squared.lib.util,sa="html"===(null===(Jn=document.doctype)||void 0===Jn?void 0:Jn.name);function na(e,t,i,s=0){let n;switch(t){case 1:n=e.actualRect("top")-i;break;case 8:n=e.actualRect("left")-i;break;case 4:n=i-e.actualRect("bottom");break;default:n=0;break}if(n-=s,n>0)(e.renderAs||e).modifyBox(t,n)}function aa(e,t,i){if(1===e.getBox(t)[0]){const s=e.registerBox(t);if(s){const[e,n]=s.getBox(t);if(i=Math.max(n,i),1===e)s.setBox(t,{adjustment:i});else s.setCacheValue("marginTop",i);return}}e.setBox(t,{reset:1,adjustment:i})}function ra(e,t,i){if(!i||la(t,true)){const[s,n,a,r]=i?["marginTop","borderTopWidth","paddingTop",1]:["marginBottom","borderBottomWidth","paddingBottom",4];if(0===e[n])if(0===e[a]){let l=t;while(sa&&0===l[s]&&0===l[n]&&0===l[a]&&ua(l))if(i){const e=l.firstStaticChild;if(la(e,i))l=e;else break}else{const e=ca(l);if(e)l=e;else break}const o=e[s],c=l[s];if(o>=0&&c>=0){const n=l.bounds.height;let a=false;if(!sa&&0===o&&c>0&&""===l.cssInitial(s))a=true;else{const s=o>=c;if(0===n&&s&&l.textEmpty&&0===l.extensions.length)l.hide({collapse:true});else{const n=l.registerBox(r);if(n){const t=n.getBox(r)[1];if(t>0){if(t>o)aa(e,r,t);n.setBox(r,{reset:1,adjustment:0})}}else if(0===l.getBox(r)[0])if(s)a=c>0;else if(e.documentBody){if(da(e,r),i){if(e.bounds.top>0)e.bounds.top=0,e.unset("box"),e.unset("linear");if(e.layoutVertical){const i=e.renderChildren[0];if((l.positionStatic||l.top>=0&&!l.hasPX("bottom"))&&i!==t.outerMostWrapper)aa(i,r,c),aa(l,r,0),a=true}}}else aa(e,r,c),a=true}}if(a){if(da(l,r),!i&&l.floating){const e=l.actualParent.naturalChildren,t=e.length;let i=0;while(i<t){const t=e[i++];if(t.floating&&t!==l&&t.intersectY(l.bounds,"bounds"))da(t,r)}}if(0===n&&!l.every(e=>e.floating||!e.pageFlow))da(l,i?4:1)}}else if(o<0&&c<0)if(!i){if(c<o)aa(e,r,c);da(l,r)}}else if(0===t[s]&&0===t[n]&&ua(t)){let r=true;do{const l=i?t.firstStaticChild:t.lastStaticChild;if(l&&0===l[s]&&0===l[n]&&!l.visibleStyle.background&&ua(l)){const s=l[a];if(s>0){if(s>=e[a])e.setBox(i?16:64,{reset:1});else if(r)e.modifyBox(i?16:64,-s,false);break}else{if(!la(l,i))r=false;t=l}}else break}while(true)}}}function la(e,t){if(!e||!e.styleElement||e.lineBreak)return false;else if(e.blockStatic)return true;else if(!e.floating){switch(e.display){case"table":case"list-item":return true;case"inline-flex":case"inline-grid":case"inline-table":return false}if(t){const t=e.firstStaticChild;return la(t)&&fa(t,false)}else if(false===t){const t=e.lastStaticChild;return la(t)&&ga(t,false)}}return false}function oa(e,t,i,s){let n=1/0;if(e.nodeGroup&&e.some(e=>e.floating))e.renderEach(t=>{if(!t.floating){const i=t.linear.top;if(i<n)n=i,e=t}});if(n===1/0)n=e.linear.top;if(s){const a=Math.max(s.linear.top,t.linear.bottom);if(a<n)return[n-a-i,e]}return[Math.round(n-t.linear.bottom-i),e]}function ca(e){let t;if(!e.floatContainer){if(t=e.lastStaticChild,!la(e,false)||t&&e.hasHeight&&Math.floor(t.linear.bottom)<e.box.bottom)t=void 0}else{let i;const s=e.naturalChildren;let n=s.length-1;while(n>=0){const a=s[n--];if(a.floating){if(!t){const t=a.linear.bottom;if(i){if(t>i.linear.bottom)i=a}else if(Math.ceil(a.linear.bottom)>=e.box.bottom)i=a}else if(a.linear.bottom>=t.linear.bottom){t=a;break}}else if(!t){if(i&&i.linear.bottom>a.linear.bottom){t=i;break}t=a}}if(!t)t=i}return t}function ha(e){for(const t of[e.cssInitial("overflow"),e.cssInitial("overflowX"),e.cssInitial("overflowY")])switch(t){case"auto":case"hidden":case"overlay":return true}return false}function da(e,t,i){if(e.setBox(t,{reset:1}),i)e.registerBox(t,i)}const ua=(e,t=true)=>(!t&&e.blockStatic||t&&e.length>0&&!e.floating)&&!e.layoutElement&&!e.tableElement&&"FIELDSET"!==e.tagName,fa=(e,t)=>!e.hasHeight&&0===e.borderBottomWidth&&0===e.paddingBottom&&ua(e,t),ga=(e,t)=>!e.hasHeight&&0===e.borderTopWidth&&0===e.paddingTop&&ua(e,t),pa=e=>e.pageFlow&&e.blockDimension&&!e.floating&&!e.excluded;var ma=Object.freeze({__proto__:null,EXT_NAME:{ACCESSIBILITY:"squared.accessibility",COLUMN:"squared.column",CSS_GRID:"squared.css-grid",FLEXBOX:"squared.flexbox",GRID:"squared.grid",LIST:"squared.list",RELATIVE:"squared.relative",SPRITE:"squared.sprite",TABLE:"squared.table",VERTICAL_ALIGN:"squared.verticalalign",WHITESPACE:"squared.whitespace"}});const ba={Accessibility:class Accessibility extends ExtensionUI{},Column:class Column extends ExtensionUI{is(e){return e.length>1&&e.blockDimension&&"table"!==e.display&&!e.layoutElement}condition(e){return e.has("columnCount")||e.hasPX("columnWidth")}processNode(e,t){let i=[],s=1/0,n=false;const a=[i];if(e.each(e=>{var t;if("all"===e.css("columnSpan")){if(i.length>0)a.push([e]);else i.push(e);i=[],a.push(i)}else{if(e.textElement&&(null===(t=e.textBounds)||void 0===t?void 0:t.overflow))s=NaN;if(e.multiline)n=true;else if(!isNaN(s))s=Math.min(e.bounds.width,s);i.push(e)}}),0===i.length)a.pop();const[r,l,o]=e.cssAsTuple("columnRuleStyle","columnRuleWidth","columnRuleColor"),c=e.box.width,h=e.toInt("columnCount"),d=e.parseWidth(e.css("columnWidth"));let u,f=e.parseWidth(e.css("columnGap"));const g=()=>isNaN(h)&&d>0?c/(d+f):1/0;if(f>0)u=Math.floor(g());else f=(d>0&&!isNaN(s)&&s!==1/0?Math.max(s-d,0):0)+16,u=Math.ceil(g());e.data(this.name,"mainData",{rows:a,columnCount:h,columnWidth:d,columnGap:f,columnSized:u,columnRule:{borderLeftStyle:r,borderLeftWidth:l,borderLeftColor:o},boxWidth:t.actualBoxWidth(c),multiline:n})}},CssGrid:CssGrid,Flexbox:class Flexbox extends ExtensionUI{is(e){return e.flexElement}condition(e){return e.length>0}processNode(e){const t=this.controller,[i,s]=e.partition(e=>e.pageFlow),n=function(e,t){return Object.assign(Object.assign({},e.flexdata),{rowCount:0,columnCount:0,children:t})}(e,i);if(e.cssTry("align-items","start")){if(e.cssTry("justify-items","start")){const t=i.length;let s=0;while(s<t){const e=i[s++];if(e.cssTry("align-self","start")){if(e.cssTry("justify-self","start")){const{width:t,height:i}=e.boundingClientRect;e.data(this.name,"boundsData",Object.assign(Object.assign({},e.bounds),{width:t,height:i})),e.cssFinally("justify-self")}e.cssFinally("align-self")}}e.cssFinally("justify-items")}e.cssFinally("align-items")}if(n.wrap){const[a,r,l,o]=n.row?["top","left","right","intersectY"]:["left","top","bottom","intersectX"];i.sort((e,t)=>{const i=e.linear,s=t.linear;if(!e[o](t.bounds,"bounds"))return i[a]<s[a]?-1:1;else{const e=i[r],t=s[r];if(!wn(e,t))return e<t?-1:1}return 0});let c,h=i[0],d=[h],u=i.length,f=0;const g=[d];let p=1;while(p<u){const e=i[p++];if(h[o](e.bounds,"bounds"))d.push(e);else h=e,d=[e],g.push(d)}if(e.clear(),u=g.length,p=0,u>1){const i=e.box[l];while(p<u){const s=g[p];f=Math.max(s.length,f);const n=t.createNodeGroup(s[0],s,e,{delegate:true,cascade:true});n.addAlign(64),n.box[l]=i,n.containerIndex=p++}c=u}else{const t=g[0];e.retainAs(t),f=t.length;while(p<f)t[p].containerIndex=p++;c=f}p=0;while(p<s.length)s[p].containerIndex=c+p++;if(e.addAll(s),n.row)n.rowCount=u,n.columnCount=f;else n.rowCount=f,n.columnCount=u}else{if(i.some(e=>0!==e.flexbox.order)){const[e,t]=n.reverse?[-1,1]:[1,-1];i.sort((i,s)=>{const n=i.flexbox.order,a=s.flexbox.order;if(n===a)return 0;else return n>a?e:t})}else if(n.reverse)i.reverse();if(n.row)n.rowCount=1,n.columnCount=e.length;else n.rowCount=e.length,n.columnCount=1}e.data(this.name,"mainData",n)}},Grid:Grid,List:class List extends ExtensionUI{condition(e){const t=e.length;if(t>0){const i=e.children;let s,n=true,a=true,r=true,l=true,o=false;for(let e=0;e<t;++e){const c=i[e],h=c.css("listStyleType");if("list-item"===c.display&&("none"!==h||c.innerBefore)||c.marginLeft<0&&"none"===h&&In(c.visibleStyle))o=true;if(r||l)if(c.floating){if(!s)s=new Set;s.add(c.float),l=false}else if(0===e||e===t-1||c.blockStatic||i[e-1].blockStatic&&i[e+1].blockStatic)r=false;else r=false,l=false;if(!c.blockStatic)n=false;if(!c.inlineVertical)a=false;if(!(n||a||l||r))return false}return o&&(n||a||1===(null==s?void 0:s.size)||l)}return false}processNode(e){const t="OL"===e.tagName;let i=t&&e.toElementInt("start")||1;e.each(e=>{const s={ordinal:"",imageSrc:"",imagePosition:""},n=e.css("listStyleType"),a="list-item"===e.display;if(a||""!==n&&"none"!==n||In(e.visibleStyle)){if(e.has("listStyleImage"))s.imageSrc=e.css("listStyleImage");else{if(t&&a&&"LI"===e.tagName){const t=e.attributes.value;if(t&&An(t))i=Math.floor(parseFloat(t))}let r=Cn(n,i);if(""===r)switch(n){case"disc":r="";break;case"square":r="";break;case"none":{let t="",i="";if(!e.visibleStyle.backgroundRepeat)t=e.backgroundImage,i=e.css("backgroundPosition");if(""!==t&&"none"!==t)s.imageSrc=t,s.imagePosition=i,e.exclude({resource:Ze.IMAGE_SOURCE});break}default:r="";break}else r+=".";s.ordinal=r}if(a)++i}e.data(this.name,"mainData",s)})}},Relative:class Relative extends ExtensionUI{is(e){return e.positionRelative&&!e.autoPosition||0!==Nn(e.verticalAlign)}condition(){return true}processNode(e){return{subscribe:true}}postOptimize(e){const t=e.renderParent,i=!e.baselineAltered?Nn(e.verticalAlign):0;let s=0,n=0,a=0,r=0;if(e.hasPX("top"))s=e.top;else a=e.bottom;if(e.hasPX("left"))r=e.left;else n=e.right;if(t.support.positionTranslation){let t=0,l=0;if(0!==r)t=r;else if(0!==n)t=-n;if(0!==s)l=s;else if(0!==a)l=-a;if(0!==i)l-=i;if(0!==t)e.translateX(t,{relative:true});if(0!==l)e.translateY(l,{relative:true})}else{let l=e;if((0!==s||0!==a||0!==i)&&t.layoutHorizontal&&t.support.positionRelative&&0===e.renderChildren.length){l=e.clone(this.application.nextId),l.baselineAltered=true,e.hide({hidden:true}),this.application.getProcessingCache(e.sessionId).add(l,false);const i=new LayoutUI(t,l,l.containerType,l.alignmentType),s=t.renderChildren.findIndex(t=>t===e);if(-1!==s)i.renderIndex=s+1;if(this.application.addLayout(i),e.parseUnit(e.css("textIndent"))<0){const i=e.documentId;t.renderEach(e=>{if(e.alignSibling("topBottom")===i)e.alignSibling("topBottom",l.documentId);else if(e.alignSibling("bottomTop")===i)e.alignSibling("bottomTop",l.documentId)})}if(e.baselineActive&&!e.baselineAltered)for(const i of t.horizontalRows||[t.renderChildren])if(i.includes(e)){const t=i.filter(t=>t.positionRelative&&t.length>0&&0!==Nn(e.verticalAlign)),s=t.length;if(s>0){t.sort((e,t)=>{const i=e.linear.top,s=t.linear.top;if(Pn(i,s))return 0;else return i<s?-1:1});let i=true,n=0;while(n<s){const s=t[n++];if(i)e.modifyBox(1,Nn(s.verticalAlign)),i=false;else s.modifyBox(1,s.linear.top-t[0].linear.top);s.setCacheValue("verticalAlign","0px")}}break}}else if(e.positionRelative&&e.naturalElement){const i=e.bounds,l=0!==s||0!==a,o=0!==r||0!==n,c=e.actualParent.naturalChildren;let h,d=false;const u=c.length;let f=0;while(f<u){const u=c[f++];if(u===e){if(d){if(l&&t.layoutVertical){const t=Rn(e.boundingClientRect);if(0!==s)s-=t.top-i.top;else if((null==h?void 0:h.positionRelative)&&h.hasPX("top"))a+=i.bottom-t.bottom;else a+=t.bottom-i.bottom}if(o&&t.layoutHorizontal&&!e.alignSibling("leftRight")){const t=Rn(e.boundingClientRect);if(0!==r)r-=t.left-i.left;else if((null==h?void 0:h.positionRelative)&&h.hasPX("right"))n+=i.right-t.right;else n+=t.right-i.right}}else if(t.layoutVertical)if(0!==s){if((null==h?void 0:h.blockStatic)&&h.positionRelative&&u.blockStatic)s-=h.top}else if(0!==a){if(1===u.getBox(1)[0])a-=u.marginTop}break}else if(u.positionRelative&&u.renderParent===t)d=true;if(u.pageFlow)h=u}}if(0!==i)l.modifyBox(1,-1*i);if(0!==s)l.modifyBox(1,s);else if(0!==a)l.modifyBox(1,-1*a);if(0!==r)if(l.autoMargin.left)l.modifyBox(2,-1*r);else l.modifyBox(8,r);else if(0!==n)l.modifyBox(8,-1*n);if(l!==e)l.setBoxSpacing()}}},Sprite:class Sprite extends ExtensionUI{is(e){return 0===e.length&&e.hasWidth&&e.hasHeight}condition(e){const t=e.backgroundImage;if(""!==t&&(!e.use||this.included(e.element))){const i=Bn(t),s=this.resource.getRawData(t)||i&&this.resource.getImage(i);if(s){const t=e.actualDimension,[i,n]=e.cssAsTuple("backgroundPositionX","backgroundPositionY"),a=Mn(i+" "+n,t,{fontSize:e.fontSize,screenDimension:e.localSettings.screenDimension}),r=/^0[a-z%]+|left|start|top/,l=(a.left<0||r.test(i))&&s.width>t.width,o=(a.top<0||r.test(n))&&s.height>t.height;if((l||o)&&(l||0===a.left)&&(o||0===a.top))return e.data(this.name,"mainData",{image:s,position:a}),true}}return false}},Table:class Table extends ExtensionUI{processNode(e){const t=function(e){return{layoutType:0,rowCount:0,columnCount:0,layoutFixed:"fixed"===e.css("tableLayout"),borderCollapse:"collapse"===e.css("borderCollapse"),expand:false}}(e);let i,s,n=[];const a=(e,t)=>{if(e)e.cascade(t=>{switch(t.tagName){case"TH":case"TD":t.inherit(e,"styleMap"),t.unsetCache("visibleStyle");break}}),n=t?n.concat(e.children):e.children.concat(n)};e.each(e=>{switch(e.tagName){case"THEAD":if(!s)s=e;$n(e);break;case"TBODY":n=n.concat(e.children),$n(e);break;case"TFOOT":if(!i)i=e;$n(e);break}}),a(s,false),a(i,true);const r=e.hasWidth,l=t.borderCollapse,[o,c]=l?[0,0]:zn(e.css("borderSpacing").split(" "),(t,i)=>0===i?e.parseWidth(t):e.parseHeight(t)),h=o>1?Math.round(o/2):o,d=c>1?Math.round(c/2):c,u=e.element.querySelector("COLGROUP"),f=e.find(e=>"CAPTION"===e.tagName),g="bottom"===e.css("captionSide"),p=[],m=[],b=[],x=[],y=n.length;let v,w=0;for(let i=0;i<y;++i){const s=n[i];p[i]=o;const a=b[i]||[];b[i]=a,s.each((s,n)=>{const r=s.element,l=r.rowSpan;let f=r.colSpan;v=0;while(a[v])++v;const g=i+l;let w=i;while(w<g){const e=Xn(b,w++),t=v+f;for(let i=v,n=0;i<t;++i)if(!e[i])e[i]=s,++n;else{f=n;break}}if(!s.hasPX("width")){const e=Dn(r,"width");if(Hn(e))s.css("width",e,true);else if(qn(e))s.css("width",Wn(parseFloat(e)),true)}if(!s.hasPX("height")){const e=Dn(r,"height");if(Hn(e))s.css("height",e);else if(qn(e))s.css("height",Wn(parseFloat(e)))}if(""===s.cssInitial("verticalAlign"))s.css("verticalAlign","middle",true);if(!s.visibleStyle.backgroundImage&&!s.visibleStyle.backgroundColor){const e=/rgba\(0, 0, 0, 0\)|transparent/;if(u){const{backgroundImage:t,backgroundColor:i}=On(u.children[n+1]);if(t&&"none"!==t)s.css("backgroundImage",t,true);if(i&&!e.test(i))s.css("backgroundColor",i),s.setCacheValue("backgroundColor",i)}else{let t=Fn(r,"backgroundImage",/none/,"TABLE");if(""!==t)s.css("backgroundImage",t,true);if(t=Fn(r,"backgroundColor",e,"TABLE"),""!==t)s.css("backgroundColor",t),s.setCacheValue("backgroundColor",t)}}switch(s.tagName){case"TD":{const e=s.parent;if(0===s.borderTopWidth)Yn(s,"borderTop",e);if(0===s.borderRightWidth)Yn(s,"borderRight",e);if(0===s.borderBottomWidth)Yn(s,"borderBottom",e);if(0===s.borderLeftWidth)Yn(s,"borderLeft",e);break}case"TH":if(""===s.cssInitial("textAlign"))s.css("textAlign","center");if(0===s.borderTopWidth)Yn(s,"borderTop",e);if(0===s.borderBottomWidth)Yn(s,"borderBottom",e);break}const S=s.cssInitial("width"),E=void 0===x[v]||"auto"===x[v],_=s.bounds.width;if(0===i||E||!t.layoutFixed)if(""===S||"auto"===S){if(void 0===x[v])x[v]=S||"0px",m[v]=0;else if(i===y-1&&E&&0===m[v])m[v]=_}else{const e=Hn(S),t=Un(x[v]);if(E||_<m[v]||_===m[v]&&(t&&e||e&&Hn(x[v])&&s.parseWidth(S)>=s.parseWidth(x[v])||t&&Un(S)&&s.parseWidth(S)>s.parseWidth(x[v])))x[v]=S;if(E||1===r.colSpan)m[v]=_}if(s.length>0||s.inlineText)p[i]+=_+o;if(h>0)s.modifyBox(8,0===v?o:h),s.modifyBox(2,0===n?h:o);if(d>0)s.modifyBox(1,0===i?c:d),s.modifyBox(4,i+l<y?d:c);s.data(this.name,"cellData",{colSpan:f,rowSpan:l})}),$n(s),w=Math.max(w,a.length)}if(e.hasPX("width",{percent:false})&&x.some(e=>Hn(e)))zn(x,(e,t)=>{if("auto"===e){const e=m[t];if(e>0)return Wn(e)}return e});let S=false,E=0;if(x.every(e=>Hn(e))){if(x.reduce((e,t)=>e+parseFloat(t),0)>1){let e=100;zn(x,t=>{const i=parseFloat(t);if(e<=0)t="0px";else if(e-i<0)t=Ln(e/100);return e-=i,t})}if(!e.hasWidth)t.expand=true;S=true}else if(x.every(e=>Un(e))){const i=x.reduce((e,t)=>e+parseFloat(t),0);if(e.hasWidth)if(i<e.width)zn(x,e=>"0px"!==e?parseFloat(e)/i*100+"%":e);else if(i>e.width)if(e.css("width","auto"),!t.layoutFixed)e.cascade(e=>(e.css("width","auto"),false));if(t.layoutFixed&&!e.hasPX("width"))e.css("width",Wn(e.bounds.width))}if(t.layoutType=(()=>{if(x.length>1){if(E=x.reduce((e,t)=>e+(Hn(t)?parseFloat(t):0),0),t.layoutFixed&&x.reduce((e,t)=>e+(Un(t)?parseFloat(t):0),0)>=e.actualWidth)return 4;else if(x.length>1&&x.some(e=>Hn(e))||x.every(e=>Un(e)&&"0px"!==e))return 3;else if(x.every(e=>e===x[0]))if(e.find(e=>e.hasHeight,{cascade:true}))return t.expand=true,3;else if("auto"===x[0])if(e.hasWidth)return 3;else{const t=e.cascade(e=>"TD"===e.tagName);return t.length>0&&t.every(e=>Gn(e.bounds.width,t[0].bounds.width))?0:3}else if(e.hasWidth)return 2;if(x.every(e=>"auto"===e||Un(e)&&"0px"!==e)){if(!e.hasWidth)t.expand=true;return 1}}return 0})(),e.clear(),f){if(!f.hasWidth)if(f.textElement){if(!f.hasPX("maxWidth"))f.css("maxWidth",Wn(f.bounds.width))}else if(f.bounds.width>Vn(p))Kn(f);if(!f.cssInitial("textAlign"))f.css("textAlign","center");if(f.data(this.name,"cellData",{colSpan:w}),!g)f.parent=e}let _=0;while(_<y){const i=b[_++],s=i.length;v=0;while(v<s){const s=i[v],n=s.data(this.name,"cellData"),a=x[v];if(v+=n.colSpan,!n.placed){if(a)switch(t.layoutType){case 0:break;case 3:if("auto"===a)if(E>=1)Kn(s),n.exceed=!r,n.downsized=true;else jn(e,s,n);else if(Hn(a))if(S)n.percent=a,n.expand=true;else Kn(s);else if(Un(a)&&parseInt(a)>0)if(s.bounds.width>=parseInt(a))Kn(s),n.expand=false,n.downsized=false;else if(t.layoutFixed)jn(e,s,n),n.downsized=true;else Kn(s),n.expand=false;else{if(!s.hasPX("width",{percent:false})||s.percentWidth)Kn(s);n.expand=false}break;case 2:jn(e,s,n);break;case 1:if("auto"===a)n.flexible=true;else{if(t.layoutFixed)n.downsized=true;else Kn(s);n.expand=false}break;case 4:if(!Un(a))s.hide();break}n.placed=true,s.parent=e}}if(s<w){const e=i[s-1].data(this.name,"cellData");if(e)e.spaceSpan=w-s}}if(f&&g)f.parent=e;if(t.borderCollapse){const t=e.cssAsObject("borderTopColor","borderTopStyle","borderTopWidth"),i=e.cssAsObject("borderRightColor","borderRightStyle","borderRightWidth"),s=e.cssAsObject("borderBottomColor","borderBottomStyle","borderBottomWidth"),n=e.cssAsObject("borderLeftColor","borderLeftStyle","borderLeftWidth"),a=parseInt(t.borderTopWidth),r=parseInt(i.borderRightWidth),l=parseInt(s.borderBottomWidth),o=parseInt(n.borderLeftWidth);let c=false,h=false,d=false,u=false;for(_=0;_<y;++_){const e=b[_];for(v=0;v<w;++v){const f=e[v];if("visible"===(null==f?void 0:f.css("visibility"))){if(0===_)if(f.borderTopWidth<a)f.cssApply(t),f.unsetCache("borderTopWidth");else c=true;if(_>=0&&_<y-1){const e=b[_+1][v];if("visible"===(null==e?void 0:e.css("visibility"))&&e!==f)if(f.borderBottomWidth>e.borderTopWidth)e.css("borderTopWidth","0px",true);else f.css("borderBottomWidth","0px",true)}if(_===y-1)if(f.borderBottomWidth<l)f.cssApply(s),f.unsetCache("borderBottomWidth");else d=true;if(0===v)if(f.borderLeftWidth<o)f.cssApply(n),f.unsetCache("borderLeftWidth");else u=true;if(v>=0&&v<w-1){const t=e[v+1];if("visible"===(null==t?void 0:t.css("visibility"))&&t!==f)if(f.borderRightWidth>=t.borderLeftWidth)t.css("borderLeftWidth","0px",true);else f.css("borderRightWidth","0px",true)}if(v===w-1)if(f.borderRightWidth<r)f.cssApply(i),f.unsetCache("borderRightWidth");else h=true}}}if(c||h||d||u)e.cssApply({borderTopWidth:"0px",borderRightWidth:"0px",borderBottomWidth:"0px",borderLeftWidth:"0px"},true)}t.rowCount=y+(f?1:0),t.columnCount=w,e.data(this.name,"mainData",t)}},VerticalAlign:class VerticalAlign extends ExtensionUI{is(e){return e.length>0}condition(e){const t=e.children;let i=false,s=0,n=0;const a=t.length;let r=0;while(r<a){const e=t[r++];if(!(e.positionStatic||e.positionRelative&&e.length>0))return false;else if(e.inlineVertical){const t=parseFloat(e.verticalAlign);if(!isNaN(t))if(i=true,!isNaN(n))if(0===n)n=t;else if(n!==t)n=NaN;++s}else n=NaN}return i&&isNaN(n)&&s>1&&NodeUI.linearData(t).linearX}processNode(e){return e.each(e=>{if(e.inlineVertical&&Qn(e.verticalAlign)||e.imageElement||e.svgElement)e.baselineAltered=true}),{subscribe:true}}postConstraints(e){if(e.layoutHorizontal)for(const t of e.horizontalRows||[e.renderChildren]){const e=[];let i,s=1/0;const n=t.length;let a=0;while(a<n){const n=t[a++],r=n.linear.top;if(n.inlineVertical&&r<=s){if(r<s)e.length=0;e.push(n),s=r}if(n.baselineActive)i=n}if(e.length>0){const s=e[0],r=s.linear.top;a=0;while(a<n){const s=t[a++];if(s!==i){if(s.inlineVertical)if(!e.includes(s)){if(Qn(s.verticalAlign)||!i)s.setBox(1,{reset:1,adjustment:s.linear.top-r}),s.baselineAltered=true}else if(i&&(s.imageElement||s.svgElement)&&i.documentId===s.alignSibling("baseline"))s.setBox(1,{reset:1,adjustment:i.linear.top-s.linear.top});if(s.baselineAltered)s.setCacheValue("verticalAlign","0px")}}if(i)i.setBox(1,{reset:1,adjustment:i.linear.top-r+Math.min(0,s.parseHeight(s.cssInitial("verticalAlign")))}),i.baselineAltered=true}}else e.each(e=>e.baselineAltered=false)}},WhiteSpace:class WhiteSpace extends ExtensionUI{afterBaseLayout(e){const{cache:t,excluded:i}=this.application.getProcessing(e),s=this.application.session.clearMap,n=new Set;t.each(e=>{var t,i;if(e.naturalElement&&!e.hasAlign(2)){const a=e.naturalChildren,r=a.length;if(0===r)return;const l=e.pageFlow,o=l&&la(e,true)&&!e.actualParent.layoutElement;let c,h;for(let l=0;l<r;++l){const d=a[l];if(d.pageFlow){if(o)if(!d.floating){if(!c)c=d;h=d}else if(h){if(d.linear.bottom>=h.linear.bottom)h=d}else h=d;if(la(d,true))if(l>0){const a=d.previousSiblings({floating:false}),o=a.length;if(o>0){let h=false;const u=a[o-1];if(la(u,false)){let e=u.marginBottom,i=d.marginTop;if(u.marginTop<0&&0===u.bounds.height){const t=Math.min(e,u.marginTop);if(t<0){if(Math.abs(t)<i)d.modifyBox(1,t);else da(d,1);n.add(u.id),u.hide({collapse:true});continue}}else if(d.marginBottom<0&&0===d.bounds.height){const t=Math.min(i,d.marginBottom);if(t<0){if(Math.abs(t)<e)u.modifyBox(4,t);else da(u,4);n.add(d.id),d.hide({collapse:true});continue}}let a=false,r=u;while(fa(r,true)){let t=ca(r);if(0===(null==t?void 0:t.getBox(4)[0])){let i=t.marginBottom,s=t;while(0===s.bounds.height&&!s.pseudoElement){const e=s.marginTop;if(i=Math.max(e,s.marginBottom,i),0!==e)da(s,1);const n=s.previousSibling;if(n)if(n.marginBottom>=i){if(0!==s.marginBottom)da(s,4);t=n,i=n.marginBottom,s=n}else if(n.bounds.height>0)break;else{if(0!==n.marginBottom)da(n,4);s=n}else break}if(0!==i)da(t,4,0===u.getBox(4)[0]?u:void 0);if(i>e)e=i,a=true;else if(0===i&&0===e){r=t;continue}}break}r=d;while(ga(r,true)){let e=r.firstStaticChild;if(la(e,true)&&0===e.getBox(1)[0]){let t=e.marginTop,s=e;while(0===s.bounds.height&&!s.pseudoElement){const i=s.marginBottom;if(t=Math.max(s.marginTop,i,t),0!==i)da(s,4);const n=s.nextSibling;if(n)if(n.marginTop>=t){if(0!==s.marginTop)da(s,1);e=n,t=n.marginTop,s=n}else if(n.bounds.height>0)break;else{if(0!==n.marginTop)da(n,1);s=n}else break}if(0!==t)da(e,1,0===d.getBox(1)[0]?d:void 0);if(t>i)i=t,h=true;else if(0===t&&0===i){r=e;continue}}break}if(e>0)if(i>0){if(i<=e){if(!h||!ha(d)){if(da(d,1),0===d.bounds.height&&e>=d.marginBottom)da(d,4);h=false}}else if(!a||!ha(u)){if(da(u,4),0===u.bounds.height&&i>=u.marginTop)da(u,1);a=false}}else if(0===d.bounds.height)if(i=Math.min(i,d.marginBottom),i<0)u.modifyBox(4,i),d.hide({collapse:true});if(i>0&&u.floatContainer&&0===d.getBox(1)[1]&&!ha(u)){let e=false;if(0===u.bounds.height)e=true;else{let i;if(ia(u.naturalElements,e=>{if(s.has(e))return true;else if(e.floating){if(e.linear.bottom>Math.ceil(u.bounds.bottom))i=e.float;return true}}),i){const s=null===(t=ta(u.element,"styleMap::after",u.sessionId))||void 0===t?void 0:t.clear;e=!("both"===s||s===i)}}if(e)d.modifyBox(1,u.box.top-ea(u.naturalElements.map(e=>e.linear.bottom)),false)}if(h){let e=0;if(0===u.bounds.height){const t=u.previousSibling;e=t&&la(t,false)?Math.max(t.getBox(4)[1],t.marginBottom):0}if(i>e)(d.registerBox(1)||d).setCacheValue("marginTop",i)}if(a){let t=0;if(0===d.bounds.height){const e=d.nextSibling;t=e&&la(e,true)?Math.max(e.getBox(1)[1],e.marginTop):0}if(e>=t)(u.registerBox(4)||u).setCacheValue("marginBottom",e)}}else if(0===d.bounds.height){const{marginTop:e,marginBottom:t}=d;if(e>0&&t>0)if(e<t)da(d,1);else if(l===r-1)d.setCacheValue("marginBottom",e),da(d,1);else da(d,4)}if(!h&&d!==c&&a.length>1&&(e.layoutVertical||(null===(i=d.renderParent)||void 0===i?void 0:i.layoutVertical))){const e=a.pop();if(e.floating&&Math.floor(e.bounds.top)===Math.floor(d.bounds.top))d.modifyBox(1,-e.bounds.height,false)}}}else if(0===d.bounds.height){const{marginTop:e,marginBottom:t}=d;if(e>0&&t>0){if(e<t)d.setCacheValue("marginTop",t);da(d,4)}}}}if(l&&!ha(e)&&"FIELDSET"!==e.tagName){if(null==c?void 0:c.naturalElement)ra(e,c,true);if(null==h?void 0:h.naturalElement)if(ra(e,h,false),h.marginTop<0){const t=h.bounds.height+h.marginBottom+h.marginTop;if(t<0)e.modifyBox(64,t,false)}}}}),i.each(e=>{var t,i;if(e.lineBreak&&!e.lineBreakTrailing&&!s.has(e)&&!n.has(e.id)){let s=false;const a=e.previousSiblings({floating:false}),r=a.length;if(r>0){const l=e.actualParent,o=e.siblingsTrailing,c=o.length;if(c>0){let h,d,u=a[r-1],f=o[c-1],g=0;if(u.rendered&&f.rendered){const r=u.inlineStatic&&f.inlineStatic;if(r&&0===a.length)return void n.add(e.id);if(r){if(h=a[0],1===a.length)h=h.lineBreak?e:void 0;null==h||h.setBounds(false)}let o=u.renderParent,c=f.renderParent;if(o!==c){while(o&&o!==l)u=o,o=u.renderParent;while(c&&c!==l)f=c,c=f.renderParent}if(!u.multiline){let e;if(u.has("lineHeight"))e=u.lineHeight;else if(u.length>0)if(u.layoutVertical)e=null===(t=u.lastStaticChild)||void 0===t?void 0:t.lineHeight;else e=ea(u.map(e=>e.lineHeight));if(e){const t=Math.floor((e-u.bounds.height)/2);if(t>0)g+=t}}if(!f.multiline){let e;if(f.has("lineHeight"))e=f.lineHeight;else if(f.length>0)if(f.layoutVertical)e=null===(i=f.firstStaticChild)||void 0===i?void 0:i.lineHeight;else e=ea(f.map(e=>e.lineHeight));if(e){const t=Math.round((e-f.bounds.height)/2);if(t>0)g+=t}}if([d,f]=oa(f,u,g,h),d>=1)if(f.visible)f.modifyBox(1,d),s=true;else if(u.visible)u.modifyBox(4,d),s=true}else if([d,f]=oa(f,u,g),d>=1)if((f.lineBreak||f.excluded)&&l.lastChild===f)l.modifyBox(64,d),s=true;else if((u.lineBreak||u.excluded)&&l.firstChild===u)l.modifyBox(16,d),s=true}else if(l.visible&&!l.preserveWhiteSpace&&"CODE"!==l.tagName&&!l.documentRoot&&!l.documentBody){const e=a[a.length-1],t=0===e.bounds.height&&e.length>0?NodeUI.outerRegion(e):e.linear,i=l.box.bottom-(e.lineBreak||e.excluded?t.top:t.bottom);if(0!==i)if(e.rendered||l.visibleStyle.background)l.modifyBox(64,i);else if(!l.hasHeight)((e,t)=>{e.css("minHeight",Zn(Math.max(t,e.hasPX("minHeight",{percent:false})?e.parseHeight(e.css("minHeight")):0)))})(l,i)}if(s){let e=0;while(e<r)n.add(a[e++].id);e=0;while(e<c)n.add(o[e++].id)}}}})}afterConstraints(e){this.application.getProcessingCache(e).each(e=>{if(e.naturalChild&&e.styleElement&&e.inlineVertical&&e.pageFlow&&!e.positioned&&!e.actualParent.layoutElement){const t=e.outerMostWrapper,i=t.renderParent;if(false===(null==i?void 0:i.hasAlign(2))){if(e.blockDimension&&!e.floating)if(i.layoutVertical){const s=i.renderChildren,n=s.findIndex(e=>e===t);if(-1!==n){if(!e.lineBreakLeading&&!e.baselineAltered){const e=s[n-1];if(null==e?void 0:e.pageFlow)na(t,1,e.actualRect("bottom"),e.getBox(4)[1])}if(!e.lineBreakTrailing){const e=s[n+1];if((null==e?void 0:e.pageFlow)&&e.styleElement&&!e.inlineVertical)na(t,4,e.actualRect("top"),e.getBox(1)[1])}}}else if(!e.baselineAltered){const s=i.horizontalRows;let n;if(s&&s.length>1)e:{let e=-1/0;const i=s.length;let a;for(let r=0;r<i;++r){const i=s[r],l=i.length;a=0;while(a<l)if(t===i[a++]){if(r>0)na(t,1,e);else n=i;break e}let o=0;while(o<i.length){const t=i[o++].innerMostWrapped;if(pa(t))e=Math.max(t.actualRect("bottom"),e)}if(e===-1/0)break}}else if(i.layoutHorizontal||i.hasAlign(512))n=i.renderChildren;if(n){let i=[],s=-1/0,a=n.length,r=0;while(r<a){const e=n[r++];if(e.nodeGroup)i=i.concat(e.cascade(e=>e.naturalChild));else if(e.innerWrapped)i.push(e.innerMostWrapped);else i.push(e)}const l=e.actualParent.naturalChildren;a=l.length,r=0;while(r<a){const e=l[r++];if(i.includes(e))break;else if(e.lineBreak||e.block)s=-1/0;else if(pa(e))s=Math.max(e.actualRect("bottom"),s)}if(s!==-1/0&&e.actualRect("top")>s)na(t,1,s)}}if(!i.layoutVertical&&!t.alignParent("left")&&!NodeUI.justified(e)){const s=t.alignSibling("leftRight");if(""!==s){const e=i.renderChildren.find(e=>e.documentId===s);if((null==e?void 0:e.inlineVertical)&&e.bounds.width>0)na(t,8,e.actualRect("right"))}else{let i=e;while(true){const e=i.siblingsLeading;if(e.length>0&&!e.some(e=>e.lineBreak||e.excluded&&e.blockStatic)){const s=e[0];if(s.inlineVertical)na(t,8,s.actualRect("right"));else if(s.floating){i=s;continue}}break}}}}}if(e.floatContainer&&e.layoutVertical){const t=[],i=e.naturalChildren,s=i.length;let n=0;while(n<s){const s=i[n++];if(s.pageFlow)if(!s.floating){const i=t.length;if(i>0){const n=s.outerMostWrapper;let a=n.renderParent;if(a){const[r,l]=s.getBox(1);if((0===r?s.marginTop:0)+l>0){const s=Math.floor(e.bounds.top);let r=0;while(r<i){const i=t[r++];if(s<=Math.floor(i.bounds.top)){let t=i.outerMostWrapper.renderParent;if(t){if(a=a.ascend({error:e=>e.naturalChild,attr:"renderParent"}).pop()||a,t=t.ascend({error:e=>e.naturalChild,attr:"renderParent"}).pop()||t,a!==t)n.modifyBox(1,-1*(t!==e?t:i).linear.height,false);break}}}}}t.length=0}}else t.push(s)}}})}}},xa={constant:ma,enumeration:tt};e.Application=Application,e.ApplicationUI=class ApplicationUI extends Application{constructor(e,t,i,s,n){super(e,t,i,s,n),this.session={active:new Map,unusedStyles:new Set,extensionMap:new Map,clearMap:new Map},this.builtInExtensions={},this.extensions=[],this._layouts=[];const a=this.controllerHandler.localSettings;this._controllerSettings=a,this._layoutFileExtension=new RegExp(`\\.${a.layout.fileExtension}$`),this._conditionExcluded=a.unsupported.excluded}finalize(){var e;if(super.finalize())return false;const t=this.controllerHandler,i=this.childrenAll;let s=i.length;const n=new Array(s);let a=0,r=0;while(a<s){const e=i[a++];if(e.renderParent&&e.visible){if(e.hasProcedure(et.LAYOUT))e.setLayout();if(e.hasProcedure(et.ALIGNMENT))e.setAlignment();n[r++]=e}}n.length=r,t.optimize(n);const l=this.extensions;s=l.length,a=0;while(a<s){const e=l[a++];for(const t of e.subscribers)e.postOptimize(t)}const o=[];a=0;while(a<r){const e=n[a++];if(e.hasResource(Ze.BOX_SPACING))e.setBoxSpacing();if(e.documentRoot){if(0===e.renderChildren.length&&!e.inlineText&&e.naturalElements.length>0&&e.naturalElements.every(e=>e.documentRoot))continue;const t=e.innerMostWrapped.data(Application.KEY_NAME,"layoutName");if(t)o.push({node:e,layoutName:t})}}a=0;while(a<s)l[a++].beforeCascade(n,o);const c=this._controllerSettings.layout.baseTemplate,h=zt(this.systemName);a=0;while(a<o.length){const{node:i,layoutName:s}=o[a++],n=i.renderParent.renderTemplates;if(n)this.saveDocument(s,c+t.cascadeDocument(n,Math.abs(i.depth)),i.dataset["pathname"+h],(null===(e=i.renderExtension)||void 0===e?void 0:e.some(e=>e.documentBase))?0:void 0)}this.resourceHandler.finalize(this._layouts),t.finalize(this._layouts),a=0;while(a<s)l[a++].afterFinalize();return Ot("__squared.pseudo"),this.closed=true,true}copyToDisk(e,t){return super.copyToDisk(e,this.createAssetOptions(t))}appendToArchive(e,t){return super.appendToArchive(e,this.createAssetOptions(t))}saveToArchive(e,t){return super.saveToArchive(e,this.createAssetOptions(t))}reset(){const e=this.session,t="iteration"+zt(this.systemName);for(const i of e.active.values())for(const e of i.rootElements)delete e.dataset[t];super.reset(),e.extensionMap.clear(),e.clearMap.clear(),this._layouts.length=0}conditionElement(e,t,i,s){if(!this._conditionExcluded.has(e.tagName))if(this.controllerHandler.visibleElement(e,t,s)||i)return true;else if(!s){if(Bt(Pt(e).position))return this.useElement(e);let i=e.parentElement;while(null!==i){if("none"===Pt(i).display)return this.useElement(e);i=i.parentElement}const s=this.controllerHandler;if(Kt(e.children,e=>s.visibleElement(e,t))===1/0)return true;else return this.useElement(e)}return false}insertNode(e,t,i,s){if("#text"===e.nodeName||this.conditionElement(e,t,i,s))return this.controllerHandler.applyDefaultStyles(e,t),this.createNode(t,{element:e,append:false});else{const i=this.createNode(t,{element:e,append:false});return i.visible=false,i.excluded=true,i}}saveDocument(e,t,i,s){const n={pathname:i?ti(i.replace(/\\/g,"/"),"/"):qt(this.userSettings.outputDirectory,this._controllerSettings.layout.pathName),filename:e,content:t,index:s};if(void 0===s||!(s>=0&&s<this._layouts.length))this._layouts.push(n);else this._layouts.splice(s,0,n)}renderNode(e){return 0===e.itemCount?this.controllerHandler.renderNode(e):this.controllerHandler.renderNodeGroup(e)}addLayout(e){const t=e.renderType;if(t&&jt(t,256))if(jt(t,4))e=this.processFloatHorizontal(e);else if(jt(t,8))e=this.processFloatVertical(e);if(0!==e.containerType){const t=this.renderNode(e);if(t)return this.addLayoutTemplate(t.parent||e.parent,e.node,t,e.renderIndex),true}return false}addLayoutTemplate(e,t,i,s){if(!t.renderExclude){if(t.renderParent){const n=Jt(e,"renderTemplates");if(void 0===s||!(s>=0&&s<e.renderChildren.length))e.renderChildren.push(t),n.push(i);else e.renderChildren.splice(s,0,t),n.splice(s,0,i)}}else t.hide({remove:true}),t.excluded=true}createNode(e,t){const{element:i,parent:s,children:n}=t,a=this.getProcessingCache(e),r=new this.Node(this.nextId,e,i);if(this.controllerHandler.afterInsertNode(r),s){if(r.depth=s.depth+1,!i&&s.naturalElement)r.actualParent=s;const e=t.innerWrap;if(e&&s.replaceTry({child:e,replaceWith:r}))e.parent=r,r.innerWrapped=e}if(n){const e=n.length;let t=0;while(t<e)n[t++].parent=r}if(false!==t.append)a.add(r,true===t.delegate,true===t.cascade);return r}createCache(e,t){const i=this.createRootNode(e,t);if(i){const{cache:e,excluded:s}=this.getProcessing(t),n=i.parent;if(n)if(n.visible=false,i.documentParent=n,"HTML"===n.tagName)n.addAlign(2),n.exclude({resource:Ze.FONT_STYLE|Ze.VALUE_STRING,procedure:et.ALL}),e.add(n);i.rootElement=true;const a={},r=new Set,l=[];let o=false;e.each(e=>{if(e.styleElement){const t=e.element;if(e.length>0){const i=e.cssInitial("textAlign");switch(i){case"center":case"right":case"end":Zt(a,e.id)["text-align"]=i,t.style.setProperty("text-align","left");break}}if(e.positionRelative){let i=0;while(i<4){const s=NodeUI.BOX_POSITION[i++];if(e.hasPX(s))Zt(a,e.id)[s]=e.css(s),t.style.setProperty(s,"auto"),o=true}}if("rtl"===e.dir)t.dir="ltr",r.add(t),o=true}}),s.each(e=>{if(!e.pageFlow)e.cssTry("display","none")}),e.each(e=>{if(!e.pseudoElement)e.setBounds(!o&&void 0===a[e.id]);else l.push(e)});const c=l.length;if(c>0){const e=[];let t=0;while(t<c){const i=l[t++],s=i.parentElement;let n,a=s.id.trim();if(i.pageFlow){if(""===a)a="__squared_"+Math.round(Math.random()*(new Date).getTime()),s.id=a;n=Lt(`#${a+Dt(i.element,i.sessionId)} { display: none !important; }`)}if(i.cssTry("display",i.display))e.push({item:i,id:a,parentElement:s,styleElement:n})}const i=e.length;t=0;while(t<i)e[t++].item.setBounds(false);t=0;while(t<i){const i=e[t++],s=i.styleElement;if(i.id.startsWith("__squared_"))i.parentElement.id="";if(s)try{document.head.removeChild(s)}catch(e){}i.item.cssFinally("display")}}s.each(e=>{if(!e.lineBreak)e.setBounds(!o),e.saveAsInitial();if(!e.pageFlow)e.cssFinally("display")}),e.each(e=>{if(e.styleElement){const t=e.element,i=a[e.id];if(i)for(const e in i)t.style.setProperty(e,i[e]);if(r.has(t))t.dir="rtl";e.setExclusions()}e.saveAsInitial()}),this.controllerHandler.evaluateNonStatic(i,e),this.controllerHandler.sortInitialCache(e)}return i}afterCreateCache(e){super.afterCreateCache(e);const t=zt(this.systemName),i=e.dataset,s=i["filename"+t]||i.filename,n=i["iteration"+t],a=$t(s)&&s.replace(this._layoutFileExtension,"")||e.elementId||"document_"+this.length,r=(n?parseInt(n):-1)+1,l=Xt(r>0?a+"_"+r:a,true);i["iteration"+t]=r.toString(),i["layoutName"+t]=l,e.data(Application.KEY_NAME,"layoutName",l);const o=e.sessionId;this.setBaseLayout(o),this.setConstraints(o),this.setResources(o)}useElement(e){const t=this.getDatasetName("use",e);return $t(t)&&t.split(",").some(e=>!!this.extensionManager.retrieve(e.trim()))}toString(){var e;return(null===(e=this.layouts[0])||void 0===e?void 0:e.content)||""}cascadeParentNode(e,t,i,s,n,a,r,l){var o;const c=this.insertNode(s,n,l);if(0===a){e.add(c);for(const e of c.extensions)if(null===(o=this.extensionManager.retrieve(e))||void 0===o?void 0:o.cascadeAll){l=true;break}}if("none"!==c.display||0===a||l){const o=this.controllerHandler;if(c.excluded||o.preventNodeCascade(c))return c;const h=this.createPseduoElement(s,"::before",n),d=this.createPseduoElement(s,"::after",n),u=s.childNodes,f=u.length,g=new Array(f),p=new Array(s.childElementCount),m=a+1;let b=true,x=0,y=0,v=0;while(x<f){const a=u[x++];let f;if(a===h){if(f=this.insertNode(h,n,l,"::before"),c.innerBefore=f,!f.textEmpty)f.inlineText=true;b=false}else if(a===d){if(f=this.insertNode(d,n,l,"::after"),c.innerAfter=f,!f.textEmpty)f.inlineText=true;b=false}else if("#"===a.nodeName.charAt(0))if("#text"===a.nodeName&&(di(a.textContent)||c.preserveWhiteSpace&&("PRE"!==s.tagName||0===s.childElementCount)))f=this.insertNode(a,n),f.cssApply(c.textStyle);else continue;else if(o.includeElement(a)){if(r){const e=this.getDatasetName("use",a);if(e)si(e,r).some(e=>e.init(a,n))}if(!i.has(a)){if(f=this.cascadeParentNode(e,t,i,a,n,m,r,l),!f.excluded)b=false}else f=this.insertNode(a,n),f.documentRoot=true,f.visible=false,f.excluded=true,b=false;p[v++]=f}else continue;f.init(c,m,y),f.naturalChild=true,g[y++]=f}if(g.length=y,p.length=v,c.naturalChildren=g,c.naturalElements=p,c.inlineText=b,!b){if(y>0)this.cacheNodeChildren(e,t,c,g);c.inlineText=b}else c.inlineText=!c.textEmpty;if(v>0&&this.userSettings.createQuerySelectorMap)c.queryMap=this.createQueryMap(p,v)}return c}cacheNodeChildren(e,t,i,s){const n=s.length;if(n>1){let a,r=[],l=[],o=s[0],c=false;for(let h=0,d=0;h<n;++h){const u=s[h];if(u.pageFlow){if(u.floating)c=true;if(h>0)if(l.push(u),u.lineBreak)s[h-1].lineBreakTrailing=true;if(!u.excluded)u.siblingsLeading=r,o.siblingsTrailing=l,r=[],l=[],o=u;if(h<n-1)if(r.push(u),u.lineBreak)s[h+1].lineBreakLeading=true}if(u.excluded)a=true,t.add(u);else u.containerIndex=d++,e.add(u);u.actualParent=i}o.siblingsTrailing=l,i.floatContainer=c,i.retainAs(a?s.filter(e=>!e.excluded):s.slice(0))}else{const n=s[0];if(n.excluded)t.add(n);else n.containerIndex=0,i.add(n),e.add(n),i.floatContainer=n.floating;n.actualParent=i}}setBaseLayout(e){const{controllerHandler:t,session:i}=this,{extensionMap:s,clearMap:n}=i,{cache:a,node:r}=this.getProcessing(e),l=new Map;{let e=0;oi(l,-1,r.parent),a.each(t=>{if(t.length>0){const i=t.depth;if(oi(l,i,t),e=Math.max(i,e),t.floatContainer){const e=new Set;let i=[];const s=t.documentChildren||t.naturalChildren,a=s.length;let r=0;while(r<a){const t=s[r++];if(t.pageFlow){const s=t.floating;if(e.size>0){const a=t.css("clear");if(e.has(a)||"both"===a){if(!s)t.setBox(1,{reset:1});n.set(t,2===e.size?"both":e.values().next().value),e.clear(),i.length=0}else if(t.blockStatic&&Math.ceil(t.bounds.top)>=Ut(i.map(e=>e.bounds.bottom)))t.data(Application.KEY_NAME,"cleared",i),e.clear(),i=[]}if(s){const s=t.float;e.add(s),i.push(t)}}}}}});let t=0;while(t<e)l.set(mi(t++),new Set);a.afterAdd=(e,t=false)=>{if(oi(l,mi(e.depth),e),t&&e.length>0)e.cascade(e=>{var t;if(e.length>0){const i=e.depth;null===(t=l.get(i))||void 0===t||t.delete(e),oi(l,mi(i),e)}})}}const o=this.extensions,c=o.length;let h=0;while(h<c)o[h++].beforeBaseLayout(e);let d=this.extensionsTraverse;for(const e of l.values())for(const i of e.values()){if(0===i.length)continue;const e=i.floatContainer,a=i.renderExtension,r=i.duplicate(),l=r.length;for(h=0;h<l;++h){let i=r[h];if(i.rendered||!i.visible)continue;let o=i.parent;if(l>1&&h<l-1&&i.pageFlow&&!i.nodeGroup&&(0===o.alignmentType||o.hasAlign(1)||i.hasAlign(4096))&&!o.hasAlign(2)&&i.hasSection(Je.DOM_TRAVERSE)){const s=[],a=[];let c=h,d=0;if(o.layoutVertical&&i.hasAlign(4096))s.push(i),++c,++d;e:{let t,i=false;for(;c<l;++c,++d){const l=r[c];if(l.pageFlow){if(l.labelFor&&!l.visible){--d;continue}if(e){if(i){if(n.get(l))i=false}if(t=l.floating,t)i=true}if(0===d){const e=l.siblingsTrailing[0];if(e){if(!gi(l)||e.alignedVertically([l])>0)a.push(l);else s.push(l);continue}}if(l.siblingsLeading[0]){const t=s.length>0;if(e){const e=l.alignedVertically(t?s:a,n,t);if(e>0){if(s.length>0){if(i&&e<4&&!l.siblingsLeading.some(e=>n.has(e)&&!s.includes(e))){s.push(l);continue}else switch(e){case 6:case 7:if(!n.has(l))n.set(l,"both");break}break e}a.push(l)}else{if(a.length>0)break e;s.push(l)}}else if(l.alignedVertically(t?s:a,void 0,t)>0){if(s.length>0)break e;a.push(l)}else{if(a.length>0)break e;s.push(l)}}else break e}else if(l.autoPosition){const e=a.length;if(e>0){if(a[e-1].blockStatic&&!l.renderExclude)a.push(l);break}else s.push(l)}}}let u,f,g=s.length,p=true;if(g>1){const e=s.filter(e=>!e.renderExclude||n.has(e));if(e.length>1)u=t.processTraverseHorizontal(new LayoutUI(o,i,0,0,e),r);f=s[g-1]}else if(g=a.length,g>1){const e=a.filter(e=>!e.renderExclude||n.has(e));if(e.length>1)u=t.processTraverseVertical(new LayoutUI(o,i,0,0,e),r);if(f=a[g-1],gi(f)&&f!==r[l-1])f.addAlign(4096)}if(u)if(this.addLayout(u))o=i.parent;else p=false;if(p&&f===r[l-1])o.removeAlign(1)}if(i.removeAlign(4096),h===l-1)o.removeAlign(1);if(i.renderAs&&o.replaceTry({child:i,replaceWith:i.renderAs}))if(i.hide(),i=i.renderAs,i.positioned)o=i.parent;if(!i.rendered&&i.hasSection(Je.EXTENSION)){const e=s.get(i.id);let t=e?(null==a?void 0:a.concat(e))||e:a,n=false;if(t){const e=t.length;let s=0;while(s<e){const e=t[s++],a=e.processChild(i,o);if(a){if(a.output)this.addLayoutTemplate(a.outerParent||o,i,a.output);if(a.renderAs&&a.outputAs)this.addLayoutTemplate(a.parentAs||o,a.renderAs,a.outputAs);if(a.parent)o=a.parent;if(a.subscribe)e.subscribers.add(i);if(n=true===a.next,a.complete||n)break}}if(n)continue}if(i.styleElement){t=i.use?si(i.use,d):d;const s=t.length;let a=0;while(a<s){const s=t[a++];if(s.is(i))if(s.condition(i,o)&&(!e||!e.includes(s))){const e=s.processNode(i,o);if(e){if(e.output)this.addLayoutTemplate(e.outerParent||o,i,e.output);if(e.renderAs&&e.outputAs)this.addLayoutTemplate(e.parentAs||o,e.renderAs,e.outputAs);if(e.parent)o=e.parent;if(e.include)Jt(i,"renderExtension").push(s),s.subscribers.add(i);else if(e.subscribe)s.subscribers.add(i);if(e.remove){const e=d.indexOf(s);if(-1!==e)d=d.slice(0),d.splice(e,1)}if(n=true===e.next,e.complete||n)break}}}if(n)continue}}if(!i.rendered&&i.hasSection(Je.RENDER)){let e=this.createLayoutControl(o,i);if(0===e.containerType){const s=i.length>0?t.processUnknownParent(e):t.processUnknownChild(e);if(s.next)continue;e=s.layout}this.addLayout(e)}}}a.sort((e,t)=>{if(e.depth===t.depth){if(e.innerWrapped===t)return-1;else if(e===t.innerWrapped)return 1;const i=e.outerWrapper,s=t.outerWrapper;if(e===s||!i&&s)return-1;else if(t===i||!s&&i)return 1;if(e.nodeGroup&&t.nodeGroup)return e.id<t.id?-1:1;else if(e.nodeGroup)return-1;else if(t.nodeGroup)return 1;return 0}return e.depth<t.depth?-1:1}),h=0;while(h<c){const t=o[h++];for(const e of t.subscribers)if(a.contains(e))t.postBaseLayout(e);t.afterBaseLayout(e)}}setConstraints(e){const t=this.getProcessingCache(e);this.controllerHandler.setConstraints(t);const i=this.extensions,s=i.length;let n=0;while(n<s){const s=i[n++];for(const e of s.subscribers)if(t.contains(e))s.postConstraints(e);s.afterConstraints(e)}}setResources(e){const t=this.resourceHandler;this.getProcessingCache(e).each(e=>{if(t.setBoxStyle(e),e.hasResource(Ze.VALUE_STRING)&&e.visible&&!e.imageElement&&!e.svgElement)t.setFontStyle(e),t.setValueString(e)});const i=this.extensions,s=i.length;let n=0;while(n<s)i[n++].afterResources(e)}processFloatHorizontal(e){const t=this.controllerHandler,{containerType:i,alignmentType:s}=t.containerTypeVertical,n=this.session.clearMap,a=[],r=[],l=[],o=[];let c,h,d,u,f,g,p=false,m=false,b=false;if(e.each((e,t)=>{const i=e.float;if(m&&"left"===i)b=true;if(t>0){if(n.get(e))b=true;else if(e.data(Application.KEY_NAME,"cleared"))m=true}if(!b)if("left"===i)l.push(e);else if("right"===i)o.push(e);else if(l.length>0||o.length>0){let t=e.linear.top;if(e.styleText){const i=e.textBounds;if(i)t=Math.max(i.top,t)}if(t=Math.ceil(t),e.blockStatic&&l.some(e=>t>=e.bounds.bottom))if(f)f.push(e);else f=[e];else r.push(e)}else r.push(e);else if("left"===i)if(c)c.push(e);else c=[e];else if("right"===i)if(h)h.push(e);else h=[e];else if(f)f.push(e);else f=[e]}),l.length>0)d=c?[l,c]:l;else if(c)d=c;if(o.length>0)u=h?[o,h]:o;else if(h)u=h;if(o.length+((null==h?void 0:h.length)||0)===e.length)e.addAlign(1024);if(r.length>0)a.push(r),p=e.every(e=>r.includes(e)||!e.imageElement);if(d)a.push(d);if(u)a.push(u);if(f){const{node:n,parent:a}=e;if(f.length>1)f[0].addAlign(4096);f.unshift(n);const r=t.createNodeGroup(n,f,a);r.childIndex=n.childIndex,r.containerName=n.containerName,g=r.inherit(n,"boxStyle"),r.innerWrapped=n,n.resetBox(15,r),n.resetBox(240,r),this.addLayout(new LayoutUI(a,r,i,s|(a.blockStatic?32:0),f)),e.parent=r}e.type=t.containerTypeVerticalMargin,e.itemCount=a.length,e.addAlign(32);let x,y=0;while(y<e.itemCount){const n=a[y++];let l,c,h;if(Array.isArray(n[0])){l=n,c=l.length;let a=l[0];x=1;while(x<c)a=a.concat(l[x++]);a.sort((e,t)=>e.childIndex<t.childIndex?-1:1);const r=e.node;if(r.layoutVertical)h=r;else h=t.createNodeGroup(a[0],a,r),this.addLayout(LayoutUI.create({parent:r,node:h,containerType:i,alignmentType:s|(l.some(e=>e===u||e===o)?1024:0),itemCount:c}))}else l=[n],c=1;x=0;while(x<c){const n=l[x++],a=h||e.node,o=t.createNodeGroup(n[0],n,a,{delegate:true,cascade:true}),c=new LayoutUI(a,o,0,64);if(n===r){if(c.addAlign(128),p)if(g)o.inheritApply("boxStyle",g);else o.inherit(e.node,"boxStyle")}else c.addAlign(ni(n));if(n.some(e=>e.percentWidth>0||e.percentHeight>0)){if(c.type=t.containerTypePercent,1===n.length)c.node.innerWrapped=n[0]}else if(1===n.length||c.linearY)c.setContainerType(i,s);else if(!c.linearX)c.setContainerType(i,1);else t.processLayoutHorizontal(c);if(this.addLayout(c),n===r)this.setFloatPadding(a,o,r,d&&Gt(d),u&&Gt(u))}}return e}processFloatVertical(e){const t=this.controllerHandler,{containerType:i,alignmentType:s}=t.containerTypeVertical,n=this.session.clearMap;if(0!==e.containerType){const n=e.node,a=t.createNodeGroup(n,[n],e.parent);this.addLayout(new LayoutUI(a,n,i,s,a.children)),e.node=a}else e.setContainerType(i,s);const a=[],r=[],l=[],o=[];let c=false,h=false,d=true;if(e.each(e=>{if(e.blockStatic&&0===o.length)l.push(e),h=true;else{if(n.has(e))if(!e.floating)e.setBox(1,{reset:1}),a.push(l.slice(0)),r.push(o.slice(0)),l.length=0,o.length=0;else c=true;if(e.floating){if(h)a.push(l.slice(0)),r.push(null),l.length=0,o.length=0,h=false;o.push(e)}else{if(c&&!n.has(e))d=false;l.push(e)}}}),o.length>0)r.push(o);if(l.length>0)a.push(l);if(!d){const{containerType:n,alignmentType:l}=t.containerTypeVerticalMargin,o=e.node,c=Math.max(r.length,a.length);for(let e=0;e<c;++e){const c=a[e],h=r[e],d=c.length;if(!h&&d>0){const e=t.containerTypeVertical;this.addLayout(new LayoutUI(o,t.createNodeGroup(c[0],c,o),e.containerType,96|e.alignmentType,c))}else{const e=[];let a,r=0;if(h)if(h.length>1){const i=t.createNodeGroup(h[0],h);if(r=256,0===d&&h.every(e=>"right"===e.float))r|=1024;e.push(i)}else e.push(h[0]);if(d>1||h)a=t.createNodeGroup(c[0],c),e.push(a);else if(1===d)e.push(c[0]);const u=t.createNodeGroup((h||c)[0],e,o);this.addLayout(new LayoutUI(o,u,n,l|r));let f=0;while(f<e.length){const t=e[f++];this.addLayout(new LayoutUI(u,t,i,96|s,t.children))}if(d&&h&&a){const[e,t]=Qt(h,e=>"right"!==e.float);this.setFloatPadding(o,a,c,e,t)}}}}return e}createPseduoElement(e,t,i){var s;let n=Ht(e,"styleMap"+t,i);if("Q"===e.tagName){if(!n)n={},Vt(e,"styleMap"+t,i,n);let s=n.content;if(!s)s=Pt(e,t).getPropertyValue("content")||("::before"===t?"open-quote":"close-quote"),n.content=s}if(n){let a=n.content;if(a){const r=ei(a,'"');if(!$t(r)){const i=Bt(n.position);if("::after"===t){if((i||""===r||!function(e){const t=e.childNodes[e.childNodes.length-1];return"#text"===t.nodeName&&!/\s+$/.test(t.textContent)}(e))&&!ai(n,true,i))return}else{const t=e.childNodes,s=t.length;let a=0;while(a<s){const e=t[a++];if("#text"===e.nodeName){if($t(e.textContent))break}else if(Mt(e)){const t=Pt(e);if(Bt(n.position))continue;else if("none"!==t.getPropertyValue("float"))return;break}}if(!ai(n,false,i))return}}else if("inherit"===a){let t=e;do{if(a=Pt(t).getPropertyValue("content"),"inherit"!==a)break;t=t.parentElement}while(null!==t)}const l=Pt(e);let o="",c="",h=0;while(h<ii.length){const e=ii[h++];if(!n[e])n[e]=l[e]}switch(a){case"normal":case"none":case"initial":case"inherit":case"unset":case"no-open-quote":case"no-close-quote":case'""':break;case"open-quote":if("::before"===t)c=ri(e,t,"","",i);break;case"close-quote":if("::after"===t)c=ri(e,t,"","",i);break;default:{const n=Wt(a);if(n)if(c=n,Yt(this._controllerSettings.mimeType.image,n))o="img";else c="";else{const n=/\s*(?:attr\(([^)]+)\)|(counter)\(([^,)]+)(?:,\s+([a-z-]+))?\)|(counters)\(([^,]+),\s+"([^"]*)"(?:,\s+([a-z-]+))?\)|"([^"]+)")\s*/g;let r,o=false;while(r=n.exec(a)){const n=r[1];if(n)c+=Ft(e,n.trim());else if(r[2]||r[5]){const n="counter"===r[2],[a,o]=n?[r[3],r[4]||"decimal"]:[r[6],r[8]||"decimal"],d=(null!==(s=ui(e,a,t,i,0))&&void 0!==s?s:1)+(ci(l.getPropertyValue("counter-reset"),a,0)||0),u=[];let f,g=e,p=d,m=false;const b=(e,t)=>{if(0===u.length)p+=e;else if(m||t)u[u.length-1]+=e},x=e=>{if(void 0===ci(Pt(e).getPropertyValue("counter-reset"),a))Kt(e.children,e=>{if("__squared.pseudo"!==e.className){let s=ui(e,a,t,i);if(s)b(s,true);const n=Pt(e);if(s=ci(n.getPropertyValue("counter-increment"),a),s)b(s,false);if(s=ci(n.getPropertyValue("counter-reset"),a),void 0!==s)return true;x(e)}})};while(null!==g){if(m=false,g.previousElementSibling)if(g=g.previousElementSibling,g)x(g);else break;else{if(g=g.parentElement,null===g)break;m=true}if("__squared.pseudo"!==g.className){const e=ui(g,a,t,i);if(e)b(e,true);const s=Pt(g),r=ci(s.getPropertyValue("counter-increment"),a);if(r)b(r,false);const l=ci(s.getPropertyValue("counter-reset"),a);if(void 0!==l){if(!f)p+=l;if(f=g,n)break;else if(m)u.push((e||0)+l)}}}if(f){if(!n&&u.length>1){u.reverse().splice(1,1);const e=r[7];h=0;while(h<u.length)c+=Rt(o,u[h++],true)+e}}else p=d;c+=Rt(o,p,true)}else if(r[9])c+=r[9];o=true}if(!o)c=a}break}}if(!n.display)n.display="inline";if(c||'""'===a){if(""===o)o=/^(inline|table)/.test(n.display)?"span":"div";const s=document.createElement(o);if(s.className="__squared.pseudo",s.style.setProperty("display","none"),"::before"===t)e.insertBefore(s,e.childNodes[0]);else e.appendChild(s);if("img"===o){s.src=c;const e=this.resourceHandler.getImage(c);if(e){if(!n.width&&e.width>0)n.width=Nt(e.width);if(!n.height&&e.height>0)n.height=Nt(e.height)}}else if('""'!==a)s.innerText=c;for(const e in n)if("display"!==e)s.style[e]=n[e];return Vt(s,"pseudoElement",i,t),Vt(s,"styleMap",i,n),s}}}}createAssetOptions(e){return e?Object.assign(Object.assign({},e),{assets:e.assets?this.layouts.concat(e.assets):this.layouts}):{assets:this.layouts}}createLayoutControl(e,t){return new LayoutUI(e,t,t.containerType,t.alignmentType,t.children)}setFloatPadding(e,t,i,s=[],n=[]){let a=[],r=0;while(r<i.length){const e=i[r++];if(pi(e)||e.centerAligned)a.push(e);if(e.blockStatic)a=a.concat(e.cascade(t=>pi(t,t.depth-e.depth)))}const l=a.length;if(0===l)return;const o=t.bounds.bottom,c=e.actualBoxWidth();let h=s.length;if(h>0){let i=-1/0,n=false;r=0;while(r<h){const e=s[r++];if(e.bounds.top<o){const t=e.linear.right+li(e,false);if(t>i)i=t,n=e.marginRight>0;else if(t===i&&e.marginRight<=0)n=false}}if(i!==-1/0){let o=-1/0;r=0;while(r<l){const e=a[r++];if(Math.floor(e.linear.left)<=i||e.centerAligned)o=Math.max(o,e.marginLeft)}if(o!==-1/0){const r=i-e.box.left-o-Ut(t.map(e=>!a.includes(e)?e.marginLeft:0));if(r>0&&r<c)t.modifyBox(128,r+(!n&&t.find(e=>e.multiline,{cascade:true})?Math.max(o,this._controllerSettings.deviations.textMarginBoundarySize):0)),hi(s,r)}}}if(h=n.length,h>0){let i=1/0,s=false;r=0;while(r<h){const e=n[r++];if(e.bounds.top<o){const t=e.linear.left+li(e,true);if(t<i)i=t,s=e.marginLeft>0;else if(t===i&&e.marginLeft<=0)s=false}}if(i!==1/0){let o=-1/0;r=0;while(r<l){const e=a[r++];if(e.multiline||e.centerAligned||Math.ceil(e.linear.right)>=i)o=Math.max(o,e.marginRight)}if(o!==-1/0){const r=e.box.right-i-o-Ut(t.map(e=>!a.includes(e)?e.marginRight:0));if(r>0&&r<c)t.modifyBox(32,r+(!s&&t.find(e=>e.multiline,{cascade:true})?Math.max(o,this._controllerSettings.deviations.textMarginBoundarySize):0)),hi(n,r)}}}}get mainElement(){return document.body}get layouts(){return this._layouts.sort((e,t)=>{const i=e.index,s=t.index;if(i!==s)if(0===i||s===1/0||void 0===s&&!(i===1/0))return-1;else if(0===s||i===1/0||void 0===i&&!(s===1/0))return 1;else if(void 0!==i&&void 0!==s)return i<s?-1:1;return 0})}get extensionsCascade(){return this.extensions.filter(e=>!!e.init)}get extensionsTraverse(){return this.extensions.filter(e=>!e.eventOnly)}get clearMap(){return this.session.clearMap}},e.Controller=Controller,e.ControllerUI=class ControllerUI extends Controller{constructor(){super(...arguments),this._requireFormat=false,this._beforeOutside={},this._beforeInside={},this._afterInside={},this._afterOutside={}}init(){const e=this.localSettings.unsupported;this._unsupportedCascade=e.cascade,this._unsupportedTagName=e.tagName}preventNodeCascade(e){return this._unsupportedCascade.has(e.tagName)}includeElement(e){const t=e.tagName;return!(this._unsupportedTagName.has(t)||"INPUT"===t&&this._unsupportedTagName.has(t+":"+e.type))||"true"===e.contentEditable}reset(){this._requireFormat=false,this._beforeOutside={},this._beforeInside={},this._afterInside={},this._afterOutside={}}applyDefaultStyles(e,t){let i;if("#text"===e.nodeName)i={position:"static",display:"inline",verticalAlign:"baseline",float:"none",clear:"none"};else{i=Ci(e,"styleMap",t)||{};const s=e.tagName;if(xi(4))switch(s){case"BODY":if("rgba(0, 0, 0, 0)"===i.backgroundColor)i.backgroundColor="rgb(255, 255, 255)";break;case"INPUT":case"SELECT":case"BUTTON":case"TEXTAREA":if(!i.display)i.display="inline-block";break;case"FIELDSET":if(!i.display)i.display="block";break}switch(s){case"INPUT":{const t=e.type;switch(t){case"radio":case"checkbox":case"image":break;case"week":case"month":case"time":case"date":case"datetime-local":i.paddingTop=vi(Ri(i.paddingTop)+1),i.paddingRight=vi(Ri(i.paddingRight)+1),i.paddingBottom=vi(Ri(i.paddingBottom)+1),i.paddingLeft=vi(Ri(i.paddingLeft)+1);break;default:{const e=this.localSettings.style,s=Hi(i,e.inputBorderColor);switch(t){case"file":case"reset":case"submit":case"button":Di(i,s,e.inputBackgroundColor);break}break}}break}case"BUTTON":{const e=this.localSettings.style;Di(i,Hi(i,e.inputBorderColor),e.inputBackgroundColor);break}case"TEXTAREA":case"SELECT":Hi(i,this.localSettings.style.inputBorderColor);break;case"BODY":{const e=i.backgroundColor;if(!e||"initial"===e)i.backgroundColor="rgb(255, 255, 255)";break}case"FORM":if(!i.marginTop)i.marginTop="0px";break;case"LI":if(!i.listStyleImage){const t=wi(e);i.listStyleImage=t.getPropertyValue("list-style-image")}break;case"IFRAME":if(!i.display)i.display="block";case"IMG":case"CANVAS":case"svg":case"VIDEO":case"OBJECT":case"EMBED":this.setElementDimension(e,s,i,"width","height"),this.setElementDimension(e,s,i,"height","width");break}}Ai(e,"styleMap",t,i)}addBeforeOutsideTemplate(e,t,i=true,s=-1){const n=Bi(this._beforeOutside,e);if(-1!==s&&s<n.length)n.splice(s,0,t);else n.push(t);if(i)this._requireFormat=true}addBeforeInsideTemplate(e,t,i=true,s=-1){const n=Bi(this._beforeInside,e);if(-1!==s&&s<n.length)n.splice(s,0,t);else n.push(t);if(i)this._requireFormat=true}addAfterInsideTemplate(e,t,i=true,s=-1){const n=Bi(this._afterInside,e);if(-1!==s&&s<n.length)n.splice(s,0,t);else n.push(t);if(i)this._requireFormat=true}addAfterOutsideTemplate(e,t,i=true,s=-1){const n=Bi(this._afterOutside,e);if(-1!==s&&s<n.length)n.splice(s,0,t);else n.push(t);if(i)this._requireFormat=true}getBeforeOutsideTemplate(e,t){const i=this._beforeOutside[e];return i?qi(i,t):""}getBeforeInsideTemplate(e,t){const i=this._beforeInside[e];return i?qi(i,t):""}getAfterInsideTemplate(e,t){const i=this._afterInside[e];return i?qi(i,t):""}getAfterOutsideTemplate(e,t){const i=this._afterOutside[e];return i?qi(i,t):""}hasAppendProcessing(e){return void 0===e?this._requireFormat:e in this._beforeOutside||e in this._beforeInside||e in this._afterInside||e in this._afterOutside}visibleElement(e,t,i){let s,n,a;if(i){const t=e.parentElement;s=t?wi(t,i):wi(e),n=1,a=1}else if(s=wi(e),"none"!==s.getPropertyValue("display")){const i=Ti(e,t);if(!ki(i))return false;({width:n,height:a}=i)}else return false;if(n>0&&a>0)return"visible"===s.getPropertyValue("visibility")||!Si(s.getPropertyValue("position"));else if(!i&&("IMG"===e.tagName&&"none"!==s.getPropertyValue("display")||Pi(e.children,e=>this.visibleElement(e,t))===1/0))return true;return!Si(s.getPropertyValue("position"))&&(n>0&&"none"!==s.getPropertyValue("float")||i&&"none"!==s.getPropertyValue("clear")||"block"===s.getPropertyValue("display")&&(0!==parseInt(s.getPropertyValue("margin-top"))||0!==parseInt(s.getPropertyValue("margin-bottom"))))}evaluateNonStatic(e,t){const i=new Set,s=new Set,n=new Map;t.each(t=>{if(t.floating){if("left"===t.float){const e=t.actualParent;let i,s=e;while("P"===(null==s?void 0:s.tagName)&&!s.documentRoot)i=s,s=s.actualParent;if(s&&i&&s!==e&&"DIV"===s.tagName)if(n.has(i))n.get(i).appending.push(t);else n.set(i,{parent:s,appending:[t]})}}else if(!t.pageFlow&&!t.documentRoot){const n=t.actualParent,a=t.absoluteParent;let r;switch(t.css("position")){case"fixed":if(!t.autoPosition){r=e;break}case"absolute":if(r=a,t.autoPosition){if(!t.siblingsLeading.some(e=>e.multiline||e.excluded&&!e.blockStatic))t.cssApply({display:"inline-block",verticalAlign:"top"},true);else t.autoPosition=false;r=n}else if(this.userSettings.supportNegativeLeftTop){let i=false;while(r&&r!==e&&(!r.rightAligned&&!r.centerAligned||!r.pageFlow)){const e=r.linear;if(!i)if(t.hasPX("top")&&t.hasPX("bottom")||t.hasPX("left")&&t.hasPX("right"))break;else{const s="hidden"===r.css("overflowX"),n="hidden"===r.css("overflowY");if(s&&n)break;const a=!s&&t.outsideX(e),l=!n&&t.outsideY(e);if(a&&(t.left<0||t.right>0)||l&&(t.top<0||0!==t.bottom))i=true;else if(!s&&((t.left<0||t.right>0)&&Math.ceil(t.bounds.right)<e.left||(t.left>0||t.right<0)&&Math.floor(t.bounds.left)>e.right)&&r.some(e=>e.pageFlow))i=true;else if(!n&&((t.top<0||t.bottom>0)&&Math.ceil(t.bounds.bottom)<r.bounds.top||(t.top>0||t.bottom<0)&&Math.floor(t.bounds.top)>r.bounds.bottom))i=true;else if(a&&l&&(!r.pageFlow||r.actualParent.documentRoot&&(t.top>0||t.left>0)))i=true;else if(!(s||n||t.intersectX(e)||t.intersectY(e)))i=true;else break}else if(r.layoutElement){r=a;break}else if(t.withinX(e)&&t.withinY(e))break;r=r.actualParent}}break}if(!r)r=e;if(r!==n){if(a.positionRelative&&r!==a){const{left:e,right:i,top:s,bottom:n}=a,r=t.bounds;if(0!==e)r.left+=e,r.right+=e;else if(!a.hasPX("left")&&0!==i)r.left-=i,r.right-=i;if(0!==s)r.top+=s,r.bottom+=s;else if(!a.hasPX("top")&&0!==n)r.top-=n,r.bottom-=n;t.unset("box"),t.unset("linear")}let e=t.toFloat("opacity",1),l=n;do{e*=l.toFloat("opacity",1),l=l.actualParent}while(l&&l!==r);t.css("opacity",e.toString()),t.parent=r,t.containerIndex=1/0,i.add(r),s.add(n)}t.documentParent=r}});for(const e of s)e.each((e,t)=>e.containerIndex=t);for(const[e,t]of n.entries()){const{parent:i,appending:s}=t,n=i.children;if(n.includes(e)){const t=new Set,{childIndex:a,containerIndex:r}=e,l=i.naturalChildren.slice(0),o=n[r],c=i.depth+1;for(let e=0,h=0,d=0,u=false;e<s.length;++e){const f=s[e];if(0===f.containerIndex)u=true;else if(u){const t=s[e-1];u=f.containerIndex-t.containerIndex==1&&f.actualParent===t.actualParent}const g=h+(u?0:d+1),p=a+g,m=r+g;if(l.splice(p,0,f),n.splice(m,0,f),u)o.siblingsLeading.unshift(f),++h;else++d;f.parent.remove(f),f.init(i,c,f.childIndex),f.documentParent=i;const b=f.css("clear");switch(b){case"left":case"right":case"both":e:{let e,t=p-1;while(t>=0){const i=l[t--];if(i.floating){const t=i.float;if("both"===b||t===b){this.application.session.clearMap.set(f,b);let e=f.nextElementSibling;while(null!==e){if(e.floating&&!s.includes(e))s.push(e);e=e.nextElementSibling}break}else if(t===e)break}else{const t=i.css("clear");switch(t){case"left":case"right":if(b===t)break e;else e=t;break;case"both":break e}}}}break}t.add(f.actualParent)}i.each((e,t)=>e.containerIndex=t),i.floatContainer=true;const h=l.length;let d,u=0;while(u<s.length){const e=s[u++],t=l.findIndex(t=>t===e);if(-1!==t){const i=[],s=[];d=t-1;while(d>=0){const e=l[d--];if(i.push(e),!e.excluded)break}d=t+1;while(d<h){const e=l[d++];if(s.push(e),!e.excluded)break}e.siblingsLeading=i,e.siblingsTrailing=s}}for(const e of t){let t=false;if(e.each((e,i)=>{if(e.floating)t=true;e.containerIndex=i}),!t)e.floatContainer=false}}}for(const e of i){const t=[];let i=-1;e.each(s=>{if(s.containerIndex===1/0)e.some(e=>{let i=e.naturalElements.includes(s);if(!i){const t=e.cascade();i=s.ascend({condition:e=>t.includes(e)}).length>0}if(i)Bi(t,e.containerIndex+(s.zIndex>=0||e!==s.actualParent?1:0)).push(s);return i});else if(s.containerIndex>i)i=s.containerIndex});const s=t.length;if(s>0){const n=e.children;for(let e=0,a=0,r=1;e<s;++e,++a){const s=t[e];if(s){s.sort((e,t)=>{if(e.parent===t.parent){const i=e.zIndex,s=t.zIndex;if(i===s)return e.id<t.id?-1:1;else return i<s?-1:1}return 0}).forEach(e=>e.containerIndex=i+r++);const e=n.length;for(let t=0;t<e;++t)if(s.includes(n[t]))n[t]=void 0;n.splice(a,0,...s),a+=s.length}}e.retainAs(Ni(n))}}}sortInitialCache(e){e.sort((e,t)=>{if(e.depth!==t.depth)return e.depth<t.depth?-1:1;else{const i=e.documentParent,s=t.documentParent;if(i!==s){const e=i.depth,t=s.depth;if(e!==t)return e<t?-1:1;else if(i.actualParent===s.actualParent)return i.childIndex<s.childIndex?-1:1;return i.id<s.id?-1:1}}return 0})}cascadeDocument(e,t){const i=this.userSettings.showAttributes,s="\t".repeat(t);let n="";const a=e.length;let r=0;while(r<a){const a=e[r++];switch(a.type){case 1:{const e=a.node,{controlName:r,attributes:l}=a,{id:o,renderTemplates:c}=e,h=t+1,d=e.depth<0?t+e.depth:t,u=this.getBeforeInsideTemplate(o,h),f=this.getAfterInsideTemplate(o,h);let g=s+"<"+r+(0===t?"{#0}":"")+(i?l?Vi(l,h):e.extractAttributes(h):"");if(c||""!==u||""!==f)g+=">\n"+u+(c?this.cascadeDocument(this.sortRenderPosition(e,c),h):"")+f+s+`</${r}>\n`;else g+=" />\n";n+=this.getBeforeOutsideTemplate(o,d)+g+this.getAfterOutsideTemplate(o,d);break}case 2:{const e=a.content;if(e)n+=Vi(e,t);break}}}return n}getEnclosingXmlTag(e,t="",i){return"<"+e+t+(i?`>\n${i}</${e}>\n`:" />\n")}setElementDimension(e,t,i,s,n){var a;const r=i[s];if(!r||"auto"===r){const t=new RegExp(`\\s+${s}="([^"]+)"`).exec(e.outerHTML);if(t){const e=t[1];if(Ei(e))i[s]=e+"px";else if(_i(e))i[s]=e}else if(300===e.clientWidth&&150===e.clientHeight)if("width"===s)i.width="300px";else i.height="150px";else{const t=null===(a=this.application.resourceHandler)||void 0===a?void 0:a.getImage(e.src);if(t&&t.width>0&&t.height>0){const e=i[n];if(e&&Ei(e)){const a="max"+Ii(s);if(!i[a]||!_i(a))i[s]=vi(t[s]*parseFloat(e)/t[n])}}}}}},e.Extension=Extension,e.ExtensionManager=class ExtensionManager{constructor(e){this.application=e}include(e){const t=this.application,i=t.extensions;if("string"==typeof e){const t=this.retrieve(e);if(!t)return false;e=t}const s=e.name,n=i.findIndex(e=>e.name===s);if(-1!==n)return i[n]=e,true;else{const{framework:s,dependencies:n}=e;if(s>0){const e=n.length;let i=0;while(i<e){const e=n[i++];if(e.preload)if(!this.retrieve(e.name)){const i=t.builtInExtensions[e.name];if(i)this.include(i)}}}if((0===s||k(s,t.framework))&&n.every(e=>!!this.retrieve(e.name)))return e.application=t,i.push(e),true}return false}exclude(e){const t=this.extensions,i=t.length;for(let s=0;s<i;++s)if(t[s]===e||"string"==typeof e&&this.retrieve(e))return t.splice(s,1),true;return false}retrieve(e,t){const i=this.extensions,s=i.length;let n=0;while(n<s){const t=i[n++];if(t.name===e)return t}return t&&this.application.builtInExtensions[e]||null}optionValue(e,t,i){var s;const n=null===(s=this.retrieve(e))||void 0===s?void 0:s.options;return T(n)?n[t]:i}optionValueAsObject(e,t,i=null){const s=this.optionValue(e,t);return T(s)?s:i}optionValueAsString(e,t,i=""){const s=this.optionValue(e,t);return"string"==typeof s?s:i}optionValueAsNumber(e,t,i=NaN){const s=this.optionValue(e,t);return"number"==typeof s?s:i}optionValueAsBoolean(e,t,i=false){const s=this.optionValue(e,t);return"boolean"==typeof s?s:i}get extensions(){return this.application.extensions}},e.ExtensionUI=ExtensionUI,e.File=File,e.FileUI=class FileUI extends File{get directory(){return this.resource.controllerSettings.directory}},e.LayoutUI=LayoutUI,e.Node=Node,e.NodeGroupUI=class NodeGroupUI extends NodeUI{init(){var e;if(this.length>0)this.setBounds(),this.saveAsInitial();this.dir=(null===(e=this.actualParent)||void 0===e?void 0:e.dir)||""}setBounds(){if(this.length>0)return this._bounds=NodeUI.outerRegion(this),this._bounds}previousSiblings(e){let t=this;do{t=t.item(0)}while(null==t?void 0:t.nodeGroup);return(null==t?void 0:t.previousSiblings(e))||[]}nextSiblings(e){let t=this;do{t=t.item()}while(null==t?void 0:t.nodeGroup);return(null==t?void 0:t.nextSiblings(e))||[]}get inline(){if(this.hasAlign(32))return false;const e=this._cached.inline;return void 0===e?this._cached.inline=this.every(e=>e.inline):e}get inlineStatic(){if(this.hasAlign(32))return false;const e=this._cached.inlineStatic;return void 0===e?this._cached.inlineStatic=this.every(e=>e.inlineStatic):e}get inlineVertical(){if(this.hasAlign(32))return false;const e=this._cached.inlineVertical;return void 0===e?this._cached.inlineVertical=this.every(e=>e.inlineVertical):e}get inlineFlow(){if(this.hasAlign(32))return false;const e=this._cached.inlineFlow;return void 0===e?this._cached.inlineFlow=this.every(e=>e.inlineFlow):e}get inlineDimension(){if(this.hasAlign(32))return false;const e=this._cached.inlineDimension;return void 0===e?this._cached.inlineDimension=this.every(e=>e.inlineDimension):e}get block(){if(this.hasAlign(32))return true;const e=this._cached.block;return void 0===e?this._cached.block=this.some(e=>e.block):e}get blockStatic(){if(this.hasAlign(32))return true;let e=this._cached.blockStatic;if(void 0===e){const t=this.actualParent||this.documentParent;if(e=this.some(e=>e.blockStatic||e.percentWidth>0)||this.layoutVertical&&(t.hasWidth||this.some(e=>e.centerAligned||e.rightAligned))||t.percentWidth>0||t.blockStatic&&(t.layoutVertical||this.hasAlign(128)),e||0!==this.containerType)this._cached.blockStatic=e}return e}get blockDimension(){const e=this._cached.blockDimension;return void 0===e?this._cached.blockDimension=this.every(e=>e.blockDimension):e}get blockVertical(){const e=this._cached.blockVertical;return void 0===e?this._cached.blockVertical=this.every(e=>e.blockVertical):e}get pageFlow(){const e=this._cached.pageFlow;return void 0===e?this._cached.pageFlow=!Gi(this.css("position")):e}set baseline(e){this._cached.baseline=e}get baseline(){let e=this._cached.baseline;if(void 0===e){if(this.some(e=>e.floating||e.hasAlign(256)))e=false;else{const t=this.css("verticalAlign");e=""===t?this.every(e=>e.baseline):"baseline"===t||ji(t,true)}this._cached.baseline=e}return e}get float(){if(!this.floating)return"none";else if(this.hasAlign(1024))return"right";else if(this.every(e=>"right"===e.float))return this.addAlign(1024),"right";return"left"}get floating(){return this.every(e=>e.floating||e.hasAlign(256))}get display(){return super.display||(this.some(e=>e.blockStatic)?"block":this.blockDimension?"inline-block":"inline")}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}set childIndex(e){super.childIndex=e}get childIndex(){let e=super.childIndex;if(e===1/0)this.each(t=>e=Math.min(t.childIndex,e)),super.childIndex=e;return e}set containerIndex(e){super.containerIndex=e}get containerIndex(){let e=super.containerIndex;if(e===1/0)this.each(t=>e=Math.min(t.containerIndex,e)),super.containerIndex=e;return e}get centerAligned(){const e=this._cached.centerAligned;return void 0===e?this._cached.centerAligned=this.every(e=>e.centerAligned):e}get rightAligned(){if(this.hasAlign(1024))return true;const e=this._cached.rightAligned;return void 0===e?this._cached.rightAligned=this.every(e=>e.rightAligned):e}get tagName(){return""}get plainText(){return false}get styleText(){return false}get multiline(){return false}get nodeGroup(){return true}get naturalChild(){return false}get naturalElement(){return false}get pseudoElement(){return false}get previousSibling(){return null}get nextSibling(){return null}get previousElementSibling(){return null}get nextElementSibling(){return null}},e.NodeList=NodeList,e.NodeUI=NodeUI,e.Resource=Resource,e.ResourceUI=ResourceUI,e.extensions=ba,e.lib=xa,Object.defineProperty(e,"__esModule",{value:true})}));
